YUI.add("fluid-share-panel-view",function(e,t){function i(e){return e.displayUrl||e.url||e.src}var s=require("hermes-core/flog")(t),a=require("url-parse"),n={},r=["sq","t","q","s","n","m","z","c","b","l","h","k"],l={header:"false",footer:"false",context:"false",vr:"false"};n["embed-code-size-field"]="embed-code-text-field",n["iframe-code-size-field"]="iframe-code-text-field",n["bb-code-size-field"]="bb-code-text-field",e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.networkClasses=t.networkClasses||{},this.linkShareParams=t.linkShareParams,this.guestPassParams=t.guestPassParams||{},this.emailShareParams=t.emailShareParams,this.signedOutSharingPerms=t.signedOutSharingPerms||{},this.shareItemCount=t.shareItemCount||1,this.PERMISSIONS=[],this.guestPassParams.canSharePrivate&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_PRIVATE"}),value:"private"}),!1!==this.guestPassParams.shareNonPublic&&(this.guestPassParams.contentMarkedFriendFamily&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FRIENDS_AND_FAMILY"}),value:"family_and_friends"}),this.guestPassParams.contentMarkedFamily&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FAMILY"}),value:"family"}),this.guestPassParams.contentMarkedFriends&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_FRIENDS"}),value:"friends"})),this.guestPassParams.contentMarkedPublic&&this.PERMISSIONS.push({text:this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"}),value:"public"}),this.isMine=t.isMine||!1,this.cancel=!1,this.guestPasses={},this.flickrShare={recipients:[],guestpassStr:this.PERMISSIONS[0]?this.PERMISSIONS[0].value:"private"},this.appContext.flipper.isFlipped("enable-share-restyle")&&(l=e.StorageHelper.getItem("embedr-options")?JSON.parse(e.StorageHelper.getItem("embedr-options")):l),t.canVr?l.vr="true":l.vr="false",this},loadState:function(){var t=[],i=this;if(this.appContext.getViewer().nsid&&t.push(this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){i.set("me",e)})),this.guestPassParams.shareToAll)Object.keys(this.signedOutSharingPerms).forEach(function(e){i.networkClasses[e].canShare=!0});else if(this.guestPassParams.shareToSpecific)Object.keys(this.guestPassParams.shareToSpecific).forEach(function(e){i.networkClasses[e].canShare=i.guestPassParams.shareToSpecific[e].canShare,i.networkClasses[e].canNotShareTitle=i.guestPassParams.shareToSpecific[e].canNotShareTitle});else{var s={};s[this.emailShareParams.modelName+"_id"]=this.emailShareParams.modelId,this.emailShareParams.modelOwnerId&&(s.owner_id=this.emailShareParams.modelOwnerId),t.push(this._loadSharingPermissionsFromAPI(s))}return e.Promise.all(t)},_loadSharingPermissionsFromAPI:function(e){var t=this;return e.breakCache=(new Date).toISOString(),this.appContext.callAPI("flickr.sharing.canShare",e).then(function(e){e&&e.services&&e.services.service&&e.services.service.forEach(function(e){Object.keys(t.networkClasses).some(function(i){if(t.networkClasses[i].serviceId===e.serviceTypeId){if(t.networkClasses[i].canShare=!!e.canShare,"flickr"===i&&!1===t.appContext.getViewer().signedIn&&(t.networkClasses[i].canShare=!1),e.canShare||(t.networkClasses[i].canNotShareTitle=e.reason.map(function(e){return e.content}).join(", ")),130===e.serviceTypeId&&e.reason&&e.reason.length&&e.reason.some(function(e){return 3===e.code}))return t.cancelMessage=t.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_RESTRICTED"}),t.cancel=!0,!0;if(130===e.serviceTypeId){if(t.PERMISSIONS.length&&"public"!==t.PERMISSIONS[t.PERMISSIONS.length-1].value&&(t.guestpassRequired=!0),e.availableGuestpasses){1===e.guestpassRequired&&t.PERMISSIONS.length&&"public"===t.PERMISSIONS[t.PERMISSIONS.length-1].value&&t.PERMISSIONS.shift(),1===e.guestpassRequired&&(t.guestpassRequired=!0,t.guestPassParams=t.guestPassParams||{},t.guestPassParams.contentMarkedPublic=!1,t.guestPassParams.nonPublicWarning=!0);var s=!1,a=!1,n=!1;e.availableGuestpasses.guestpass.forEach(function(e){"friends"===e.content&&(s=!0),"family"===e.content&&(a=!0),"private"===e.content&&(n=!0)});for(var r=0;r<t.PERMISSIONS.length;)"friends"===t.PERMISSIONS[r].value&&!s||"family"===t.PERMISSIONS[r].value&&!a||"family_and_friends"===t.PERMISSIONS[r].value&&!a&&!s||"private"===t.PERMISSIONS[r].value&&!n?t.PERMISSIONS.splice(r,1):r++}else t.PERMISSIONS.length&&"public"===t.PERMISSIONS[t.PERMISSIONS.length-1].value&&(t.PERMISSIONS=[t.PERMISSIONS[0]]);t.flickrShare.guestpassStr=t.PERMISSIONS[0]?t.PERMISSIONS[0].value:"private"}return!0}return!1})})},function(e){s.error("Error reading canShare permissions",{err:e}),Object.keys(t.signedOutSharingPerms).forEach(function(e){t.networkClasses[e].canShare=t.signedOutSharingPerms[e].canShare})})},buildContainer:function(){var t,i=this.guestPassParams.showGuestPassDropdown&&this.isMine&&!!this.guestPassParams.type||!this.guestPassParams.contentMarkedPublic,s="";if(this.cancel)return this.setContainerWithTemplate("fluid-share-panel-error",{errorMessage:this.cancelMessage||this.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:this.guestPassParams.multipleItems?2:1})}),this;if(this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams),s="macintosh"===e.UA.os?this.intlMessage({intlName:"share-modal.COPY_MAC"}):this.intlMessage({intlName:"share-modal.COPY_PC"}),t={networkClasses:this.networkClasses,linkShareDisplay:this.linkShareDisplay,privacyWarningString:this.linkShareParams.privacyWarningString,downloadAccessString:this.linkShareParams.downloadAccessString,showDownloadWarning:this.linkShareParams.showDownloadWarning,shareItemCount:this.shareItemCount,grabLink:this.guestPassParams.contentMarkedPublic||this.linkShareParams.generateLink?this.linkShareParams.shortURL:null,canHaveGuestpass:i,emailShareParams:this.emailShareParams,showMailPerms:this.guestPassParams.showGuestPassDropdown&&this.isMine&&this.guestPassParams.multipleItems&&this.PERMISSIONS.length>0,nonPublicWarning:this.guestPassParams.nonPublicWarning,grabLinkDefaultPermission:(i&&this.PERMISSIONS.length)>0?this.PERMISSIONS[0].text:"",copyMessage:s,choiceOfPermission:this.PERMISSIONS.length>1,displayOptions:l,showSlideshowOption:void 0!==this.linkShareParams.albumId||void 0!==this.linkShareParams.galleryId,isEdge:this.appContext.getUA().isEdge},this.linkShareDisplay.embedr){var a,n=0,o=e.StorageHelper.getItem("fluid-share-panel-embedr-default-size");this.linkShareDisplay.embedr.sizes.forEach(function(e,t){if(o&&e.sizeKey===o&&(n=t,a=!0),!a){r.indexOf(e.sizeKey)>n&&(n=t)}}),t.defaultSizeStr=this.linkShareDisplay.embedr.sizes[n].sizeStr,t.defaultEmbedrCode=this.linkShareDisplay.embedr.sizes[n].embedCode,e.StorageHelper.setItem("fluid-share-panel-embedr-default-size",this.linkShareDisplay.embedr.sizes[n].sizeKey)}if(this.linkShareDisplay.bbCode){var h,d=0,c=e.StorageHelper.getItem("fluid-share-panel-bbCode-default-size");this.linkShareDisplay.bbCode.sizes.forEach(function(e,t){if(c&&e.sizeKey===c&&(d=t,h=!0),!h){r.indexOf(e.sizeKey)>d&&(d=t)}}),t.defaultBBCode=this.linkShareDisplay.bbCode.sizes[d].embedCode,t.defaultBBCodeSizeStr=this.linkShareDisplay.bbCode.sizes[d].sizeStr}if(this.linkShareDisplay.iframe){var m,u=0,p=e.StorageHelper.getItem("fluid-share-panel-iframe-default-size");this.linkShareDisplay.iframe.sizes.forEach(function(e,t){if(p&&e.sizeKey===p&&(u=t,m=!0),!m){r.indexOf(e.sizeKey)>u&&(u=t)}}),t.defaultIframeSizeStr=this.linkShareDisplay.iframe.sizes[u].sizeStr,t.defaultIframeCode=this.linkShareDisplay.iframe.sizes[u].embedCode}return this.linkShareDisplay.bbCode||this.linkShareDisplay.embedr||this.linkShareDisplay.iframe||(t.hideButtons=!0),t.moveInstructionsUp=t.hideButtons&&!t.canHaveGuestpass&&!t.choiceOfPermission,this.appContext.flipper.isFlipped("enable-share-restyle")?this.setContainerWithTemplate("fluid-share-panel-restyle",t):this.setContainerWithTemplate("fluid-share-panel",t),this},additionalViewClasses:function(){var e=[];return this.appContext.flipper.isFlipped("enable-share-restyle")&&e.push("restyle"),e},activate:function(){var i=this.get("container"),s=this;if(this.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),s.fire("subviewViewEvent","done-sharing")},".done-sharing")),this.guestpassRequired&&this.fire("subviewViewEvent","guestpass-required"),this.cancel)return this;this.dropdowns={},this.linkShareDisplay||(this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams)),this.registerEventHandler(e.globalEvents.subscribe("window:keydown",function(t){(t.e.ctrlKey||t.e.metaKey)&&67===t.e.keyCode&&e.rapidTracker.beacon(s.name,"linkCopied-"+e.StorageHelper.getItem("fluid-share-panel-first-selected"))})),this.registerEventHandler(i.delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),s._toggleLinkSelection(e,i))},".link-type-button")),this.registerEventHandler(i.delegate("change",function(e){e.currentTarget.getDOMNode().checked?(i.one(".embed-privacy-container").addClass("hide"),i.one(".embed-options-container").removeClass("hide")):(i.one(".embed-privacy-container").removeClass("hide"),i.one(".embed-options-container").addClass("hide"))},".embed-guestpass-checkbox")),this.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),s._createdDropdownForEmbedIframeBB.bind(s)(e,i)},".embed-size-field")),this.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),s._createGrabLinkPermissionDropdown(e,i)},".grab-link-field")),this.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),s._createMailPermissionDropdown(e,i)},".mail-perm-field")),this.registerEventHandler(i.delegate("click",function(e){s.selectInput(e.target)},".bb-code-text-field, .grab-link-text-field, .embed-code-text-field")),e.use("event-touch",function(e){s.registerEventHandler(e.one("."+t).delegate("touchend",function(e){s.selectInput(e.target)},".bb-code-text-field, .grab-link-text-field, .embed-code-text-field"))}),this.registerEventHandler(i.delegate("click",function(t){s.networkClasses&&t.target.ancestor("."+s.networkClasses.flickr.className,!0)&&(t.preventDefault(),i.one(".share-panels").addClass("show-email-form"),e.rapidTracker.beacon(s.name,"emailTabClick"))},".share-link.sharing-type-enabled")),!this.appContext.flipper.isFlipped("enable-share-restyle")&&i.one(".leave-email-sharing")&&this.registerEventHandler(i.one(".leave-email-sharing").on("click",function(e){e.preventDefault(),i.one(".share-panels").removeClass("show-email-form")})),i.one(".share-by-email")&&this.registerEventHandler(i.one(".share-by-email").on("click",function(e){e.preventDefault(),s._onShareByEmail(e)})),s.appContext.flipper.isFlipped("enable-embedr-in-share")&&s.appContext.flipper.isFlipped("enable-share-restyle")&&this.registerEventHandler(i.delegate("change",function(e){e.halt(),s._updateEmbedrOptions(e)},".embed-options input")),this.setupEmailSharing();var a=this.PERMISSIONS[0].value;if(!this.linkShareParams.generateLink&&((this.appContext.flipper.isFlipped("enable-public-guestpass")||this.guestpassRequired)&&this.isMine&&-1===this.linkShareParams.url.indexOf("favorites")||"public"!==a)){"public"!==a&&i.one(".grab-link-privacy-reminder").removeClass("hide-reminder");var n=[1,1,1];"friends"===a?n=[0,1,0]:"family"===a?n=[1,0,0]:"family_and_friends"===a&&(n=[1,1,0]),this.requestGuestpass.apply(this,n)}if(this.linkShareParams.generateLink&&(i.one(".grab-link-privacy-reminder").removeClass("hide-reminder"),this.generatingLink||(this.generatingLink=!0,this.startGuestpassLoader(),this.fire("subviewViewEvent","generate-link"))),!this.appContext.flipper.isFlipped("enable-share-restyle")){var r=e.OverflowHelper.detectScrollbarSize(e.one("body"));i.one(".message-form")&&i.one(".message-form").setStyle("paddingRight",r+"px"),i.one(".share-by-email")&&i.one(".share-by-email").setStyle("marginRight",r+"px"),i.one(".share-panel-body")&&i.one(".share-panel-body").setStyle("paddingRight",r+"px")}return this.setHighlightWidths(),i.one(".grab-link-download-reminder a").addClass("tabbable"),this},onParentViewEvent:function(t,i){var s=this.get("container"),n=s.one(".grab-link-text-field"),r=e.StorageHelper.getItem("fluid-share-panel-first-selected")||"grabLinkItem";if("flickr-share-error"===i[0])this._onWarning(this.intlMessage({intlName:"share-modal.FLICKR_SHARE_ERROR"}));else if("flickr-share-success"===i[0]){var l=s.one(".fake-input");l.removeClass("not-empty"),l.all(".pill").remove(),s.one(".email-message-text-field").set("value",""),s.one(".email-recipient-text-field").setStyle("width","inherit"),s.one(".share-by-email").set("disabled",!0),this.contacts.resetSearch(),this.to={},this.flickrShare.recipients=[],this._onWarning(this.intlMessage({intlName:"share-modal.FLICKR_SHARE_SUCCESS"}),this.intlMessage({intlName:"share-modal.FLICKR_SHARE_SUCCESS_TITLE"}),!0)}else if("guestpass-created"===i[0]){this.guestPasses[""+i[1]]=i[2],n.set("value",i[2]),"grabLinkItem"===r&&this.selectInput(n),this.endGuestpassLoader();var o=s.one(".embed-code-text-field");if(o){var h=s.one(".embed-code-text-field").get("value"),d=/href=".*?"/,c='href="'+i[2]+'"';o.set("value",h.replace(d,c)),this.linkShareParams.url=a(i[2]).pathname,this.linkShareDisplay.embedr.sizes.forEach(function(e){e.embedCode&&(e.embedCode=e.embedCode.replace(d,c))}),this.linkShareDisplay.embedr.sizes=this.linkShareDisplay.embedr.sizes.filter(function(e){return"o"!==e.sizeKey})}}else"guestpass-failed"===i[0]?(s.one(".grab-link-permission-label")&&s.one(".grab-link-permission-label").set("text",this.intlMessage({intlName:"share-modal.SHARE_PUBLIC_ONLY"})),n.set("value",this.linkShareParams.shortURL),this.endGuestpassLoader(),this._onWarning(this.intlMessage({intlName:"share-modal.GUESTPASS_CREATION_FAILURE"}))):"generated-link"===i[0]&&(s.one(".grab-link-text-field").set("text",i[1]),n.set("value",i[1]),this.selectInput(n),this.endGuestpassLoader())},setHighlightWidths:function(){var t,i,s,a,n=this.get("container"),r=n.one(".link-type-highlight"),l=0,o=n.one(".link-grab-type-button").getDOMNode().offsetLeft,h=e.StorageHelper.getItem("fluid-share-panel-first-selected")||"grabLinkItem";for(t=[{name:"grabLinkItem",element:n.one(".link-grab-type-button")},{name:"embedItem",element:n.one(".embed-type-button")},{name:"iframeItem",element:n.one(".iframe-type-button")},{name:"emailItem",element:n.one(".email-type-button")},{name:"bbCodeItem",element:n.one(".bbcode-type-button")}],this.highlightWidths={},a=0;a<t.length;a++)(s=t[a]).element?(l=parseInt(s.element.get("clientWidth"),10),this.highlightWidths[s.name]={width:l,left:o+"px"},o+=l+24):s.name===h&&(h="grabLinkItem");1===Object.keys(this.highlightWidths).length&&(h="grabLinkItem"),i=t.filter(function(e){return e.name===h})[0].element,r.setStyles(this.highlightWidths[h]),this._toggleLinkSelection({target:i},n)},_toggleLinkSelection:function(t,i){var s,a=i.one(".link-type-highlight"),n=t.target.ancestor(".link-type-buttons",!0).get("children").indexOf(t.target);i.one(".share-link-types").toggleClass("first-stop",0===n).toggleClass("second-stop",1===n).toggleClass("third-stop",2===n).toggleClass("fourth-stop",3===n),t.target.hasClass("link-grab-type-button")?(s=this.highlightWidths.grabLinkItem,this.selectInput(i.one(".grab-link-text-field")),e.StorageHelper.setItem("fluid-share-panel-first-selected","grabLinkItem"),e.rapidTracker.beacon(this.name,"grabLinkTabClick"),this.manageTabbables(".grab-link-only")):t.target.hasClass("embed-type-button")?(s=this.highlightWidths.embedItem,this.linkShareParams.isNonPublic||this.selectInput(i.one(".embed-code-text-field")),e.StorageHelper.setItem("fluid-share-panel-first-selected","embedItem"),e.rapidTracker.beacon(this.name,"embedTabClick")):t.target.hasClass("iframe-type-button")?(s=this.highlightWidths.iframeItem,this.selectInput(i.one(".iframe-code-text-field")),e.StorageHelper.setItem("fluid-share-panel-first-selected","iframeItem"),e.rapidTracker.beacon(this.name,"iframeTabClick")):t.target.hasClass("bbcode-type-button")?(s=this.highlightWidths.bbCodeItem,this.selectInput(i.one(".bb-code-text-field")),e.StorageHelper.setItem("fluid-share-panel-first-selected","bbCodeItem"),e.rapidTracker.beacon(this.name,"bbCodeTabClick")):t.target.hasClass("email-type-button")&&(this.appContext.getViewer().signedIn?(s=this.highlightWidths.emailItem,e.StorageHelper.setItem("fluid-share-panel-first-selected","emailItem"),e.rapidTracker.beacon(this.name,"emailTabClick")):this.fire("subviewViewEvent","confirm-sign-in"),this.manageTabbables(".email-sharing-panel")),a.setStyles(s)},_createDropdown:function(t,i,s,a,n){var r=this;n&&!n.isClosed||((n=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,hideModalOverlay:!0,classList:"over-modal",overlayClassList:"over-modal",anchorElement:t.one("."+i+" .dropdown-arrow"),observePageResize:!0,menuItems:s,forceLeft:!0,anchorOffsetHorizontal:16,closeOnResize:!0})).on("selected",function(e){n.close(),a.bind(r)(e),r.setHighlightWidths()}),n.show())},_createdDropdownForEmbedIframeBB:function(t,i){var s,a,l,o;t.target.ancestor(".embed-size-field",!0).hasClass("embed-code-size-field")?(s="embed-code-size-field",a="embedr"):t.target.ancestor(".embed-size-field",!0).hasClass("iframe-code-size-field")?(s="iframe-code-size-field",a="iframe"):t.target.ancestor(".embed-size-field",!0).hasClass("bb-code-size-field")&&(s="bb-code-size-field",a="bbCode"),l=this.linkShareDisplay[a].sizes,o=r.concat(["o"]),this._createDropdown(i,s,Object.keys(l).map(function(e){return{text:l[e].sizeStr,value:l[e].sizeKey}}).sort(function(e,t){return o.indexOf(e.value)<o.indexOf(t.value)?-1:1}),function(t){var r;t&&t.menuItem&&(l.some(function(e){return e.sizeKey===t.menuItem.value&&(r=e.sizeKey,i.one("."+n[s]).set("value",e.embedCode),i.one("."+s).one(".embed-code-label").set("text",e.sizeStr),!0)}),e.StorageHelper.setItem("fluid-share-panel-"+a+"-default-size",r))},this.dropdowns[a])},_createGrabLinkPermissionDropdown:function(e,t){var i=this;this._createDropdown(t,"grab-link-field",this.PERMISSIONS,function(e){if(e&&e.menuItem){var s=e.menuItem.value,a=t.one(".grab-link-text-field"),n=t.one(".grab-link-privacy-reminder");if(t.one(".grab-link-permission-label").set("text",e.menuItem.text),"public"===s)a.set("value",i.linkShareParams.shortURL),n.addClass("hide-reminder");else{var r=0,l=0,o=0;"friends"===s?r=1:"family"===s&&(l=1),"family_and_friends"===s?(l=1,r=1):"private"===s&&(o=1),n.removeClass("hide-reminder"),i.requestGuestpass(l,r,o)}}},this.dropdowns.grabLink)},_createMailPermissionDropdown:function(e,t){var i=this;this._createDropdown(t,"mail-perm-field",this.PERMISSIONS,function(e){e&&e.menuItem&&(t.one(".mail-permission-label").set("text",e.menuItem.text),i.flickrShare.guestpassStr=e.menuItem.value)},this.dropdowns.mail)},_onShareByEmail:function(e){this.fire("subviewViewEvent","share-by-email",{recipients:this.flickrShare.recipients,guestpassStr:this.flickrShare.guestpassStr,message:this.get("container").one(".email-message-text-field").get("value")})},manageTabbables:function(e){var t=this.get("container");t.all(".link-type-content:not("+e+") .tabbable").setAttribute("tabindex","-1"),t.all(e+" .tabbable").setAttribute("tabindex","0")},generateLinkSharingDisplay:function(t){var s=this,a={link:t.url,isNonPublic:t.isNonPublic},n=t.sizes?Object.keys(t.sizes):[];return n.length>0&&t.supportsEmbedr&&(s.appContext.flipper.isFlipped("enable-embedr-in-share")?a.embedr={sizes:Object.keys(t.sizes).map(function(a){return{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-embedr-code")({embedLink:e.url(t.url),title:t.title,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),width:t.sizes[a].width,height:t.sizes[a].height,alt:t.title,displayOptions:l,showSlideshowOption:void 0!==s.linkShareParams.albumId||void 0!==s.linkShareParams.galleryId})}})}:(a.embedr={sizes:Object.keys(t.sizes).map(function(a){return{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-old-html-embed-code")({embedLink:e.url(t.url),title:t.title,authorName:t.author,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),width:t.sizes[a].width,height:t.sizes[a].height,alt:t.title})}})},a.iframe={sizes:Object.keys(t.sizes).map(function(a){var n;return"/"!==(n=e.config.win.location.href)[n.length-1]&&(n+="/"),n+="player/",{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-old-iframe-embed-code")({embedLink:n,title:t.title,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),width:t.sizes[a].width,height:t.sizes[a].height,alt:t.title})}})})),n.length>0&&t.supportsBBCode&&(a.bbCode={sizes:Object.keys(t.sizes).map(function(a){return{sizeKey:a,sizeStr:s.getSizeStr(a)+" "+t.sizes[a].width+" × "+t.sizes[a].height,embedCode:s.templates("fluid-share-bb-code")({title:t.title,farmURL:e.URLHelper.addProtocolToURL(i(t.sizes[a])),shortURL:t.shortURL,authorURL:e.url(t.authorURL),authorName:t.author})}})}),a},getSizeStr:function(e){var t="";return["sq","q"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.SQUARE"}):"t"===e?t=this.intlMessage({intlName:"common.THUMBNAIL"}):["s","n"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.SMALL"}):["m","z","c"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.MEDIUM"}):["l","h","k"].indexOf(e)>-1?t=this.intlMessage({intlName:"common.LARGE"}):"o"===e&&(t=this.intlMessage({intlName:"common.ORIGINAL"})),t},requestGuestpass:function(e,t,i){var s=this.get("container").one(".grab-link-text-field"),a=""+e+t+i;if(this.guestPasses[a])s.set("value",this.guestPasses[a]);else{var n={is_private:i,is_family:e,is_friend:t},r=this.guestPassParams.type,l=this.guestPassParams.id;"photo"===r&&(n.photo=l),"photostream"===r&&(n.photostream=l),"set"===r&&(n.set=l),this.startGuestpassLoader(),this.fire("subviewViewEvent","request-guestpass",a,n)}},startGuestpassLoader:function(){var e=this;setTimeout(function(){if(!e.guestpassLoaded){var t=e.get("container").one(".grab-link-loader");t.setStyle("display","block"),t.addClass("show-loader")}},50)},endGuestpassLoader:function(){var e=this.get("container").one(".grab-link-loader");this.guestpassLoaded=!0,e.removeClass("show-loader"),setTimeout(function(){this.guestpassLoaded&&e.setStyle("display","none")}.bind(this),500)},setupEmailSharing:function(){var t=this.get("container"),i=t.one(".email-recipient-text-field"),s=this.fakeInput=t.one(".fake-input"),a=this.input=this.get("container").one('[data-field="recipient"]'),n=t.one(".email-message-text-field"),r=t.one(".share-by-email"),l=this;this.focus&&(setTimeout(function(){i.focus()},100),this.focus=!1),i&&(this.to={},this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),i.on("focus",function(){s.addClass("focus"),""===a.get("value")?l.contacts.hide():l.contacts.search(),l._adjustInputWidth()}),i.on("blur",function(){a.ancestor(".fake-input").one(".pill")||t.one(".email-recipient-text-field").setStyle("width","inherit")}),a.on("blur",function(){var e,t=!1;(e=l.contacts.selected)&&e.email&&(t=!0,l._makePill(e,t),l.contacts.selected=null,l.get("container").one(".fake-input").insertBefore(a,l.contacts.wrapperEl)),s.removeClass("focus")}),a.on("keydown",function(e){var t,i;8===e.keyCode?(""===this.get("value")&&(i=l.get("container").all(".pill").pop())&&i.fire("remove"),setTimeout(function(){l._adjustInputWidth()},0)):(13===e.keyCode||9===e.keyCode&&!e.shiftKey||32===e.keyCode||188===e.keyCode)&&((t=l.contacts.selected)&&t.email?(e.preventDefault(),l._makePill(t),l.contacts.selected=null,l._arrangeInput()):13!==e.keyCode||l.contacts.selected||(e.preventDefault(),""===this.get("value")&&l.get("container").one('[data-field="message"]').focus()))}),a.on("keypress",function(e){var t=this.get("value");l._adjustInputWidth(t+String.fromCharCode(e.which)),l.contacts._reposition(),this.show()}),a.on("keyup",function(t){0===e.Object.size(l.to)&&""===l.input.get("value")?r.setAttribute("disabled",!0):r.removeAttribute("disabled"),8===t.keyCode&&""===this.get("value")&&l._arrangeInput()}),n.on("keydown",function(e){9!==e.keyCode||e.shiftKey||(e.preventDefault(),r.focus())}),this.appContext.flipper.isFlipped("enable-share-restyle")||n.on("keyup",function(t){var i=""===n.get("value").trim(),s=0===e.Object.size(l.to)&&""===l.input.get("value");i||s?r.setAttribute("disabled",!0):r.removeAttribute("disabled")}),s.delegate("click",function(e){l._arrangeInput()},".fake-input"),s.delegate("mouseover",function(e){var t=e.currentTarget,i=s.get("clientWidth"),a=t.get("offsetLeft"),n=parseInt(t.getComputedStyle("width").replace("px",""),10);l.appContext.flipper.isFlipped("enable-share-restyle")&&(a=t.get("offsetLeft")-s.get("offsetLeft")),i-a-n-10>0?(t.addClass("not-eol"),t.removeClass("end-of-the-line")):(t.removeClass("not-eol"),t.addClass("end-of-the-line"))},".pill"),this.contacts=new e.ContactSearchBox({el:i,appContext:this.appContext,shim:"c-contact-search-shim",signedOut:!this.appContext.getViewer().signedIn,alwaysDownward:!0,DOMContainer:t.one(".share-panel-body").getDOMNode(),loadingState:this.templates(e.Balls())(),onError:function(){i.blur(),l.contacts.hide()},onShow:function(e){var t=l.get("container"),i=l.get("container").one(".contact-list");t.on("click",function(e){"INPUT"!==e.target.get("tagName")&&"block"===i.getStyle("display")&&l.contacts.hide()})},onSelect:function(e,t){e&&e.nsid&&(l._makePill(e),l._arrangeInput())},dialogOffset:function(){var e=l.fakeInput.getDOMNode().getBoundingClientRect(),t=l.input.getDOMNode().getBoundingClientRect();return e.height-t.height+10}}))},_adjustInputWidth:function(t){var i,s,a,n=this.get("container"),r=n.one(".share-by-email"),l=this;return t=t||this.input.get("value"),0===e.Object.size(this.to)&&""===t?((s=n.one(".fake-input")).removeClass("not-empty"),i=s.get("clientWidth"),""!==n.one(".email-message-text-field").get("value").trim()&&r.setAttribute("disabled",!0),this.input.setStyle("width",i-20),setTimeout(function(){l.input.focus()},10),i):((a=e.Node.create('<span class="width-check"></span>')).set("innerHTML",escape(t)),this.get("container").appendChild(a),i=a.get("clientWidth")||0,a.remove(),this.input.setStyle("width",(i||30)+5+"px"),setTimeout(function(){l.input.focus()},10),i)},_makePill:function(e,t){var i,s=escape(e.realname||e.email),a=this.templates("share-modal-mail-pill")({value:s}),n=this.get("container"),r=n.one(".share-by-email"),l=n.one(".fake-input"),o=this;l.addClass("not-empty"),""!==n.one(".email-message-text-field").get("value").trim()&&r.removeAttribute("disabled"),this.to[s]=e,o.completeSameEvent&&o.completeSameEvent.detach(),(i=l.insertBefore(a,this.contacts.wrapperEl)).on("remove",function(t){e.nsid?o.contacts.showInSearch(e.nsid):e.email&&!t&&(o.input.set("value",i.one("span:first-child").get("innerHTML")),o._adjustInputWidth()),delete o.to[s],i.remove(),o.flickrShare.recipients.some(function(t,i){return!!(t.nsid&&t.nsid===e.nsid||!t.nsid&&t.name&&t.name===e.name)&&(o.flickrShare.recipients.splice(i,1),!0)})}),i.delegate("click",function(e){e.stopPropagation(),i.fire("remove",!0),o.input.focus()},".remove-tag"),i.on("dblclick",function(t){t.stopPropagation();var a=o.input;a.set("value",s),o._adjustInputWidth(s),i.replace(a),i.fire("remove"),setTimeout(function(){a.focus()},10),o.contacts.search(),o.completeSameEvent=a.once("blur",function(t){a.get("value")===s&&(o._makePill(e),o.input.set("value",""),o._arrangeInput())})}),e.nsid&&this.contacts.hideFromSearch(e.nsid),this.flickrShare.recipients.push(e),this.input.set("value",""),t||(this.input.focus(),o._adjustInputWidth())},_arrangeInput:function(){var e=this.input;this.get("container").one(".fake-input").insertBefore(e,this.contacts.wrapperEl),setTimeout(function(){e.focus()},10)},_onWarning:function(t,i,s){var a=e.Node.create(this.templates("fluid-warning")({message:t,title:i})),n=e.Node.create("<div></div>"),r=this.get("container"),l=this,o=(r.get("clientWidth")+20)/2-260,h=(r.get("clientHeight")+20)/2-60;a.setStyle("width",500),a.setStyle("height",100),a.setStyle("left",o),a.setStyle("top",h),n.setStyle("left",0),n.setStyle("top",0),n.setStyle("width","100%"),n.setStyle("height","100%"),n.addClass("warning-modal"),r.append(n),n.append(a),n.on("click",function(){n.remove(!0),s&&l.fire("subviewViewEvent","closeAll")})},_updateEmbedrOptions:function(t){var i=t.target.getData("setting"),s=t.target.getDOMNode().checked,a=this.get("container"),r=e.StorageHelper.getItem("fluid-share-panel-embedr-default-size"),o=a.one(".embed-demo-container");l[i]=s?"true":"false",this.linkShareDisplay=this.generateLinkSharingDisplay(this.linkShareParams),this.linkShareDisplay.embedr.sizes.some(function(e){if(e.sizeKey===r)return a.one("."+n["embed-code-size-field"]).set("value",e.embedCode),a.one(".embed-code-size-field").one(".embed-code-label").set("text",e.sizeStr),!0}),"true"===l.header?o.addClass("show-header"):o.removeClass("show-header"),"true"===l.footer?o.addClass("show-footer"):o.removeClass("show-footer"),this.selectInput(a.one(".embed-code-text-field")),e.StorageHelper.setItem("embedr-options",JSON.stringify(l))},selectInput:function(e){e.getDOMNode&&(e=e.getDOMNode()),e.setSelectionRange&&e.setSelectionRange(0,999)}})},"@VERSION@",{requires:["flickr-view","promise","hermes-template-fluid-share-panel","hermes-template-fluid-share-panel-restyle","fluid-droparound-view","hermes-template-fluid-share-embedr-code","hermes-template-fluid-share-bb-code","hermes-template-share-modal-mail-pill","hermes-template-fluid-warning","hermes-template-fluid-share-panel-error","hermes-template-fluid-share-old-html-embed-code","hermes-template-fluid-share-old-iframe-embed-code","fluid-modal-view","contact-search-box","html5-balls","overflow-helper","url-helper","storage-helper"],optionalRequires:["global-events"],langBundles:["share-modal","common"]});YUI.add("hermes-lang-share-modal",function(e,o){e.Intl.add("hermes/share-modal","en-US",{SHARE_ON_BLOGGER:["Share on Blogger"],SHARE_PHOTO:["Share Photo"],SHARE_PHOTOS:["Share photos"],SHARE_VIDEO:["Share Video"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_BLOGGER:["please authorize Flickr to post on Blogger"],SHARE_ON_FACEBOOK:["Share on Facebook"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_FACEBOOK:["please authorize Flickr to post on Facebook"],SHARE_VIA_MAIL:["Share via mail"],SHARE_ON_TUMBLR:["Share on Tumblr"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TUMBLR:["please authorize Flickr to post on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],SHARE_ON_TWITTER:["Share on Twitter"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_PHOTOSTREAM:["Share photostream"],SHARE_ALBUM:["Share album"],SHARE_FAVORITES:["Share favorites"],AUTHORIZE_TO_SHARE:["You need to authorize Flickr to share photos on ","${service}"],CONNECT_TO_SERVICE:["Connect to ","${service}"],OK_TAKE_ME_TO_MY_SETTINGS:["OK, take me to my settings"],POST:["Post"],SHARE:["Share"],FRIENDS:["Friends"],FAMILY:["Family"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],INCLUDE_A_MESSAGE:["Include a message"],SHARE_THIS_VIA:["Share this via..."],SHARE_PREFERENCES:["share preferences"],GRAB_THE_LINK:["Grab the link"],SHOW_SHORT_URL:["show short URL"],INCLUDE_CONTENT_MARKED_AS:["Include content marked as:"],PS_ITEMS_NOT_PUBLIC:["Some of the items in your photostream aren't public."],HERE_IS_PS_LINK:["Here's a link to this photostream. Just copy and paste!"],YOU_CAN_ADD_GUEST_PASS:['You can add a Guest Pass [<a class="guest-pass-link" title="',"${title}",'" data-action="follow" href="/help/sharing/#2184">?</a>] so that recipients can view them.'],ADD_A_GUEST_PASS:["Add a guest pass"],GUEST_PASS_COPY:["Guest Passes let you share your photos that aren't public. Anyone can see your public photos anytime, whether they're a Flickr member or not. But! If you want to share photos marked as friends, family or private, use a Guest Pass. If you're sharing photos from a set, you can create a Guest Pass that includes any of your photos marked as friends, family, or private. If you're sharing your entire photostream, you can create a Guest Pass that includes photos marked as friends or family (but not your private photos)."],VISIT_GUESTPASS_HISTORY:['You can visit your <a href="/invite/history/guests/" data-action="follow">Guest Pass history</a> at any time to expire the Guest Pass.'],SOMETHING_WRONG:["Something went wrong.<br>Please refresh your browser and try again."],ERROR:["Error"],OK:["OK"],SHARE_GROUP:["Share Group"],MESSAGE:["Message"],EMAIL:["Email"],SIGN_IN_TO_EMAIL:["You must be signed in to share a photo. Sign in and try again."],LINK_ACCOUNT:["Link Account"],ACCOUNT_SETTINGS:["Account Settings"],AUTHORIZE_FLICKR:["Authorize Flickr to use your account in the Account Settings page."],COPY_TO_CLIPBOARD:["Press Ctrl+C (Win) or Command+C (Mac) to copy this link when selected"],HTML_EMBED:["HTML Embed"],EMAIL_BODY_PHOTOS:["${username}"," shared ",{type:"plural",valueName:"count",options:{one:"${#} photos",other:"${#} photo"}}," with you!"],EMAIL_BODY_ALBUM:["${username}"," shared an album with you!"],EMAIL_BODY_PHOTOSTREAM:["${username}"," shared their photostream with you!"],SHARE_PHOTOS_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} photo to:",other:"Share ${#} photos to:"}}],SHARE_VIDEO_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} video to:",other:"Share ${#} videos to:"}}],SHARE_PHOTOSTREAM_TO:["Share photostream to:"],SHARE_ALBUM_TO:["Share album to:"],SHARE_GALLERY_TO:["Share gallery to:"],SHARE_FAVES_TO:["Share favorites to:"],SHARE_ALBUMS_TO:["Share albums to:"],SHARE_GROUP_TO:["Share group to:"],FACEBOOK:["Facebook"],TUMBLR:["Tumblr"],TWITTER:["Twitter"],PINTEREST:["Pinterest"],MAIL:["Mail"],EMBED:["HTML embed"],EMBED_SIMPLE:["Embed"],HTML:["HTML"],GRAB_LINK:["Grab link"],BBCODE:["BBCode"],VIA_FLICKR:["Via Flickr:"],SHARE_PUBLIC_ONLY:["Public photos only"],SHARE_FRIENDS:["Include photos marked Friends"],SHARE_FAMILY:["Include photos marked Family"],SHARE_FAMILY_AND_FRIENDS:["Include photos marked Family & Friends"],SHARE_FRIENDS_AND_FAMILY:["Include photos marked Friends & Family"],SHARE_PRIVATE:["All photos - public and private"],SHARING_DISABLED:["Sharing is disabled"],ON_FLICKR:["on Flickr"],PHOTO_PRIVATE_MESSAGE:['This photo is private. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FRIENDS_MESSAGE:['This photo is only visible to friends. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_MESSAGE:['This photo is only visible to family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_FRIENDS_MESSAGE:['This photo is only visible to friends & family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_CAMERAROLL_MESSAGE:["All photos being shared will be viewable by the recipient(s) regardless of privacy level."],GUESTPASS_CREATION_FAILURE:["There was an error generating the share link.  Please try again."],CONTACT_SEARCH_ERROR:["There was an error when adding a recipient. Please try again."],FLICKR_SHARE_ERROR:["There was an error sharing on Flickr. Please try again."],FLICKR_SHARE_SUCCESS:["Your items have been shared!"],FLICKR_SHARE_SUCCESS_TITLE:["Success"],CLICK_GENERATE_LINK:["Click to generate a shareable link"],FLICKR_SHARE:["Share"],COPY_MAC:["Press Command+C to copy this link when selected"],COPY_PC:["Press Ctrl+C to copy this link when selected"],CANCEL_SHARE_BECAUSE_ERROR:[{type:"plural",valueName:"photoCount",options:{one:"This photo cannot be shared. Please try again later.",other:"These photos cannot be shared. Please try again later."}}],LINK_PRIVACY_REMINDER:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this selection will remain private. Only people you share this link with will be able to view it.",other:"The private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],PHOTO_PAGE_PRIVACY_WARNING:["This photo will remain private. Only people you share this link with will be able to view it."],CAMERAROLL_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"This photo will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],ALBUM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this album will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this album will remain private. Only people you share this link with will be able to view them."}}],PHOTOSTREAM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in your photostream will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in your photostream will remain private. Only people you share this link with will be able to view them."}}],CANCEL_SHARE_BECAUSE_RESTRICTED:["Sorry! You can't share restricted photos."],NO_SHAREABLE_ITEMS:["There are no items available to share."],CANT_SHARE_PRIVATE_GROUP_MESSAGE:['Private groups can only be viewed by the group\'s members. <a data-action="follow" href="',"${inviteURL}","\">Invite friends</a> to join the group if you'd like to share it."],CANT_SHARE_PRIVATE_GROUP_TITLE:["Share a Private Group"],EMBEDR_OPTION_HEADER:["Header"],EMBEDR_OPTION_FOOTER:["Footer"],EMBEDR_OPTION_TRUNCATE:["Truncate"],EMBEDR_OPTION_SLIDESHOW:["Slideshow"],EMBEDR_CHANGE_PRIVACY_WARNING:['You\'re trying to embed one of your private photos! If you still want to embed this photo, you can make it public by selecting "Public" from the privacy menu at the bottom this page.'],ALBUM_DOWNLOAD_ACCESS_YOU:[{type:"plural",valueName:"photoCount",options:{one:"Only you will be able to download this photo.",other:"Only you will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FF:[{type:"plural",valueName:"photoCount",options:{one:"Only your friends and family will be able to download this photo.",other:"Only your friends and family will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FOLLOWING:[{type:"plural",valueName:"photoCount",options:{one:"Only people you follow will be able to download this photo.",other:"Only people you follow will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_MEMBERS:[{type:"plural",valueName:"photoCount",options:{one:"Only Flickr members will be able to download this photo.",other:"Only Flickr members will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_EVERYONE:[{type:"plural",valueName:"photoCount",options:{one:"Everyone will be able to download this photo.",other:"Everyone will be able to download these photos."}}],CHANGE_DOWNLOAD_PREF:["(<a href='","${url}","'>Change your download preferences</a>)"],EMBED_WITH_GUESTPASS:["Embed this photo with a guestpass"]})},"@VERSION@",{requires:["intl"]});YUI.add("fluid-share-view",function(e,r){var t=require("hermes-core/flog")(r),a={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}};a.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(a.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?caption={{tumblrCaption}}&tags={{tags}}&url={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"","en-us"===this.appContext.lang.toLowerCase()?this.isEnglishLang=!0:this.isEnglishLang=!1,this.errorTitle=this.intlMessage({intlName:"common.OOPS"}),this.errorMessage=this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"}),this.removeOverlayOnClose=e.removeOverlayOnClose,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerWithTemplate("fluid-share",e),this},activate:function(){var r=this.get("container"),t="."+a.css.shareBtn,s=r.one(t);return!s||!this.isEnglish&&this.isDisabled||this.registerEventHandler(r.delegate(["click","keydown"],function(r){"click"!==r.type&&13!==r.keyCode||(r.preventDefault(),e.rapidTracker.beacon(this.subClassName,"shareButtonClick"),this.getItemCount().then(function(r){e.rapidTracker.beacon(this.subClassName,"shareButtonClickCount",{count:r})}.bind(this)),this.prepareModal(s))},t,this)),this},prepareModal:function(r){if(!this.shouldCancelModal())return this.getItemCount().then(function(t){return this.isDisabled?e.Promise.resolve(this.showErrorModal()):e.Promise.resolve(this.showModal(r,t,this.removeOverlayOnClose))}.bind(this)).catch(function(e){t.error({err:e})})},showModal:function(r,t,s){var i,n=this,o=this.getIsMine(),l=a.css.networkClasses,c=n.getTitleIntlKey(),h={intlName:"share-modal."+c};return"SHARE_PHOTOS_TO"!==c&&"SHARE_VIDEO_TO"!==c||(h.count=t),(i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,title:n.intlMessage(h),classList:"modal-restyle "+n.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:n.appContext,networkClasses:l,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:o,shareItemCount:t,signedOutSharingPerms:this.getSignedOutSharingPerms(),canVr:this.get("canVr")}),removeOverlayOnClose:s})).registerEventHandler(i.get("container").delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),e.target.ancestor("."+l.facebook.className,!0)?n.preProcessShare(n.prepareFacebookShareParameters,n.shareToFacebook):e.target.ancestor("."+l.twitter.className,!0)?n.preProcessShare(n.prepareTwitterShareParameters,n.shareToTwitter):e.target.ancestor("."+l.tumblr.className,!0)?n.preProcessShare(n.prepareTumblrShareParameters,n.shareToTumblr):e.target.ancestor("."+l.pinterest.className,!0)&&n.preProcessShare(n.preparePinterestShareParameters,n.shareToPinterest))},".share-link.sharing-type-enabled")),i.on("share-by-email",function(r){var t=e.merge(n.prepareFlickrShareParameters(),r);n.shareToFlickr(i,t)}),i.on("done-sharing",function(r){i.close(),n.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")}),i.on("request-guestpass",function(e,r,t){n.requestGuestpass(i,r,t,!0)}),i.on("generate-link",function(){n.generateLink().then(function(e){i.fire("parentViewEvent","generated-link",e)})}),i.on("activated",function(){i.get("subview").cancel&&i.get("container").one(".title").setHTML(n.intlMessage({intlName:"common.OOPS"})),i.reposition()}),i.on("guestpass-required",function(){n.guestpassRequired=!0}),i.on("confirm-sign-in",function(){i.close();var r=new e.Views.FluidModal({appContext:n.appContext,title:n.intlMessage({intlName:"common.OOPS"}),message:n.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),classList:"sharing-sign-out-modal",showCancelButton:!0});r.on("actionClick",function(){e.StorageHelper.setItem("signedOutEmailSharing",new Date),e.SigninHelper.addPendingShare({shareType:"email"})}),setTimeout(function(){r.show()},10)}),i.on("close",function(){n.fire("sharePresentationClose"),n.guestPassURLs={},e.rapidTracker.beacon(n.name,"shareModalCancelClick")}),i.on("closeAll",function(){n.fire("sharePresentationClose"),i.close(),n.guestPassURLs={}}),i.show(),this.sharePresentation=i,i},showErrorModal:function(){var r=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,noScroll:!0,hideModalOverlay:!1,showFooter:!0,title:this.errorTitle,message:this.errorMessage});return r.show(),r},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!0},twitter:{canShare:!0},tumblr:{canShare:!0},pinterest:{canShare:!0},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(r,s){if(!r.url)return t.error("Error sharing to Facebook.  Missing url.");var i,n,o,l,c,h=encodeURIComponent(e.url(r.url)),u=this.guestPassURLs;this.guestpassRequired&&u&&(n=u[100],o=u["010"],l=u[110],c=u[111],o&&(h=o),n&&(h=n),l&&(h=l),c&&(h=c)),i=a.networks.facebook.shareUrl+h,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i),this.trackShareCompletion(s)},shareToTwitter:function(r,s){if(void 0===r.url||null===r.url)return t.error("Error sharing to Twitter.  Missing url.");if(!r.title)return t.error("Error sharing to Twitter.  Missing title.");var i,n,o,l,c=r.title;n=""===r.url?"":encodeURIComponent(r.url),(l=c+" "+a.networks.twitter.hashTags).length+n.length>140&&(o=l.length+n.length-140,l=c.substring(0,c.length-(o+1))+"… "+a.networks.twitter.hashTags),i=a.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(l)).replace("{{linkToShare}}",n),s?s.location.replace(i):s=this.createSharePopup(i),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:r.count||1}),this.trackShareCompletion(s)},shareToTumblr:function(r,s){if(!r.title)return t.error("Error sharing to Tumblr.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Tumblr.  Missing displayPhotoURL.");var i,n,o,l,c,h=r.title,u=r.tags||"",p=r.description,d=e.URLHelper.addProtocolToURL(r.displayPhotoURL),g=r.isPhotoPage,m=a.networks.tumblr.shareUrl;g&&this.appContext.flipper.isFlipped("enable-tumblr-embed-share")||(m+="&shareSource=legacy&posttype=photo&content={{displayPhotoURL}}&clickthroughUrl={{linkToShare}}"),r.authorURL&&(n=e.url(r.authorURL)),r.ownerName&&(o=r.ownerName),l=0===r.url.indexOf("https://")?r.url:0===r.url.indexOf("//")?e.URLHelper.addProtocolToURL(r.url):e.url(r.url),i=this.templates("fluid-share-tumblr-post")({title:h,ownerURL:n,ownerName:o,description:p,linkToShare:l}),c=m.replace("{{displayPhotoURL}}",encodeURIComponent(d)).replace("{{tumblrCaption}}",encodeURIComponent(i)).replace(/{{linkToShare}}/g,encodeURIComponent(l)).replace("{{tags}}",encodeURIComponent(u)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:r.count||1}),s?s.location.replace(c):s=this.createSharePopup(c,!0)},shareToPinterest:function(r,s){if(!r.title)return t.error("Error sharing to Pinterest.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Pinterest.  Missing displayPhotoURL.");if(!r.url)return t.error("Error sharing to Pinterest.  Missing url.");if(!r.shortURL)return t.error("Error sharing to Pinterest.  Missing shortURL.");var i,n,o,l=e.Handlebars.helpers.stripTags(r.description)||"",c=r.shortURL,h=r.title,u=e.URLHelper.addProtocolToURL(r.displayPhotoURL);n=encodeURIComponent(e.url(r.url)),o=""!==l.trim()?c+" | "+h+" | "+l:c+" | "+h,u=u.replace("https:","http:"),n=n.replace("https:","http:"),i=a.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(u)).replace("{{description}}",encodeURIComponent(o)).replace("{{linkToShare}}",n),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i,!0)},shareToGooglePlus:function(r,s){if(!r.url)return t.error("Error sharing to GooglePlus.  Missing url.");var i,n;n=encodeURIComponent(e.url(r.url)),i=a.networks.googlePlus.shareUrl+n,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i)},shareToFlickr:function(r,s){if(!s.recipients)return t.error("Error sharing to Flickr.  Missing recipients.");if(!s.url)return t.error("Error sharing to Flickr.  Missing url.");if(!s.modelName)return t.error("Error sharing to Flickr.  Missing modelName.");if(!s.modelId)return t.error("Error sharing to Flickr.  Missing modelId.");var i,n,o=s.modelName,l=s.modelId,c=s.recipients,h=s.message||"",u=s.guestpassStr||"public",p={},d=[],g=[];encodeURIComponent(e.url(s.url)),"share_code"===o?p[o]=l:p[o+"_id"]=l,p.service_type_id="130",p.owner_id=this.appContext.getViewer().nsid,"public"!==u&&("friends"!==u&&"family_and_friends"!==u||(p.guestpass_friends="1"),"family"!==u&&"family_and_friends"!==u||(p.guestpass_family="1"),"private"===u&&(p.guestpass_private="1",p.guestpass_friends="1",p.guestpass_family="1"));for(i in c)(n=c[i]||{}).email?d.push(n.email):n.nsid&&g.push(n.nsid);p.to_flickr=g.join(","),p.to_email=d.join(","),p.message=e.flutil.escapeInput(h),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:s.count||1,flkcnt:g.length,emailcnt:d.length});var m=e.StorageHelper.getItem("signedOutEmailSharing");if(m){var f;try{(f=e.moment(m)).isValid()&&(new e.moment).diff(f,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:s.count||1}),e.StorageHelper.remove("signedOutEmailSharing"))}catch(e){}}if(!a.networks)throw new Error("Missing sharing api configuration.");this.appContext.callAPI(a.networks.flickr.apiCall,p).then(function(){r&&r.fire("parentViewEvent","flickr-share-success")},function(e){r&&r.fire("parentViewEvent","flickr-share-error")})},generateLink:function(){var r=this;return this.onBeforeShare().then(function(e){return e},function(t){r.sharePresentation.fire("closeAll"),setTimeout(function(){new e.Views.FluidModal({appContext:r.appContext,title:r.intlMessage({intlName:"common.OOPS"}),message:r.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:r.getGuestPassParams.multipleItems?10:1}),actionButtonLabel:r.intlMessage({intlName:"common.OK"}),classList:"sharing-failure-modal",showCancelButton:!1}).show()},10)})},preProcessShare:function(e,r){var a=this;if(this.onBeforeShare){var s=this.createSharePopup("",!0);try{s.document.body.innerHTML=a.templates("fluid-share-loading-state")()}catch(e){18===e.code&&(s.close(),(s=this.createSharePopup("",!0)).document.body.innerHTML=a.templates("fluid-share-loading-state")())}this.onBeforeShare().then(function(i){var n;try{n=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,n,s)})}else{var i;try{i=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,i)}},trackShareCompletion:function(r){var a=function(s){if(s.source===r)if(s.origin===e.url("/")&&"Window closed"===s.data)t.log("Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",a,!1);else if(s.origin===e.url("/")&&0===s.data.indexOf("share failure"))t.error("Got Facebook error",{data:s.data}),e.config.win.removeEventListener("message",a,!1);else if("https://twitter.com"===s.origin&&"__ready__"!==s.data)try{t.log("Tracking share completion",{data:s.data}),"tweet"===JSON.parse(s.data).params[0]&&s.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",a,!1))}catch(e){t.error("Error tracking share completion",{err:e})}};e.config.win.addEventListener("message",a,!1)},createSharePopup:function(r,t){var a={},s="",i="nativeShare"+(new Date).getTime();return a.width=t?950:640,a.height=480,a.top=(e.config.win.screen.height-a.height)/2,a.left=(e.config.win.screen.width-a.width)/2,e.Object.each(a,function(e,r){s+=r+"="+e+","}),s=s.slice(0,-1),e.config.win.open(r,i,s)},requestGuestpass:function(e,r,t,a){var s=this;this.guestPassURLs||(this.guestPassURLs={}),this.guestPassURLs[r]?e.fire("parentViewEvent","guestpass-created",r,this.guestPassURLs[r]):this.appContext.callAPI("flickr.sharing.createGuestpass",t).then(function(t){if(!t||!t.guestpass||!t.guestpass.url)throw new Error("No guestpass returned");s.guestPassURLs[r]=t.guestpass.url,e.fire("parentViewEvent","guestpass-created",r,s.guestPassURLs[r])},function(i){a?s.requestGuestpass(e,r,t):e.fire("parentViewEvent","guestpass-failed",i)})}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","url","flutil","url-helper","signin-helper","handlebars-helpers"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});YUI.add("fluid-share-photo-view",function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("photo-models",this.photoId),this.appContext.getModel("photo-privacy-models",this.photoId),this.appContext.getModel("photo-engagement-models",this.photoId),this.appContext.getModel("photo-tags-models",this.photoId)]).then(function(e){return t.set("photoModel",e[0]),t.set("privacyModel",e[1]),t.set("engagementModel",e[2]),t.set("photoTagsModels",e[3]),t.set("tags",t.get("photoTagsModels").getValue("tags").toJSON()),t.get("photoModel").canVr().then(function(e){t.set("canVr",e)})})},buildContainer:function(){var e=2===this.get("photoModel").getValue("safetyLevel");return this.get("photoModel").getValue("owner").id!==this.appContext.getViewer().nsid&&(e=e||!this.get("privacyModel").getValue("isPublic")),this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-photo-icon",showShareButtonLabel:!1,sharingDisabled:e,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTO"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("photoModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photoModel");return{url:e.URLHelper.getShortURL(t.getValue("id")),title:t.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"})}},prepareTumblrShareParameters:function(){var e=this.get("photoModel"),t=e.getValue("owner"),i=e.getLargestSize({excludeSizes:["o"]}).displayUrl,a=this.appContext.flipper.isFlipped("enable-flickr-embeds-on-tumblr");return{title:e.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),authorURL:t.getValue("url"),ownerName:t.getValue("displayname"),description:e.getValue("description"),displayPhotoURL:a?e.getValue("url"):i,url:e.getValue("url"),isPhotoPage:!0,tags:this.get("tags").map(function(e){return e.tagRaw}).join(",")}},preparePinterestShareParameters:function(){var t=this.get("photoModel");return{title:t.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),description:t.getValue("description"),displayPhotoURL:t.getLargestSize({excludeSizes:["o"]}).displayUrl,shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photoModel");return{title:e.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),modelName:"photo",modelId:e.getValue("id"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t,i=this.get("photoModel"),a=this.get("privacyModel"),o=this.get("engagementModel").getValue("canShare");return t=!(!o||!this.get("photoModel").getValue("isVideo"))||o&&!this.get("photoModel").getValue("isVideo"),{url:this.appContext.flipper.isFlipped("enable-embedr-in-share")?e.config.win.location.pathname:i.getValue("url"),author:i.getValue("owner").getValue("displayname"),authorURL:i.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortURL(i.getValue("id")),supportsEmbedr:t,supportsBBCode:o,sizes:i.getValue("sizes"),title:i.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),secret:i.getValue("secret"),privacyWarningString:this.intlMessage({intlName:"share-modal.PHOTO_PAGE_PRIVACY_WARNING"}),aspectRatio:i.getValue("aspectRatio"),isNonPublic:!a.getValue("isPublic")}},getTitleIntlKey:function(){return this.get("photoModel").getValue("isVideo")?"SHARE_VIDEO_TO":"SHARE_PHOTOS_TO"},getGuestPassParams:function(){var e,t=this.get("privacyModel"),i=t.getValue("isVisibleByFriends"),a=t.getValue("isVisibleByFamily"),o=!t.getValue("isPublic"),l=this.get("photoModel").getValue("isOwner");return a&&i?e=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_FRIENDS_MESSAGE"}):a?e=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_MESSAGE"}):i?e=this.intlMessage({intlName:"share-modal.PHOTO_FRIENDS_MESSAGE"}):o&&(e=this.intlMessage({intlName:"share-modal.PHOTO_PRIVATE_MESSAGE"})),{type:"photo",id:this.photoId,contentMarkedFriends:l&&i&&!a,contentMarkedFamily:l&&a&&!i,contentMarkedFriendFamily:l&&a&&i,contentMarkedPublic:!o&&!a&&!i,canSharePrivate:l&&o&&!a&&!i,showGuestPassDropdown:l&&o,multipleItems:!1,sharingEntirelyNotPublic:l&&o,nonPublicWarning:e}},getIsMine:function(){return this.get("photoModel").getValue("isOwner")},getSignedOutSharingPerms:function(){var e=this.get("engagementModel").getValue("canShare");return{facebook:{canShare:e},twitter:{canShare:e},tumblr:{canShare:e},pinterest:{canShare:e},flickr:{canShare:!1}}},onParentViewEvent:function(e,t){"enable-sharing"!==t[0]&&"disable-sharing"!==t[0]||this.buildContainer()},shouldCancelModal:function(){var e=2===this.get("photoModel").getValue("safetyLevel");return e&&this.buildContainer(),e},destructor:function(){this.fire("destroy")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper","flutil"],langBundles:["models","share-modal"]});YUI.add("photo-engagement-view",function(e,i){require("hermes-core/flog")(i);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.signinPendingQueue=e.signinPendingQueue,this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,inlineStyling:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")}}},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(i){e.set("photo",i)})},buildContainer:function(){var e,i=this.get("photo"),t=i.getValue("owner"),o=this.get("container");return e={"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):"",photoId:i.getValue("id"),ownerId:i.getValue("owner").getValue("id"),isVideo:i.getValue("isVideo"),viewerIsOwner:t.getValue("isMe"),downloadingAvailable:!1,downloadLink:"",hasFullScreenButton:this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")},i.getValue("isVideo")?this.appContext.flipper.isFlipped("disable-video-playback")?e.downloadingAvailable=!1:(e.downloadLink="/video_download.gne?id="+i.getValue("id"),this.appContext.flipper.isFlipped("enable-album-download")&&(e.downloadingAvailable=i.getValue("engagement").getValue("canDownload")),t.getValue("isMe")&&(e.downloadingAvailable=!0)):(e.downloadLink=i.getValue("url")+"/sizes/l/",e.downloadingAvailable=!0),this.appContext.forceServerRender&&(e.downloadItems=this.getDownloadMenuItems()),this.setContainerWithTemplate("photo-engagement",e),e.hasFullScreenButton&&o.addClass("has-fullscreen"),this},activate:function(){var e=this.get("photo").getValue("license"),i=0!==e&&7!==e&&8!==e&&10!==e,t=8===e,o=9===e,n=10===e,s=this.get("container");if(this.signinPendingQueue&&this.signinPendingQueue.length>0)for(var a=this.signinPendingQueue,l=0;l<a.length;l++)"download"===a[l].key&&a[l].value&&a[l].value.id===this.photoId&&this.downloadItem(a[l].value.imageUrl);return!this.appContext.flipper.isFlipped("enable-signed-out-download-cta-test")||this.appContext.getViewer().signedIn||this.appContext.getUA().isBot||!0===this.get("photo").getValue("owner").getValue("isPro")||i||t||o||n||2===this.get("photo").getValue("visibilitySource")||(this.signedOutTest=!0),s.all(".sizes li a.download-image-size")&&this.registerEventHandler(s.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this)),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(s.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.signedOutTest&&s.one(".all-sizes")&&this.registerEventHandler(s.one(".all-sizes").on("click",function(e){e.halt(),this.signUpAndDownloadItem()}.bind(this))),this},getDownloadMenuItems:function(i){var t,o=e.clone(this.get("photo").toJSON()),n=[],s=this.get("photo").getValue("engagement").getValue("canDownload"),a=!1;if(!o||!o.sizes)return"";for(o.sizes.q&&(o.sizes.q.label=this.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),n.push(o.sizes.q)),o.sizes.s&&(o.sizes.s.label=this.intlMessage({intlName:"photo-page-scrappy.SMALL"}),n.push(o.sizes.s)),o.sizes.z&&(o.sizes.z.label=this.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),n.push(o.sizes.z)),o.sizes.k?(o.sizes.k.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),n.push(o.sizes.k)):o.sizes.h?(o.sizes.h.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),n.push(o.sizes.h)):o.sizes.l&&(o.sizes.l.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),n.push(o.sizes.l)),o.sizes.o&&(o.sizes.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),n.push(o.sizes.o)),t=0;t<n.length;t++)n[t].url=n[t].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");return s&&(a=!0),this.templates("scrappy-download-menu")({photo:o,sizes:n,showDownloadSizes:a})},createDownloadDialog:function(i){var t=this.get("container"),o=this;this.downloadMenu&&(this.downloadMenu.close(),this.downloadMenu=null),this.downloadMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetVertical:5,anchorOffsetHorizontal:1,anchorElement:t.one(".download"),htmlMessage:i,closeOnScroll:!1,classList:"download-dialog-tooltip",hideModalOverlay:!0,autoSizeToContent:!0}),this.downloadMenu.on("activated",function(e){o.fire("subviewViewEvent","make in view",t)}),this.downloadMenu.on("closeDroparound",function(e){o.fire("subviewViewEvent","close in view")}),this.downloadMenu.show()},handleDownloadMenuButtonClick:function(t){var o=this.get("photo");if(t.target.ancestor(".download",!0).hasClass("disabled"))t.preventDefault();else if(o.getValue("isVideo")){if(this.appContext.flipper.isFlipped("enable-album-download"))this.handleDownloadItemClick(t);else if(!o.getValue("owner").getValue("isMe"))return t.preventDefault(),!1}else t.halt(),this.createDownloadDialog(this.getDownloadMenuItems());e.rapidTracker.beacon(i,"downloadDialogClick")},handleDownloadItemClick:function(t){t.preventDefault();var o;o=t.currentTarget.getAttribute("href"),this.signedOutTest?this.signUpAndDownloadItem(o):this.downloadItem(o),e.rapidTracker.beacon(i,"photoDownloadClick"),this.downloadMenu&&(this.downloadMenu.close(),this.downloadMenu=null)},downloadItem:function(e){document.location=e},signUpAndDownloadItem:function(i){var t,o,n=this,s=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_TITLE"}),a=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_MESSAGE"});this.get("photo").getValue("isVideo")&&"en-us"===this.appContext.lang.toLowerCase()&&(s=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_VIDEO_TITLE"})),t=e.url(e.URLHelper.getPhotoPage({photoId:this.photoId,pathAlias:this.nsid})),(o=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-download",signUpTitle:s,signUpMessage:a,beaconPrefix:"download"})).on("signUpClick",function(o){i?e.SigninHelper.signUpPendingDownload({id:n.photoId,imageUrl:i},{postLoginUrl:t}):e.SigninHelper._redirectToSignUp("download",{postLoginUrl:t+"sizes/l/"})}),o.on("signInClick",function(o){i?e.SigninHelper.addPendingDownload({id:n.photoId,imageUrl:i},{postLoginUrl:t}):e.SigninHelper._redirectToSignin("download",{postLoginUrl:t+"sizes/l/"})}),o.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-scrappy-download-menu","signup-modal-view","fluid-share-photo-view","fluid-droparound-view","better-throttle"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("seo",function(e,t){e.Seo={appContext:{},stripTags:function(e){return e?String(e).replace(/<\/?[^>]+>/g,""):""},collapseWhitespace:function(e){return e.trim().replace(/\s+/g," ")},decodeEntities:function(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")},cleanText:function(e){return this.collapseWhitespace(this.decodeEntities(this.stripTags(e)))},getSEOTitleForPhoto:function(e){var t=this.cleanText(e.getValue("title")),l=this.cleanText(e.getValue("description")),n=this.cleanText(e.getValue("owner").getValue("displayname")),g=70-(t.length+"| Flickr".length+5);return t.length>=50?t.slice(0,58)+(t.length<58?" ":"… "):t.length>20&&t.length<50?l.length>20?t+" | "+l.slice(0,g)+(l.length<g?" ":"… "):l.length>0?t+" | "+l.slice(0,g)+(l.length<g?" ":"… ")+"| "+n+" ":t+" | "+n+" ":t.length<=20&&t.length>0?l.length>50?t+" | "+l.slice(0,g)+(l.length<g?" ":"… "):l.length>0?t+" | "+l.slice(0,g)+(l.length<g?" ":"… ")+"| "+n+" ":t+" | "+n+" ":l.length>50?l.slice(0,g)+(l.length<g?" ":"… "):l.length>0?l.slice(0,g)+(l.length<g?" ":"… ")+"| "+n+" ":"Untitled | "+n+" "},generateSEODescriptionForPhoto:function(e,t,l,n,g){var i=e.getValue("og:title"),h=e.getValue("og:description"),c="";return"Untitled"===i&&(i=n),h.length>120?c=h.slice(0,120)+(h.length<120?" ":"… ")+l+" "+g+".":h.length>60&&h.length<120?c=h+("."===h.slice(h.length-1,h.length)?" ":". ")+i.slice(0,40)+(i.length<40?" ":"… ")+l+" "+g+".":h.length<=60&&(c=i+("."===i.slice(i.length-1,i.length)?" ":". ")+h.slice(0,160-i.length)+(h.length<160-i.length?" ":"… ")+l+" "+g+"."),c}}},"@VERSION@",{requires:[]});YUI.add("hermes-template-empty-photo-page",function(e,a){var t=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,t,l,n){var s=null!=a?a:{},r=t.helperMissing,i=e.escapeExpression;return i((t.outlet||a&&a.outlet||r).call(s,null!=a?a["global-nav-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\n<div class="fluid-centered" style="text-align: center;">\n\t<h3>'+i((t.intlHTMLMessage||a&&a.intlHTMLMessage||r).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.TIMEOUT_FAILURE"},data:n}))+"</h3>\n</div>\n\n"+i((t.outlet||a&&a.outlet||r).call(s,null!=a?a["footer-full-view"]:a,{name:"outlet",hash:{},data:n}))+"\n"},useData:!0}),l={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)}),e.Template.register("hermes/empty-photo-page",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,t(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-global-nav",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,l,n){return"gn-signed-in"},3:function(t,a,e,l,n){return"gn-signed-out"},5:function(t,a,e,l,n){return" refencing-announcement-page"},7:function(t,a,e,l,n){return" top-banner"},9:function(t,a,e,l,n){return"\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["partner-account-banner-view"]:a,{name:"outlet",hash:{},data:n}))+"\n"},11:function(t,a,e,l,n){var s;return null!=(s=(e.isFlipped||a&&a.isFlipped||e.helperMissing).call(null!=a?a:{},"enable-cognito-migration-banner",{name:"isFlipped",hash:{},fn:t.program(12,n,0),inverse:t.noop,data:n}))?s:""},12:function(t,a,e,l,n){return"\t\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["featured-banner-view"]:a,{name:"outlet",hash:{},data:n}))+"\n"},14:function(t,a,e,l,n){return'\t\t\t\t\t\t<svg class="icon icon-flickr-logo-colored"><use xlink:href="#icon-flickr-logo-colored"></use></svg>\n'},16:function(t,a,e,l,n){return'\t\t\t\t\t\t<svg class="icon icon-flickr_logo"><use xlink:href="#icon-flickr_logo"></use></svg>\n'},18:function(t,a,e,l,n){return'\t\t\t<a target="_blank" data-track="togetherDonut" href="https://www.smugmug.com/together/?utm_campaign=flickr-launch&utm_source=Flickr&utm_medium=product&utm_content=logo-donuts" class="smug-mug-news"></a>\n'},20:function(t,a,e,l,n){var s;return null!=(s=e.unless.call(null!=a?a:{},null!=(s=null!=a?a.elements:a)?s.right_side_signup:s,{name:"unless",hash:{},fn:t.program(21,n,0),inverse:t.noop,data:n}))?s:""},21:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\tclass="gn-signup"\n\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_UP"},data:n}))+'">\n\t\t\t\t\t\t<a data-track="gnSignupClick"\n\t\t\t\t\t\t\tclass="gn-title butt"\n\t\t\t\t\t\t\thref="/signup">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_UP"},data:n}))+"</a>\n\t\t\t\t\t</li>\n"},23:function(t,a,e,l,n){var s,i=t.lambda,r=t.escapeExpression,o=null!=a?a:{},m=e.helperMissing;return'\t\t\t\t\t<li data-context="you">\n\t\t\t\t\t\t<a role="menuitem"\n\t\t\t\t\t\t\tdata-track="gnYouMainClick"\n\t\t\t\t\t\t\tclass="gn-title you"\n\t\t\t\t\t\t\thref="'+r(i(null!=(s=null!=a?a.viewer:a)?s.url:s,a))+'"\n\t\t\t\t\t\t\taria-haspopup="true"\n\t\t\t\t\t\t\taria-expanded="false"\n\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.YOU"},data:n}))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.YOU"},data:n}))+'</a>\n\n\t\t\t\t\t\t<ul class="gn-submenu" role="menu" aria-label="submenu">\n\t\t\t\t\t\t\t<li class="menuitem">\n\t\t\t\t\t\t\t\t<a role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:n}))+'"\n\t\t\t\t\t\t\t\tdata-track="gnYouAboutClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.profile:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.PHOTOSTREAM"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouPhotostreamClick" href="'+r(i(null!=(s=null!=a?a.viewer:a)?s.url:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.PHOTOSTREAM"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+(null!=(s=e.if.call(o,null!=(s=null!=a?a.elements:a)?s.set_not_album:s,{name:"if",hash:{},fn:t.program(24,n,0),inverse:t.program(26,n,0),data:n}))?s:"")+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouSetsClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.albums:s,a))+'">'+(null!=(s=e.if.call(o,null!=(s=null!=a?a.elements:a)?s.set_not_album:s,{name:"if",hash:{},fn:t.program(24,n,0),inverse:t.program(26,n,0),data:n}))?s:"")+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.FAVES_SHORT"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouFavoritesClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.favorites:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.FAVES_SHORT"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouGalleriesClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.galleries:s,a))+'">\n\t\t\t\t\t\t\t\t\t'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:n}))+'\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.GROUPS"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouGroupsClick" href="/groups">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.GROUPS"},data:n}))+"</a>\n\t\t\t\t\t\t\t</li>\n"+(null!=(s=e.if.call(o,null!=(s=null!=a?a.elements:a)?s.stats:s,{name:"if",hash:{},fn:t.program(28,n,0),inverse:t.noop,data:n}))?s:"")+'\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.CAMERAROLL"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouCameraRollClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.cameraroll:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.CAMERAROLL"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="divider"\n\t\t\t\t\t\t\t\ttabindex="-1">\n\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.RECENT_ACTIVITY"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouRecentActivityClick" href="/activity">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.RECENT_ACTIVITY"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.PEOPLE"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouPeopleClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.people:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.PEOPLE"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.ORGANIZE"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnYouOrganizeClick" href="/photos/organize">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.ORGANIZE"},data:n}))+"</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n"},24:function(t,a,e,l,n){return t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.SETS"},data:n}))},26:function(t,a,e,l,n){return t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.ALBUMS"},data:n}))},28:function(t,a,e,l,n){var s,i=null!=a?a:{},r=e.helperMissing,o=t.escapeExpression;return'\t\t\t\t\t\t\t\t<li class="menuitem"\n\t\t\t\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.STATS"},data:n}))+'">\n\t\t\t\t\t\t\t\t\t<a data-track="gnYouStatsClick" href="'+o(t.lambda(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.stats:s,a))+'">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.STATS"},data:n}))+"</a>\n\t\t\t\t\t\t\t\t</li>\n"},30:function(t,a,e,l,n){var s,i=t.escapeExpression,r=null!=a?a:{},o=e.helperMissing;return'\t\t\t\t\t<li class="toplink">\n\t\t\t\t\t\t<a role="menuitem"\n\t\t\t\t\t\t\tdata-track="gnYouMainClick"\n\t\t\t\t\t\t\tclass="gn-link"\n\t\t\t\t\t\t\thref="'+i(t.lambda(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.cameraroll:s,a))+'"\n\t\t\t\t\t\t\taria-label="'+i((e.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"global-nav.CAMERAROLL"},data:n}))+'"><span>'+i((e.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"global-nav.CAMERAROLL"},data:n}))+"</span></a>\n\t\t\t\t\t</li>\n"},32:function(t,a,e,l,n){var s,i=null!=a?a:{},r=e.helperMissing,o=t.escapeExpression;return'\t\t\t\t\t<li data-context="explore">\n\t\t\t\t\t\t<a role="menuitem"\n\t\t\t\t\t\t\tdata-track="gnExploreMainClick"\n\t\t\t\t\t\t\tclass="gn-title explore"\n\t\t\t\t\t\t\thref="/explore"\n\t\t\t\t\t\t\taria-haspopup="true"\n\t\t\t\t\t\t\taria-expanded="false"\n\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.EXPLORE"},data:n}))+'">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.EXPLORE"},data:n}))+'</a>\n\t\t\t\t\t\t<ul class="gn-submenu" role="menu" aria-label="submenu">\n\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.RECENT_PHOTOS"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreRecentPhotosClick" href="/explore">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.RECENT_PHOTOS"},data:n}))+'</a></li>\n\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.TRENDING"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreTagsClick" href="/photos/tags">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.TRENDING"},data:n}))+"</a></li>\n"+(null!=(s=e.if.call(i,null!=(s=null!=a?a.elements:a)?s.vr_link:s,{name:"if",hash:{},fn:t.program(33,n,0),inverse:t.noop,data:n}))?s:"")+'\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.THE_COMMONS"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreTheCommonsClick" href="/commons">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.THE_COMMONS"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.GALLERIES"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreGalleriesClick" href="/galleries">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.GALLERIES"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.WORLD_MAP"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreWorldMapClick" href="/map">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.WORLD_MAP"},data:n}))+'</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.CAMERA_FINDER"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreCameraFinderClick" href="/cameras">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.CAMERA_FINDER"},data:n}))+"</a>\n\t\t\t\t\t\t\t</li>\n"+(null!=(s=e.if.call(i,null!=(s=null!=a?a.elements:a)?s.weekly_flickr:s,{name:"if",hash:{},fn:t.program(35,n,0),inverse:t.noop,data:n}))?s:"")+'\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\taria-label="'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.FLICKR_BLOG"},data:n}))+'">\n\t\t\t\t\t\t\t\t<a data-track="gnExploreFlickrBlogClick" href="https://blog.flickr.net/">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.FLICKR_BLOG"},data:n}))+"</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n"},33:function(t,a,e,l,n){return'\t\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\t\taria-label="Flickr VR">\n\t\t\t\t\t\t\t\t\t<a data-track="gnExploreVRLandingClick" href="/vr">Flickr VR</a></li>\n'},35:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t\t\t\t<li role="menuitem"\n\t\t\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.THE_WEEKLY_FLICKR"},data:n}))+'">\n\t\t\t\t\t\t\t\t\t<a data-track="gnExploreWeeklyFlickrClick" href="/photos/flickr/albums/72157639868074114/">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.THE_WEEKLY_FLICKR"},data:n}))+"</a>\n\t\t\t\t\t\t\t\t</li>\n"},37:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t<li class="gn-create">\n\t\t\t\t\t\t<a role="menuitem"\n\t\t\t\t\t\t\tdata-track="gnCreateMainClick"\n\t\t\t\t\t\t\tclass="gn-title"\n\t\t\t\t\t\t\thref="/create"\n\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.CREATE"},data:n}))+'">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.CREATE"},data:n}))+"</a>\n\t\t\t\t\t</li>\n"},39:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t<li class="gn-get-pro">\n\t\t\t\t\t\t<a role="menuitem"\n\t\t\t\t\t\t   data-track="gnGetProMainClick"\n\t\t\t\t\t\t   class="gn-title"\n\t\t\t\t\t\t   href="/account/upgrade/pro"\n\t\t\t\t\t\t   aria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.GET_PRO"},data:n}))+'">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.GET_PRO"},data:n}))+"</a>\n\t\t\t\t\t</li>\n"},41:function(t,a,e,l,n){return'\t\t\t\t\t<li class="gn-search-box"\n\t\t\t\t\t\trole="menuitem">\n\t\t\t\t\t\t<svg class="icon icon-search mobile-search-button mobile-only"><use xlink:href="#icon-search"></use></svg>\n\t\t\t\t\t\t'+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["search-autosuggest-field-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\t\t\t\t\t\t<svg class="icon mobile-search-close-button mobile-only"><use xlink:href="#icon-close"></use></svg>\n\t\t\t\t\t</li>\n'},43:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t<li class="gn-upload desktop-only"\n\t\t\t\t\t\trole="menuitem">\n\t\t\t\t\t\t<a data-track="gnUploadIconMain"\n\t\t\t\t\t\t\tclass="gn-title"\n\t\t\t\t\t\t\thref="/upload"\n\t\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.UPLOAD"},data:n}))+'">\n\t\t\t\t\t\t\t<i class="upload-icon" title="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.UPLOAD"},data:n}))+'" aria-hidden="true">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.UPLOAD"},data:n}))+"</i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n"},45:function(t,a,e,l,n){return'\t\t\t\t\t<li role="menuitem">\n\t\t\t\t\t\t'+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["notifications-menu-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t\t\t\t\t</li>\n"},47:function(t,a,e,l,n){return'\t\t\t\t\t<li role="menuitem">\n\t\t\t\t\t\t'+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["account-menu-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t\t\t\t\t</li>\n"},49:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t<li class="gn-signin"\n\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.SIGN_IN"},data:n}))+'">\n\t\t\t\t\t\t<a data-track="gnSignin"\n\t\t\t\t\t\t\tclass="gn-title"\n\t\t\t\t\t\t\thref="/signin">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"global-nav.LOG_IN"},data:n}))+"</a>\n\t\t\t\t\t</li>\n"},51:function(t,a,e,l,n){var s;return null!=(s=e.if.call(null!=a?a:{},null!=(s=null!=a?a.elements:a)?s.right_side_signup:s,{name:"if",hash:{},fn:t.program(52,n,0),inverse:t.noop,data:n}))?s:""},52:function(t,a,e,l,n){var s=null!=a?a:{},i=e.helperMissing,r=t.escapeExpression;return'\t\t\t\t\t<li class="gn-signup"\n\t\t\t\t\t\trole="menuitem"\n\t\t\t\t\t\taria-label="'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_UP"},data:n}))+'">\n\t\t\t\t\t\t<a data-track="gnSignupClick"\n\t\t\t\t\t\t\tclass="gn-title butt"\n\t\t\t\t\t\t\thref="/signup">'+r((e.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_UP"},data:n}))+"</a>\n\t\t\t\t\t</li>\n"},54:function(t,a,e,l,n){var s,i=t.lambda,r=t.escapeExpression,o=null!=a?a:{},m=e.helperMissing;return'\t\t\t\t\t<div class="mobile-nav-column">\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouAboutClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.profile:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouPhotostreamClick" href="'+r(i(null!=(s=null!=a?a.viewer:a)?s.url:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.PHOTOSTREAM"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouSetsClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.albums:s,a))+'">'+(null!=(s=e.if.call(o,null!=(s=null!=a?a.elements:a)?s.set_not_album:s,{name:"if",hash:{},fn:t.program(24,n,0),inverse:t.program(26,n,0),data:n}))?s:"")+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouFavoritesClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.favorites:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.FAVORITES"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item">\n\t\t\t\t\t\t\t<a data-track="gnYouGalleriesClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.galleries:s,a))+'">\n\t\t\t\t\t\t\t\t'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:n}))+'\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouGroupsClick" href="/groups">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.GROUPS"},data:n}))+"</a></div>\n\t\t\t\t\t\t"+(null!=(s=e.if.call(o,null!=(s=null!=a?a.elements:a)?s.stats:s,{name:"if",hash:{},fn:t.program(55,n,0),inverse:t.noop,data:n}))?s:"")+'\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouCameraRollClick" href="'+r(i(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.cameraroll:s,a))+'">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.CAMERAROLL"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnYouRecentActivityClick" href="/activity">'+r((e.intlMessage||a&&a.intlMessage||m).call(o,{name:"intlMessage",hash:{intlName:"global-nav.RECENT_ACTIVITY"},data:n}))+"</a></div>\n\t\t\t\t\t</div>\n"},55:function(t,a,e,l,n){var s,i=t.escapeExpression;return'<div class="mobile-nav-menu-item"><a data-track="gnYouStatsClick" href="'+i(t.lambda(null!=(s=null!=(s=null!=a?a.viewer:a)?s.urls:s)?s.stats:s,a))+'">'+i((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"global-nav.STATS"},data:n}))+"</a></div>"},57:function(t,a,e,l,n){var s,i=null!=a?a:{},r=e.helperMissing,o=t.escapeExpression;return'\t\t\t\t\t<div class="mobile-nav-column">\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnExploreMainClick" class="explore" href="/explore" aria-haspopup="true">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.EXPLORE"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnExploreRecentPhotosClick" href="/explore">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.RECENT_PHOTOS"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnExploreTagsClick" href="/photos/tags">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.TRENDING"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnExploreTheCommonsClick" href="/commons">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.THE_COMMONS"},data:n}))+'</a></div>\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnExploreGalleriesClick" href="/galleries">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.GALLERIES"},data:n}))+"</a></div>\n\t\t\t\t\t\t"+(null!=(s=e.if.call(i,null!=(s=null!=a?a.elements:a)?s.weekly_flickr:s,{name:"if",hash:{},fn:t.program(58,n,0),inverse:t.noop,data:n}))?s:"")+'\n\t\t\t\t\t\t<div class="mobile-nav-menu-item"><a data-track="gnExploreFlickrBlogClick" href="https://blog.flickr.net/">'+o((e.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"global-nav.FLICKR_BLOG"},data:n}))+"</a></div>\n\t\t\t\t\t\t"+(null!=(s=e.if.call(i,null!=(s=null!=a?a.elements:a)?s.get_pro_link:s,{name:"if",hash:{},fn:t.program(60,n,0),inverse:t.noop,data:n}))?s:"")+"\n\t\t\t\t\t</div>\n"},58:function(t,a,e,l,n){return'<div class="mobile-nav-menu-item"><a data-track="gnExploreWeeklyFlickrClick" href="/photos/flickr/albums/72157639868074114/">'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"global-nav.THE_WEEKLY_FLICKR"},data:n}))+"</a></div>"},60:function(t,a,e,l,n){return'<div class="mobile-nav-menu-item"><a data-track="gnGetProMainClick" href="/account/upgrade/pro">'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GET_PRO"},data:n}))+"</a></div>"},62:function(t,a,e,l,n){return"\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["browser-upgrade-banner-view"]:a,{name:"outlet",hash:{},data:n}))+"\n"},64:function(t,a,e,l,n){return"\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["featured-toast-view"]:a,{name:"outlet",hash:{},data:n}))+"\n"},compiler:[7,">= 4.0.0"],main:function(t,a,e,l,n){var s,i,r=null!=a?a:{},o=e.helperMissing,m=t.escapeExpression;return'<div class="global-nav '+m("function"==typeof(i=null!=(i=e.theme||(null!=a?a.theme:a))?i:o)?i.call(r,{name:"theme",hash:{},data:n}):i)+" "+(null!=(s=e.if.call(r,null!=a?a.isSignedIn:a,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(3,n,0),data:n}))?s:"")+(null!=(s=e.if.call(r,null!=a?a.isRefencingAnnouncementPage:a,{name:"if",hash:{},fn:t.program(5,n,0),inverse:t.noop,data:n}))?s:"")+'">\n\t<div class="global-nav-shim'+(null!=(s=e.if.call(r,null!=a?a.showPartnerAccountBanner:a,{name:"if",hash:{},fn:t.program(7,n,0),inverse:t.noop,data:n}))?s:"")+'"></div>\n\n'+(null!=(s=e.if.call(r,null!=a?a.showPartnerAccountBanner:a,{name:"if",hash:{},fn:t.program(9,n,0),inverse:t.program(11,n,0),data:n}))?s:"")+'\n\t<div class="global-nav-content styleguide-global-nav fluid sohp-mobile-navable'+(null!=(s=e.if.call(r,null!=a?a.showPartnerAccountBanner:a,{name:"if",hash:{},fn:t.program(7,n,0),inverse:t.noop,data:n}))?s:"")+'">\n\t\t<div class="global-nav-container fluid-centered" role="navigation" aria-label="'+m((e.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"common.MAIN"},data:n}))+'">\n\t\t\t<div class="mobile-nav-toggle mobile-only"><span></span></div>\n\n\t\t\t<div class="flickr-logo-container">\n\t\t\t\t<a href="/"\n\t\t\t\t\tclass="main-logo"\n\t\t\t\t\tdata-track="gnLogoClick"\n\t\t\t\t\ttitle="'+m((e.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"global-nav.FLICKR_LOGO_ALT"},data:n}))+'"\n\t\t\t\t\trole="heading"\n\t\t\t\t\taria-level="1"\n\t\t\t\t\taria-label="'+m((e.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"global-nav.FLICKR_LOGO_ALT"},data:n}))+'">\n'+(null!=(s=e.if.call(r,null!=a?a.isRefencingAnnouncementPage:a,{name:"if",hash:{},fn:t.program(14,n,0),inverse:t.program(16,n,0),data:n}))?s:"")+"\t\t\t\t</a>\n\t\t\t</div>\n\n"+(null!=(s=(e.isFlipped||a&&a.isFlipped||o).call(r,"enable-smug-donut-header",{name:"isFlipped",hash:{},fn:t.program(18,n,0),inverse:t.noop,data:n}))?s:"")+'\n\t\t\t<ul class="nav-menu desktop-only" role="menubar">\n'+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.signup_link:s,{name:"if",hash:{},fn:t.program(20,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.you_menu:s,{name:"if",hash:{},fn:t.program(23,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.you_link:s,{name:"if",hash:{},fn:t.program(30,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.explore_menu:s,{name:"if",hash:{},fn:t.program(32,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.create_link:s,{name:"if",hash:{},fn:t.program(37,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.get_pro_link:s,{name:"if",hash:{},fn:t.program(39,n,0),inverse:t.noop,data:n}))?s:"")+'\t\t\t</ul>\n\n\t\t\t<ul class="gn-tools"\n\t\t\t\trole="menubar">\n'+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.search_bar:s,{name:"if",hash:{},fn:t.program(41,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.upload_icon:s,{name:"if",hash:{},fn:t.program(43,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=a?a.showNotificationsMenu:a,{name:"if",hash:{},fn:t.program(45,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.account_menu:s,{name:"if",hash:{},fn:t.program(47,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.signin_link:s,{name:"if",hash:{},fn:t.program(49,n,0),inverse:t.noop,data:n}))?s:"")+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.signup_link:s,{name:"if",hash:{},fn:t.program(51,n,0),inverse:t.noop,data:n}))?s:"")+'\t\t\t</ul>\n\n\t\t\t<div class="mobile-nav mobile-only">\n'+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.you_menu:s,{name:"if",hash:{},fn:t.program(54,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=(s=null!=a?a.elements:a)?s.explore_menu:s,{name:"if",hash:{},fn:t.program(57,n,0),inverse:t.noop,data:n}))?s:"")+"\t\t\t</div>\n\t\t</div>\n\t</div>\n\n"+(null!=(s=e.if.call(r,null!=a?a["show-browser-upgrade-banner"]:a,{name:"if",hash:{},fn:t.program(62,n,0),inverse:t.noop,data:n}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=a?a.showFeaturedToast:a,{name:"if",hash:{},fn:t.program(64,n,0),inverse:t.noop,data:n}))?s:"")+"\n\t"+m((e.outlet||a&&a.outlet||o).call(r,null!=a?a["person-menu-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t"+m((e.outlet||a&&a.outlet||o).call(r,null!=a?a["group-menu-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t"+m((e.outlet||a&&a.outlet||o).call(r,null!=a?a["signup-rail-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\n</div>\n"},useData:!0}),l={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(l[a]=e)}),t.Template.register("hermes/global-nav",function(a,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,e(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-feedback-modal-view",function(t,e){var a=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,e,a,n,o){return'<div class="feedback-container">\t\t\n \t<h2 class="feedback-title">We Welcome Your Feedback</h2>\t\t\n \t<p class="feedback-description">\t\t\n \t\tWe would love to learn about your photography and how you use Flickr. When you complete our survey, you can enter into a random drawing for one $200 Amazon gift card.\n \t</p>\t\t\n \t<div class="feedback-button-container">\t\t\n \t\t<button class="button cancel-button">No Thanks</button>\t\t\n \t\t<button class="button accept-button">Get started</button>\t\t\n \t</div>\t\t\n </div>\n'},useData:!0}),n={};t.Array.each([],function(e){var a=t.Template.get("hermes/"+e);a&&(n[e]=a)}),t.Template.register("hermes/feedback-modal-view",function(e,o){return o=o||{},o.partials=o.partials?t.merge(n,o.partials):n,a(e,o)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-upload-limit-warning",function(a,e){var t=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,t,n,l){var s=null!=e?e:{},i=t.helperMissing,r=a.escapeExpression;return'<div class="upload-limit-warning">\n\t<header>\n\t\t<h1>'+r((t.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"upload-blocking.UPLOADS_LOCKED_SOON"},data:l}))+'</h1>\n\t</header>\n\t<div class="description-container">\n\t\t<p>\n\t\t\t<span>'+r((t.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{limitCount:(t.friendlyNumber||e&&e.friendlyNumber||i).call(s,1e3,{name:"friendlyNumber",hash:{},data:l}),intlName:"upload-blocking.FREE_ACCOUNTS_NO_LONGER_UPLOAD_BY_1_8_2019"},data:l}))+'</span>\n\t\t\t<a target="_blank" href="https://blog.flickr.net/en/2018/12/17/important-service-updates-and-dates-to-remember/?utm_campaign=flickr-launch-15&utm_source=Flickr&utm_medium=product&utm_content=big-blue">'+r((t.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"upload-blocking.LEARN_MORE_ABOUT_CHANGES_HERE"},data:l}))+"</a>\n\t\t\t<span>"+r((t.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{couponCode:"FLICKRPRO15",percentOff:"15",intlName:"upload-blocking.UPGRADE_TO_GET_UNLIMITED_BY_1_8_2019"},data:l}))+'</span>\n\t\t</p>\n\t</div>\n\t<div class="action-container">\n\t\t<a role="button" class="secondary-action">'+r((t.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.REMIND_ME_LATER"},data:l}))+'</a>\n\t\t<a class="primary-action" href="/account/upgrade/pro">'+r((t.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"common.GET_FLICKR_PRO"},data:l}))+"</a>\n\t</div>\n</div>\n"},useData:!0}),n={};a.Array.each([],function(e){var t=a.Template.get("hermes/"+e);t&&(n[e]=t)}),a.Template.register("hermes/upload-limit-warning",function(e,l){return l=l||{},l.partials=l.partials?a.merge(n,l.partials):n,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-upload-limit-message",function(e,a){var t=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,t,n,r){var l,i=null!=a?a:{},s=t.helperMissing,c=e.escapeExpression;return'<div class="upload-limit-message">\n\t<header>\n\t\t<h1>'+c("function"==typeof(l=null!=(l=t.title||(null!=a?a.title:a))?l:s)?l.call(i,{name:"title",hash:{},data:r}):l)+'</h1>\n\t</header>\n\t<p class="description">\n\t\t'+c((t.renderTrustedMarkup||a&&a.renderTrustedMarkup||s).call(i,null!=a?a.description:a,{name:"renderTrustedMarkup",hash:{},data:r}))+'\n\t</p>\n\t<div class="action-container">\n\t\t<a role="button" class="secondary-action">'+c("function"==typeof(l=null!=(l=t.secondaryActionText||(null!=a?a.secondaryActionText:a))?l:s)?l.call(i,{name:"secondaryActionText",hash:{},data:r}):l)+'</a>\n\t\t<a class="primary-action" href="/account/upgrade/pro">'+c("function"==typeof(l=null!=(l=t.primaryActionText||(null!=a?a.primaryActionText:a))?l:s)?l.call(i,{name:"primaryActionText",hash:{},data:r}):l)+"</a>\n\t</div>\n</div>\n"},useData:!0}),n={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)}),e.Template.register("hermes/upload-limit-message",function(a,r){return r=r||{},r.partials=r.partials?e.merge(n,r.partials):n,t(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-extend-blocking-card",function(e,a){var t=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,t,n,s){var l=null!=a?a:{},i=t.helperMissing,r=e.escapeExpression;return'<div class="extend-blocking-card-container">\n\t<div class="main-content-container">\n\t\t<div class="top-img"></div>\n\t\t<h1>'+r((t.intlHTMLMessage||a&&a.intlHTMLMessage||i).call(l,{name:"intlHTMLMessage",hash:{intlName:"upload-blocking.ALL_YOUR_PHOTOS_MATTER"},data:s}))+"</h1>\n\t\t<p>"+r((t.preventOrphans||a&&a.preventOrphans||i).call(l,(t.intlMessage||a&&a.intlMessage||i).call(l,{name:"intlMessage",hash:{limit:null!=a?a.photoLimit:a,intlName:"upload-blocking.UPLOAD_LIMIT_EXTEND_MODAL_1"},data:s}),{name:"preventOrphans",hash:{},data:s}))+"</p>\n\t\t<p>"+r((t.preventOrphans||a&&a.preventOrphans||i).call(l,(t.intlMessage||a&&a.intlMessage||i).call(l,{name:"intlMessage",hash:{dateNumber:12,intlName:"upload-blocking.UPLOAD_LIMIT_EXTEND_MODAL_2"},data:s}),{name:"preventOrphans",hash:{},data:s}))+'</p>\n\t\t<button type="button" class="button accept-button">'+r((t.intlMessage||a&&a.intlMessage||i).call(l,{name:"intlMessage",hash:{intlName:"common.GOT_IT"},data:s}))+"</button>\n\t</div>\n</div>\n"},useData:!0}),n={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)}),e.Template.register("hermes/extend-blocking-card",function(a,s){return s=s||{},s.partials=s.partials?e.merge(n,s.partials):n,t(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-helper",function(e){function t(e,t){var a;for(a in l){if(!t&&a===e)return l[a];if(t&&l[a]===e)return a}}var a=require("hermes-core/type-validator"),s=["q","ss","ct","mt","l","s","w","d","m","hd","b","a","g","e","cm","xel","xeh","xal","xah","xfl","xfh","eui"],r={userId:"user_id",groupId:"group_id",groupPathAlias:"group_path_alias",setId:"set_id",page:"page",text:"text",tags:"tags",tagMode:"tag_mode",sort:"sort",safeSearch:"safe_search",contentType:"content_type",mediaType:"media",license:"license",faves:"faves",contacts:"contacts",getty:"is_getty",commons:"is_commons",marketplace:"marketplace_licensable",minTakenDate:"min_taken_date",maxTakenDate:"max_taken_date",minUploadDate:"min_upload_date",maxUploadDate:"max_upload_date",hasGeo:"has_geo",boundingBox:"bbox",accuracy:"accuracy",woeId:"woe_id",camera:"camera",minExposure:"exif_min_exposure",maxExposure:"exif_max_exposure",minAperture:"exif_min_aperture",maxAperture:"exif_max_aperture",minFocalLength:"exif_min_focallen",maxFocalLength:"exif_max_focallen",excludeUserId:"exclude_user_id",foursquareWoeId:"foursquare_woeid",foursquareVenueId:"foursquare_venueid",slideshowStartId:"jump_to",height:"height",width:"width",dimensionSearchMode:"dimension_search_mode",orientation:"orientation",colorCodes:"color_codes",styles:"styles",similarityId:"similarity_id"},n={relevant:"relevance",recent:"date-posted-desc",interesting:"interestingness-desc",name:"exact-name-match-first",activity:"most-activity",size:"most-members",oldest:"oldest-first",newest:"recent-first",oldestJoined:"age",mostPhotos:"pho",dateUploaded:"date-posted-desc",dateTaken:"date-taken-desc"},o=["s","q","see","m"],i={username:"username",userId:"user_id",sort:"sort"},c=["q","s","m"],d={text:"text",sort:"sort",safeSearch:"safe_search",userId:"user_id",subscriptionTypes:"subscription_types",filterInactive:"filter_inactive_groups"},l={all:"0,1,2,3,4,5,6,7,8,9,10",cc:"1,2,3,4,5,6,9",deriv:"1,2,4,5,9,10",comm:"4,5,6,9,10",commderiv:"4,5,9,10"},u=[r.tags,r.tagMode,r.mediaType,r.minTakenDate,r.maxTakenDate,r.minUploadDate,r.maxUploadDate,r.height,r.width,r.dimensionSearchMode,r.orientation,r.marketplace,r.excludeUserId],m=[r.colorCodes,r.styles],p=[r.sort,r.safeSearch,r.license],h=[r.userId,r.groupId,r.faves,r.contacts,r.commons,"m","w"],f=[r.userId,r.groupId,r.faves,r.contacts,r.safeSearch,r.sort,r.license,r.tags,r.text],g={sort:n.relevant,parse_tags:"1",content_type:"7"};e.SearchHelper={API:r,PEOPLE_SEARCH_API:i,GROUPS_SEARCH_API:d,GROUPS_SAFE_SEARCH_SETTINGS:{safe:1,all:2,eighteenPlusOnly:3},API_SORT_OPTIONS:n,API_ORIENTATION_OPTIONS:{portrait:"portrait",square:"square",landscape:"landscape",panorama:"panorama"},LICENSE_TYPE:l,UNIFIED_STATE_PARAMS:{viewAll:"view_all",viewType:"view_type",advanced:"advanced",albums:"album_search"},UNIFIED_ADVANCED_PARAMS:u,UNIFIED_QUICK_FILTER_PARAMS:m,UNIFIED_TOOLBAR_PARAMS:p,SEARCH_SCOPE_PARAMS:h,UNIFIED_DEFAULT_PARAMS:g,decodeContentType:function(e){var t={};switch(parseInt(e,10)){case 1:t.photos=!0;break;case 2:t.screenshots=!0;break;case 3:t.other=!0;break;case 4:t.photos=!0,t.screenshots=!0;break;case 5:t.other=!0,t.screenshots=!0;break;case 6:t.photos=!0,t.other=!0;break;default:t.photos=!0,t.screenshots=!0,t.other=!0}return t},encodeContentType:function(e){var t=0;return!e.photos||e.screenshots||e.other?e.photos||!e.screenshots||e.other?e.photos||e.screenshots||!e.other?e.photos&&e.screenshots&&!e.other?t=4:!e.photos&&e.screenshots&&e.other?t=5:e.photos&&!e.screenshots&&e.other?t=6:e.photos&&e.screenshots&&e.other&&(t=7):t=3:t=2:t=1,t},isParameterlessSearch:function(e){return!(e[r.userId]||e[r.groupId]||e[r.tags]||e[r.text]||e[r.license]||e[r.faves]||e[r.contacts]||e[r.getty]||e[r.commons]||e[r.minTakenDate]||e[r.maxTakenDate]||e[r.minUploadDate]||e[r.maxUploadDate]||e[r.hasGeo]||e[r.boundingBox]||e[r.woeId]||e[r.camera]||e[r.minExposure]||e[r.maxExposure]||e[r.minAperture]||e[r.maxAperture]||e[r.minFocalLength]||e[r.maxFocalLength]||e[r.foursquareWoeId]||e[r.foursquareVenueId]||e[i.username]||e[r.similarityId])},mapRouteParamsToAPI:function(e){var t,s={nsid_or_path_alias:"userId",group_id:"groupId",set_id:"setId",page_number:"page",tag_list:"tags",location:"text",slideshow_start_id:"slideshowStartId"},n={};for(t in s)e[t]&&(n[r[s[t]]]=e[t]);return n[r.groupId]&&!a.nsid(n[r.groupId])&&(n[r.groupPathAlias]=n[r.groupId],delete n[r.groupId]),n},convertLicenseTypeValue:t,mapClassicSearchToAPI:function(t,o){if(!t)return{};var i,c,d,u,m={},p=o.getViewer(),h=t.l,f=t.s,g=t.w,_=t.m,I=t.q;if(t.d&&"string"==typeof t.d&&(d=t.d.split("-")),t.q&&(m[r.text]=t.q),void 0!==t.ss&&(m[r.safeSearch]=parseInt(t.ss,10)+1),void 0!==t.ct&&(m[r.contentType]=parseInt(t.ct,10)+1),void 0!==t.mt&&(m[r.mediaType]=t.mt),t.b&&(m[r.boundingBox]=t.b),t.a&&(m[r.accuracy]=t.a),t.e&&(m[r.woeId]=t.e),t.g&&(m[r.groupId]=t.g),t.cm&&(m[r.camera]=t.cm),void 0!==t.xel&&(m[r.minExposure]=t.xel),void 0!==t.xeh&&(m[r.maxExposure]=t.xeh),void 0!==t.xal&&(m[r.minAperture]=t.xal),void 0!==t.xah&&(m[r.maxAperture]=t.xah),void 0!==t.xfl&&(m[r.minFocalLength]=t.xfl),void 0!==t.xfh&&(m[r.maxFocalLength]=t.xfh),t.eui&&(m[r.excludeUserId]=t.eui),void 0!==h)switch(h){case"cc":case"comm":case"deriv":case"commderiv":m[r.license]=l[h];break;default:(c=parseInt(h,10))>=0&&c<=10&&(m[r.license]=c)}if(f)switch(f){case"rec":m[r.sort]=n.recent;break;case"rel":m[r.sort]=n.relevant;break;case"int":m[r.sort]=n.interesting}if(t.hd&&(m[r.media]="hdvideo"),g&&"string"==typeof g)if(-1!==g.indexOf("faves"))u=g.split("-"),m[r.faves]=1,u.length>1?m[r.userId]=u[1]:p.signedIn&&(m[r.userId]=p.nsid);else if(a.nsid(g))"pool"===_?m[r.groupId]=g:m[r.userId]=g;else switch(g){case"contacts":m[r.contacts]="all";break;case"ff":m[r.contacts]="ff";break;case"getty":m[r.getty]="true";break;case"commons":m[r.commons]="true";break;case"usg":m[r.license]=8}if(d)switch(d[0]){case"taken":d[1]&&(m[r.minTakenDate]=e.flutil.parseYYYYMMDDDatestamp(d[1])/1e3),d[2]&&(m[r.maxTakenDate]=e.flutil.parseYYYYMMDDDatestamp(d[2])/1e3);break;case"posted":d[1]&&(m[r.minUploadDate]=e.flutil.parseYYYYMMDDDatestamp(d[1])/1e3),d[2]&&(m[r.maxUploadDate]=e.flutil.parseYYYYMMDDDatestamp(d[2])/1e3)}if(_&&I)switch(_){case"tags":delete(m=e.merge(m,this.processTags(I)))[r.text]}for(i in t)-1===s.indexOf(i)&&(m[i]=t[i]);return m},mapClassicPeopleSearchToAPI:function(e,t){var a={},s=null,r=t.getViewer();if((e=e||{}).q&&(a[i.username]=e.q),e.s)switch(e.s){case"age":a[i.sort]=n.oldestJoined;break;case"pho":a[i.sort]=n.mostPhotos}e.see&&"all"===e.see.toString().toLowerCase()&&r.signedIn&&(a[i.userId]=r.nsid),e.m&&(e.m.toString().toLowerCase(),e.m.toString().toLowerCase());for(s in e)-1===o.indexOf(s)&&(a[s]=e[s]);return a},mapClassicGroupSearchToApi:function(e,t){var a,s={},r=null;if(e=e||{},a=e.m&&"discuss"===e.m.toString().toLowerCase(),e.q&&(s[d.text]=e.q),e.s)switch(e.s){case"act":s[d.sort]=a?n.discussionActivity:n.activity;break;case"siz":s[d.sort]=n.size;break;case"age":s[d.sort]=n.newest}for(r in e)-1===c.indexOf(r)&&(s[r]=e[r]);return s},mapAPIParamsToAdvancedSearchQuery:function(e){var a={},s=e[r.userId];return e[r.text]?a.q=e[r.text]:e[r.tags]&&(a.q=e[r.tags]),e[r.faves]?a.w=s?"faves-"+s:"faves":s?a.w=s:"all"===e[r.contacts]?a.w="contacts":"ff"===e[r.contacts]?a.w="ff":"true"===e[r.getty]?a.w="getty":"true"===e[r.commons]?a.w="commons":8===parseInt(e[r.license],10)&&(a.w="usg"),e[r.license]&&(a.l=t(e[r.license],!0)),a},deriveScopeTitle:function(t,s){var n,o=s.getViewer();return t[r.userId]?o&&o.signedIn&&o.nsid===t[r.userId]?t[r.faves]?e.Promise.resolve({intlName:"search.VIEWER_FAVES"}):e.Promise.resolve({intlName:"search.YOUR_PHOTOS"}):(n=a.nsid(t[r.userId])?t[r.userId]:{pathAlias:t[r.userId]},s.getModel("person-models",n).then(function(e){var a;return a=t[r.faves]?"search.FAVES_POSSESSIVE":"search.PHOTOS_POSSESSIVE",{intlName:a,name:e.getValue("displayname")}})):t[r.contacts]?e.Promise.resolve({intlName:"search.FROM_PEOPLE_YOU_FOLLOW"}):t[r.groupId]||t[r.groupPathAlias]?(n=t[r.groupId]?{id:t[r.groupId]}:{pathAlias:t[r.groupPathAlias]},s.getModel("group-info-models",n).then(function(e){return{intlName:"search.IN_GROUP_POOL",name:e.getValue("group").getValue("title")}})):t[r.faves]?e.Promise.resolve({intlName:"search.VIEWER_FAVES"}):e.Promise.resolve({intlName:"search.EVERYONES_PHOTOS"})},derivePeopleScopeTitle:function(t,s){var n,o=s.getViewer();if(t[r.userId])return o&&o.signedIn&&o.nsid===t[r.userId]?e.Promise.resolve({intlName:"search.PEOPLE_YOU_FOLLOW"}):(n=a.nsid(t[r.userId])?t[r.userId]:{pathAlias:t[r.userId]},s.getModel("person-models",n).then(function(e){return{intlName:"search.CONTACTS_POSSESSIVE",name:e.getValue("username")}}))},deriveGroupsScopeTitle:function(t,s){var n,o=s.getViewer();if(t[r.userId])return o&&o.signedIn&&o.nsid===t[r.userId]?e.Promise.resolve({intlName:"search.YOUR_GROUPS"}):(n=a.nsid(t[r.userId])?t[r.userId]:{pathAlias:t[r.userId]},s.getModel("person-models",n).then(function(e){return{intlName:"search.GROUPS_POSSESSIVE",name:e.getValue("username")}}))},deriveCCLicenseString:function(e){e||(e={});var t=null,a=e[r.license];if(a&&1===a.length)switch(parseInt(a,10)){case 1:t="search.CC_BY_NC_SA";break;case 2:t="search.CC_BY_NC";break;case 3:t="search.CC_BY_NC_ND";break;case 4:t="search.CC_BY";break;case 5:t="search.CC_BY_SA";break;case 6:t="search.CC_BY_ND"}return t?{intlName:t}:null},addParamDefaults:function(e,t){!e[r.license]||e[r.license]!==l.all&&""!==e[r.license]||delete e[r.license]},addGroupsParamDefaults:function(e){},addPeopleParamDefaults:function(e){},clearParams:function(e,t){for(var a in e)-1===t.indexOf(a)&&delete e[a]},clearAdvancedSearchParams:function(e){this.clearParams(e,f)},clearParamsExceptSearchScope:function(e){this.clearParams(e,h)},generateQueryString:function(t){var a=e.clone(t)||{};return delete a.page,delete a.method,delete a.extras,e.QueryString.stringify(a)},convertSafeSearchPrefsToApi:function(t){var a=e.AttributeHelpers.coerceInteger(t);return e.AttributeHelpers.coerceString(a+1)},unescapeParameters:function(t){var a=t[r.groupId],s=t[r.tags],n=t[r.text];YUI.Env.isServer&&(a&&(t[r.groupId]=e.flutil.unescape(a)),s&&(t[r.tags]=e.flutil.unescape(s)),n&&(t[r.text]=e.flutil.unescape(n)))},objectsAreEquivalentToDepth:function(t,a,s){var r,n,o=this;return t===a||!(s<=0)&&(s=s||1,!(!e.Lang.isObject(t)||!e.Lang.isObject(a))&&(r=Object.keys(t),n=Object.keys(a),r.length===n.length&&r.every(function(e){return o.objectsAreEquivalentToDepth(t[e],a[e],s-1)})))},normalizeTag:function(e){var t;return e&&(t=e.replace(/[\s!-\/:-@[-`]/g,"")),t},processTags:function(e,t){if(!e||"string"!=typeof e)return{};var a,s,n,o,i={},c=/(["'])(\\?.)*?\1/g,d=/^([,\+]|AND|OR)$/;return a=e.match(c)||[],s=e.replace(c,""),n=s.split(/[,\+\s]/),n=n.map(function(e){return e.trim()}).filter(function(e){return e&&!d.test(e)}),o=a.concat(n),i[r.tags]=o.join(","),"any"===t||"all"===t?i[r.tagMode]=t:/[\+\s]OR[\+\s]/.test(e)?(i[r.tagMode]="any",o.length=Math.min(o.length,11)):i[r.tagMode]="all",i}}},"@VERSION@",{requires:["flutil"]});YUI.add("search-url",function(e,r){function s(e){return"number"==typeof e?e.toString():"boolean"==typeof e?e?"1":"0":"string"==typeof e?e:void 0}var t,a,h=require("hermes-core/flog")(r),o=/^\/search(?:\/.*)?$/,i=/^bw|blackandwhite$/;t=YUI.Env.isServer?require("querystring").stringify:e.QueryString.stringify,(a=function(r,t,o){var i,c,p,n,P;if(this.appContext=t,"string"==typeof r){if(P=r.split("?"),o?this.searchType=o:(p=-1!==(c=P[0].split("/"))[0].indexOf("http")?3:1,n="/"+c.slice(p).join("/"),this.searchType=this.getSearchTypeFromPathname(n)),P=P.length>1?P[1]:"",this.params={},P)try{P=e.QueryString.parse(P),this.params=e.SearchHelper.mapClassicSearchToAPI(P,t)}catch(e){h.warn("malformed query",{err:e,query:P})}}else this.params=e.merge(r),this.searchType=o;for(i in this.params)this.params.hasOwnProperty(i)&&(this.params[i]=s(this.params[i]));this.params.color_codes&&(this.colors=this.params.color_codes.toString().split(",")),this.searchType||this.setSearchType(a.searchTypes.UNDEFINED)}).prototype.setSearchType=function(r){var s=this.getSearchTerm();return this.searchType=r,this.params=this.validateParams(this.params,this.searchType),this.params=e.merge(this.getDefaultParams(this.searchType),this.params),s&&this.setSearchTerm(s),this},a.prototype.getSearchTypeFromPathname=function(e){switch(e=e||this.pathname,e=e.toLowerCase(),e=e.split("/").join("")){case"searchpeople":return a.searchTypes.PEOPLE;case"searchgroups":return a.searchTypes.GROUPS;case"search":default:return a.searchTypes.PHOTOS}},a.prototype.getPathname=function(){var e="/search/";switch(this.searchType){case a.searchTypes.PEOPLE:e+="people/";break;case a.searchTypes.GROUPS:e+="groups/";break;case a.searchTypes.CLASSIC_GROUPS:e="/search_groups.gne";break;case a.searchTypes.PHOTOS:}return e},a.prototype.validateParams=function(r,s){var t,h,o,i={};switch(r=e.merge(r),s){case a.searchTypes.PEOPLE:(t=e.merge(e.SearchHelper.PEOPLE_SEARCH_API)).text="text";break;case a.searchTypes.GROUPS:t=e.merge(e.SearchHelper.GROUPS_SEARCH_API);break;case a.searchTypes.PHOTOS:t=e.merge(e.SearchHelper.API,e.SearchHelper.UNIFIED_STATE_PARAMS);break;case a.searchTypes.UNDEFINED:default:return r}if(t)for(h in t)void 0!==r[o=t[h]]&&(i[o]=r[o]);return i},a.prototype.getDefaultParams=function(r){var s={};switch(r){case a.searchTypes.PEOPLE:e.SearchHelper.addPeopleParamDefaults(s);break;case a.searchTypes.GROUPS:e.SearchHelper.addGroupsParamDefaults(s);break;case a.searchTypes.PHOTOS:e.SearchHelper.addParamDefaults(s);break;case a.searchTypes.UNDEFINED:}return s},a.prototype.getAPIParams=function(){return e.merge(this.params)},a.prototype.getAPIParam=function(e){return this.params[e]},a.prototype.setAPIParam=function(e,r){return this.params[e]=s(r),this},a.prototype.removeAPIParam=function(e){return delete this.params[e],this},a.prototype.removeAllAPIParams=function(){return this.params={},this},a.prototype.getSearchTerm=function(){var r=this.params[this.getSearchTermKey(this.searchType)];return r||(r=this.params[e.SearchHelper.API.tags]),r||""},a.prototype.setSearchTerm=function(r){var s=this.getSearchTermKey(this.searchType);return delete this.params[e.SearchHelper.PEOPLE_SEARCH_API.username],delete this.params[e.SearchHelper.GROUPS_SEARCH_API.text],delete this.params[e.SearchHelper.API.text],delete this.params[e.SearchHelper.API.tags],delete this.params.q,this.params[s]=r,this},a.prototype.getSearchTermKey=function(r){switch(r){case a.searchTypes.PEOPLE:return e.SearchHelper.PEOPLE_SEARCH_API.username;case a.searchTypes.GROUPS:return e.SearchHelper.GROUPS_SEARCH_API.text;case a.searchTypes.PHOTOS:default:return this.params[e.SearchHelper.API.tags]||""===this.params[e.SearchHelper.API.tags]?e.SearchHelper.API.tags:e.SearchHelper.API.text}},a.prototype.removeScope=function(){return e.SearchHelper.SEARCH_SCOPE_PARAMS.forEach(function(e){this.removeAPIParam(e)}.bind(this)),this.removeAPIParam(e.SearchHelper.API.excludeUserId),this},a.prototype.resetToUnified=function(){return this.params[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]&&(this.removeAPIParam(e.SearchHelper.API.userId),this.removeAPIParam(e.SearchHelper.API.contacts),this.removeAPIParam(e.SearchHelper.API.groupId),this.removeAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.albums)),this.removeAPIParam(e.SearchHelper.API.similarityId),this.removeAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll),this},a.prototype.hasAdvancedParams=function(r){return Object.keys(this.params).some(function(s){return-1!==e.SearchHelper.UNIFIED_ADVANCED_PARAMS.indexOf(s)||!r&&-1!==e.SearchHelper.UNIFIED_QUICK_FILTER_PARAMS.indexOf(s)||!r&&-1!==e.SearchHelper.UNIFIED_TOOLBAR_PARAMS.indexOf(s)})},a.prototype.resetAdvancedParam=function(r,s){return this.hasAdvancedParams(r)?this.setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.advanced,1):s||this.removeAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.advanced),this},a.prototype.createNewSearch=function(e){return this.setSearchTerm(e),this.removeScope(),this.searchType!==a.searchTypes.UNDEFINED&&this.searchType!==a.searchTypes.PHOTOS||(this.resetToUnified(),this.resetAdvancedParam()),this},a.prototype.getURL=function(){var e=this.getId(),r=this.getPathname();return e===a.EMPTY_SEARCH_ID?r:r+"?"+e},a.prototype.getId=function(){var r,s={},h=e.SearchHelper.API;for(r in this.params)h[r]?s[h[r]]=this.params[r]:s[r]=this.params[r];return t(s)||a.EMPTY_SEARCH_ID},a.prototype.clone=function(){return new a(this.params,this.appContext,this.searchType)},a.prototype.setMedia=function(r,s){var t;r||(r=!1),s||(s=!1),t=r&&s?"all":r?"photos":"videos",this.setAPIParam(e.SearchHelper.API.mediaType,t)},a.prototype._syncColors=function(){this.colors&&this.colors.length>0?this.params.color_codes=this.colors.join(","):this.removeAPIParam("color_codes")},a.prototype.addColorCode=function(e){if(e&&e.match(i))return this.clearColorCodes(),this.colors=["bw"],void this._syncColors();this.colors&&-1!==this.colors.indexOf("bw")&&(this.colors=[]),this.colors||(this.colors=[]),-1===this.colors.indexOf(e)&&(this.colors.push(e),this._syncColors())},a.prototype.removeColorCode=function(e){var r;this.colors&&-1!==(r=this.colors.indexOf(e))&&(this.colors.splice(r,1),this._syncColors())},a.prototype.clearColorCodes=function(){this.colors=[],this._syncColors()},a.isSearchUrl=function(e){return o.test(e)},a.searchTypes={UNDEFINED:0,PHOTOS:1,PEOPLE:2,GROUPS:3,CLASSIC_GROUPS:4},a.EMPTY_SEARCH_ID="-1",e.SearchUrl=a},"@VERSION@",{requires:["search-helper","querystring-parse-simple","querystring-stringify-simple"]});YUI.add("hermes-template-search-pill",function(a,e){var l=a.Template.Handlebars.revive({1:function(a,e,l,n,r){var i,s,t=null!=e?e:{},c=l.helperMissing,u=a.escapeExpression;return'<li class="search-pill" '+(null!=(i=l.if.call(t,null!=e?e.id:e,{name:"if",hash:{},fn:a.program(2,r,0),inverse:a.noop,data:r}))?i:"")+">"+u((l.truncate||e&&e.truncate||c).call(t,null!=e?e.name:e,20,{name:"truncate",hash:{},data:r}))+'<div class="search-pill-divider"></div>'+u("function"==typeof(s=null!=(s=l.secondName||(null!=e?e.secondName:e))?s:c)?s.call(t,{name:"secondName",hash:{},data:r}):s)+'<i class="search-pill-remover"></i></li>\n'},2:function(a,e,l,n,r){var i;return"id="+a.escapeExpression("function"==typeof(i=null!=(i=l.id||(null!=e?e.id:e))?i:l.helperMissing)?i.call(null!=e?e:{},{name:"id",hash:{},data:r}):i)},4:function(a,e,l,n,r){var i,s=null!=e?e:{};return'<li class="search-pill" '+(null!=(i=l.if.call(s,null!=e?e.id:e,{name:"if",hash:{},fn:a.program(2,r,0),inverse:a.noop,data:r}))?i:"")+">"+a.escapeExpression((l.truncate||e&&e.truncate||l.helperMissing).call(s,null!=e?e.name:e,30,{name:"truncate",hash:{},data:r}))+'<i class="search-pill-remover"></i></li>\n'},compiler:[7,">= 4.0.0"],main:function(a,e,l,n,r){var i;return null!=(i=l.if.call(null!=e?e:{},null!=e?e.combo:e,{name:"if",hash:{},fn:a.program(1,r,0),inverse:a.program(4,r,0),data:r}))?i:""},useData:!0}),n={};a.Array.each([],function(e){var l=a.Template.get("hermes/"+e);l&&(n[e]=l)}),a.Template.register("hermes/search-pill",function(e,r){return r=r||{},r.partials=r.partials?a.merge(n,r.partials):n,l(e,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-search-autosuggest-field",function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,s,t){var n;return null!=(n=e.invokePartial(s["search-pill"],a,{name:"search-pill",data:t,indent:"\t\t",helpers:l,partials:s,decorators:e.decorators}))?n:""},3:function(e,a,l,s,t){return' placeholder="'+e.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"search.PHOTOS_PEOPLE_OR_GROUPS"},data:t}))+'"'},compiler:[7,">= 4.0.0"],main:function(e,a,l,s,t){var n,r,i,c=null!=a?a:{},h=l.helperMissing,o=e.escapeExpression,u='<form method="get" action="/search/" role="search" class="search-form">\n\n\t<label data-track="gnSearchSearchIcon" aria-label="'+o((l.intlMessage||a&&a.intlMessage||h).call(c,{name:"intlMessage",hash:{intlName:"search.SEARCH"},data:t}))+'">\n\t\t<svg class="icon search-icon" style="width: 22px; height: 22px;" data-track="gnSearchSearchIcon" aria-label="'+o((l.intlMessage||a&&a.intlMessage||h).call(c,{name:"intlMessage",hash:{intlName:"search.SEARCH"},data:t}))+'"><use xlink:href="#icon-search"></use></svg>\n\t\t<input type="submit" data-track="gnSearchSearchIcon" class="search-icon-button" tabindex="-1" aria-label="'+o((l.intlMessage||a&&a.intlMessage||h).call(c,{name:"intlMessage",hash:{intlName:"search.SEARCH"},data:t}))+'" role="button">\n\t</label>\n\t<ul class="search-pillbox">\n';return r=null!=(r=l.pills||(null!=a?a.pills:a))?r:h,i={name:"pills",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t},n="function"==typeof r?r.call(c,i):r,l.pills||(n=l.blockHelperMissing.call(a,n,i)),null!=n&&(u+=n),u+'\t</ul>\n\t<input type="text" id="search-field" class="autosuggest-selectable-item"'+(null!=(n=l.unless.call(c,null!=a?a.hasPills:a,{name:"unless",hash:{},fn:e.program(3,t,0),inverse:e.noop,data:t}))?n:"")+' name="text" value="'+o("function"==typeof(r=null!=(r=l.searchTerm||(null!=a?a.searchTerm:a))?r:h)?r.call(c,{name:"searchTerm",hash:{},data:t}):r)+'" autocomplete="off" aria-label="'+o((l.intlMessage||a&&a.intlMessage||h).call(c,{name:"intlMessage",hash:{intlName:"search.SEARCH"},data:t}))+'" role="textbox">\n\n</form>\n\n'+o((l.outlet||a&&a.outlet||h).call(c,null!=a?a["search-autosuggest-items-list-view"]:a,{name:"outlet",hash:{},data:t}))+"\n"},usePartial:!0,useData:!0}),s={};e.Array.each(["search-pill"],function(a){var l=e.Template.get("hermes/"+a);l&&(s[a]=l)}),e.Template.register("hermes/search-autosuggest-field",function(a,t){return t=t||{},t.partials=t.partials?e.merge(s,t.partials):s,l(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-search-pill"]});YUI.add("hermes-lang-autosuggest",function(O,o){O.Intl.add("hermes/autosuggest","en-US",{MEMBER:["1 member"],MEMBERS:[{type:"number",valueName:"count"}," members"],SEARCH_PEOPLE:["Search people"],SEARCH_GROUPS:["Search groups"],SEARCH_PHOTOS:["Search photos"],MORE:["More"],MORE_SEARCH_TYPES:["More search types"],MORE_OPTIONS:["More options"],SEARCH_YOUR_PHOTOS:["Search your photos"],SEARCH_EVERYONES_PHOTOS:["Search everyone's photos"],SEARCH_CONTACTS_PHOTOS:["Search your contacts' photos"],YOUR_PHOTOS:["Your photos"],EVERYONES_PHOTOS:["Everyone's photos"],YOUR_CONTACTS_PHOTOS:["Your contacts' photos"],SEARCH_USER_PHOTOS:["Search ","${name}","'s photos"],SEARCH_GROUP_PHOTOS:["Search photos in ","${name}"],YOUR_PHOTOSTREAM:["Your photostream"],YOUR_ALBUMS:["Your albums"],SETS:["Sets"],CAMERA_ROLL:["Camera roll"],ORGANIZE:["Organize"],YOUR_COLLECTIONS:["Your collections"],YOUR_GALLERIES:["Your galleries"],YOUR_ARCHIVES:["Your archives"],YOUR_TAGS:["Your tags"],YOUR_MAP:["Your map"],YOUR_FAVORITES:["Your favorites"],YOUR_STATS:["Your stats"],GRAPHS:["Graphs"],REFERRERS:["Referrers"],VIEWS:["Views"],YOUR_APPS:["Your apps"],RECENT_ACTIVITY:["Recent activity"],PHOTOS_OF_YOU:["Photos of you"],UPLOAD_PHOTOS:["Upload photos"],YOUR_ACCOUNT:["Your account"],SETTINGS:["Settings"],PREFERENCES:["Preferences"],YOUR_PROFILE:["Your profile"],FLICKR_MAIL:["Flickr mail"],ORGANIZR:["Organizr"],CREATE:["Create"],WALL_ART:["Wall art"],PHOTO_BOOKS:["Photo books"],CURATED_COLLECTION:["Curated collection"],PHOTOS_OF_YOUR_CONTACTS:["Photos of your contacts"],FOLLOWING:["Following"],CONTACTS_LIST:["Contacts list"],FOLLOWERS:["Followers"],FIND_YOUR_FRIENDS:["Find your friends"],INVITE_YOUR_FRIENDS:["Invite your friends"],INVITE_HISTORY:["Invite history"],GUEST_PASS_HISTORY:["Guest pass history"],YOUR_GROUPS:["Your groups"],RECENT_GROUP_DISCUSSIONS:["Recent group discussions"],CREATE_A_GROUP:["Create a group"],EXPLORE:["Explore"],POPULAR_TAGS:["Popular tags"],GALLERIES:["Galleries"],ANALOG:["Analog"],FILM:["Film"],WORLD_MAP:["World map"],PLACES:["Places"],THE_COMMONS:["The Commons"],CREATIVE_COMMONS:["Creative Commons"],CC:["CC"],LICENSE:["License"],THE_FLICKR_BLOG:["The Flickr Blog"],THE_FLICKR_CODE_BLOG:["The Flickr Code Blog"],THE_APP_GARDEN:["The App Garden"],CAMERA_FINDER:["Camera finder"],DEVELOPER_GUIDE:["Developer guide"],API:["API"],PROGRAMMING:["Programming"],CODE:["Code"],DOCUMENTATION:["Documentation"],DEVELOPER:["Developer"],API_DOCUMENTATION:["API documentation"],FEEDS:["Feeds"],RSS:["RSS"],ATOM:["Atom"],DATA:["Data"],HELP:["Help"],COMMUNITY_GUIDELINES:["Community guidelines"],HELP_FORUM:["Help forum"],FAQ:["FAQ"],FREQUENTLY_ASKED_QUESTIONS:["Frequently asked questions"],TOOLS:["Tools"],UPLOAD:["Upload"],MAC:["Mac"],WINDOWS:["Windows"],ABOUT_FLICKR:["About Flickr"],STAFF:["Staff"],JOBS_AT_FLICKR:["Jobs at Flickr"],CAREER:["Career"],TWENTY_UNDER_TWENTY:["20 Under 20"],ME:["Me"],FLICKR_MARKETPLACE:["Flickr Marketplace"]})},"@VERSION@",{requires:["intl"]});/*
YUI 3.16.0 (build 76f0e08)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("text-data-accentfold",function(e,t){e.namespace("Text.Data").AccentFold={0:/[\u2070\u2080\u24EA\uFF10]/gi,1:/[\u00B9\u2081\u2460\uFF11]/gi,2:/[\u00B2\u2082\u2461\uFF12]/gi,3:/[\u00B3\u2083\u2462\uFF13]/gi,4:/[\u2074\u2084\u2463\uFF14]/gi,5:/[\u2075\u2085\u2464\uFF15]/gi,6:/[\u2076\u2086\u2465\uFF16]/gi,7:/[\u2077\u2087\u2466\uFF17]/gi,8:/[\u2078\u2088\u2467\uFF18]/gi,9:/[\u2079\u2089\u2468\uFF19]/gi,a:/[\u00AA\u00E0-\u00E5\u0101\u0103\u0105\u01CE\u01DF\u01E1\u01FB\u0201\u0203\u0227\u1D43\u1E01\u1E9A\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u24D0\uFF41]/gi,b:/[\u1D47\u1E03\u1E05\u1E07\u24D1\uFF42]/gi,c:/[\u00E7\u0107\u0109\u010B\u010D\u1D9C\u1E09\u24D2\uFF43]/gi,d:/[\u010F\u1D48\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u217E\u24D3\uFF44]/gi,e:/[\u00E8-\u00EB\u0113\u0115\u0117\u0119\u011B\u0205\u0207\u0229\u1D49\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u2091\u212F\u24D4\uFF45]/gi,f:/[\u1DA0\u1E1F\u24D5\uFF46]/gi,g:/[\u011D\u011F\u0121\u0123\u01E7\u01F5\u1D4D\u1E21\u210A\u24D6\uFF47]/gi,h:/[\u0125\u021F\u02B0\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E96\u210E\u24D7\uFF48]/gi,i:/[\u00EC-\u00EF\u0129\u012B\u012D\u012F\u0133\u01D0\u0209\u020B\u1D62\u1E2D\u1E2F\u1EC9\u1ECB\u2071\u2139\u2170\u24D8\uFF49]/gi,j:/[\u0135\u01F0\u02B2\u24D9\u2C7C\uFF4A]/gi,k:/[\u0137\u01E9\u1D4F\u1E31\u1E33\u1E35\u24DA\uFF4B]/gi,l:/[\u013A\u013C\u013E\u0140\u01C9\u02E1\u1E37\u1E39\u1E3B\u1E3D\u2113\u217C\u24DB\uFF4C]/gi,m:/[\u1D50\u1E3F\u1E41\u1E43\u217F\u24DC\uFF4D]/gi,n:/[\u00F1\u0144\u0146\u0148\u01F9\u1E45\u1E47\u1E49\u1E4B\u207F\u24DD\uFF4E]/gi,o:/[\u00BA\u00F2-\u00F6\u014D\u014F\u0151\u01A1\u01D2\u01EB\u01ED\u020D\u020F\u022B\u022D\u022F\u0231\u1D52\u1E4D\u1E4F\u1E51\u1E53\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u2092\u2134\u24DE\uFF4F]/gi,p:/[\u1D56\u1E55\u1E57\u24DF\uFF50]/gi,q:/[\u02A0\u24E0\uFF51]/gi,r:/[\u0155\u0157\u0159\u0211\u0213\u02B3\u1D63\u1E59\u1E5B\u1E5D\u1E5F\u24E1\uFF52]/gi,s:/[\u015B\u015D\u015F\u0161\u017F\u0219\u02E2\u1E61\u1E63\u1E65\u1E67\u1E69\u1E9B\u24E2\uFF53]/gi,t:/[\u0163\u0165\u021B\u1D57\u1E6B\u1E6D\u1E6F\u1E71\u1E97\u24E3\uFF54]/gi,u:/[\u00F9-\u00FC\u0169\u016B\u016D\u016F\u0171\u0173\u01B0\u01D4\u01D6\u01D8\u01DA\u01DC\u0215\u0217\u1D58\u1D64\u1E73\u1E75\u1E77\u1E79\u1E7B\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u24E4\uFF55]/gi,v:/[\u1D5B\u1D65\u1E7D\u1E7F\u2174\u24E5\uFF56]/gi,w:/[\u0175\u02B7\u1E81\u1E83\u1E85\u1E87\u1E89\u1E98\u24E6\uFF57]/gi,x:/[\u02E3\u1E8B\u1E8D\u2093\u2179\u24E7\uFF58]/gi,y:/[\u00FD\u00FF\u0177\u0233\u02B8\u1E8F\u1E99\u1EF3\u1EF5\u1EF7\u1EF9\u24E8\uFF59]/gi,z:/[\u017A\u017C\u017E\u1DBB\u1E91\u1E93\u1E95\u24E9\uFF5A]/gi}},"3.16.0",{requires:["yui-base"]});
/*
YUI 3.16.0 (build 76f0e08)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("text-accentfold",function(e,t){var n=e.Array,r=e.Text,i=r.Data.AccentFold,s={canFold:function(e){var t;for(t in i)if(i.hasOwnProperty(t)&&e.search(i[t])!==-1)return!0;return!1},compare:function(e,t,n){var r=s.fold(e),i=s.fold(t);return n?!!n(r,i):r===i},filter:function(e,t){return n.filter(e,function(e){return t(s.fold(e))})},fold:function(t){return e.Lang.isArray(t)?n.map(t,s.fold):(t=t.toLowerCase(),e.Object.each(i,function(e,n){t=t.replace(e,n)}),t)}};r.AccentFold=s},"3.16.0",{requires:["array-extras","text-data-accentfold"]});
YUI.add("autosuggest-context-results-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,langBundles:this.details.langBundles,TAG_ITEM_TYPE:0,PERSON_ITEM_TYPE:1,GROUP_ITEM_TYPE:2,PAGE_ITEM_TYPE:3,processItem:function(e,s){var l;if(e.type=s,e.titleIntlKey&&(e.title=this.intlMessage({intlName:e.titleIntlKey})),e.aliasIntlKeys)for(e.aliases=e.aliases||[],l=0;l<e.aliasIntlKeys.length;l++)e.aliases.push(this.intlMessage({intlName:e.aliasIntlKeys[l]}));return s===this.TAG_ITEM_TYPE||s===this.PAGE_ITEM_TYPE?e.key=e.title:e.key=e.nsid,e.matches&&(e.matches=e.matches.map(function(e){return e.token=t.Text.AccentFold.fold(e.token),e})),e},remote:{read:function(e){return t.ModelFetchers["flickr-autosuggest-getContextResults-fetcher"].run(e,this.appContext)}},attributes:{contextId:{writeOnce:"initOnly"},contextType:{writeOnce:"initOnly"},tags:{setter:function(t){var e,s;for(e=0,s=t.length;e<s;e++)this.processItem(t[e],this.TAG_ITEM_TYPE);return t}},people:{setter:function(t){var e,s;for(e=0,s=t.length;e<s;e++)this.processItem(t[e],this.PERSON_ITEM_TYPE);return t}},groups:{setter:function(t){var e,s;for(e=0,s=t.length;e<s;e++)this.processItem(t[e],this.GROUP_ITEM_TYPE);return t}},pages:{readOnly:!0,getter:function(t){var e,s;for(e=0,s=t.length;e<s;e++)this.processItem(t[e],this.PAGE_ITEM_TYPE);return t},defaultValue:[{url:"/photos/me/",titleIntlKey:"autosuggest.YOUR_PHOTOSTREAM",aliasIntlKeys:["autosuggest.ME"]},{url:"/me/albums/",titleIntlKey:"autosuggest.YOUR_ALBUMS",aliasIntlKeys:["autosuggest.SETS"]},{url:"/photos/me/collections/",titleIntlKey:"autosuggest.YOUR_COLLECTIONS",aliasIntlKeys:[]},{url:"/photos/me/galleries/",titleIntlKey:"autosuggest.YOUR_GALLERIES",aliasIntlKeys:[]},{url:"/photos/me/archives/",titleIntlKey:"autosuggest.YOUR_ARCHIVES",aliasIntlKeys:[]},{url:"/photos/me/tags/",titleIntlKey:"autosuggest.YOUR_TAGS",aliasIntlKeys:[]},{url:"/photos/me/map/",titleIntlKey:"autosuggest.YOUR_MAP",aliasIntlKeys:[]},{url:"/me/favorites/",titleIntlKey:"autosuggest.YOUR_FAVORITES",aliasIntlKeys:[]},{url:"/photos/me/stats/",titleIntlKey:"autosuggest.YOUR_STATS",aliasIntlKeys:["autosuggest.GRAPHS","autosuggest.REFERRERS","autosuggest.VIEWS"]},{url:"/services/apps/by/me/",titleIntlKey:"autosuggest.YOUR_APPS",aliasIntlKeys:[]},{url:"/activity/",titleIntlKey:"autosuggest.RECENT_ACTIVITY",aliasIntlKeys:[]},{url:"/photosof/me/",titleIntlKey:"autosuggest.PHOTOS_OF_YOU",aliasIntlKeys:["autosuggest.ME"]},{url:"/photos/upload/",titleIntlKey:"autosuggest.UPLOAD_PHOTOS",aliasIntlKeys:[]},{url:"/account/",titleIntlKey:"autosuggest.YOUR_ACCOUNT",aliasIntlKeys:["autosuggest.SETTINGS","autosuggest.PREFERENCES"]},{url:"/people/me/",titleIntlKey:"autosuggest.YOUR_PROFILE",aliasIntlKeys:["autosuggest.ME"]},{url:"/photos/organize/",titleIntlKey:"autosuggest.ORGANIZR",aliasIntlKeys:[]},{url:"/photos/contacts/",titleIntlKey:"autosuggest.YOUR_CONTACTS_PHOTOS",aliasIntlKeys:[]},{url:"/photosof/contacts/",titleIntlKey:"autosuggest.PHOTOS_OF_YOUR_CONTACTS",aliasIntlKeys:[]},{url:"/people/me/contacts/",titleIntlKey:"autosuggest.FOLLOWING",aliasIntlKeys:["autosuggest.CONTACTS_LIST"]},{url:"/people/me/contacts/rev/",titleIntlKey:"autosuggest.FOLLOWERS",aliasIntlKeys:[]},{url:"/import/people/",titleIntlKey:"autosuggest.FIND_YOUR_FRIENDS",aliasIntlKeys:[]},{url:"/invite/",titleIntlKey:"autosuggest.INVITE_YOUR_FRIENDS",aliasIntlKeys:[]},{url:"/invite/history/",titleIntlKey:"autosuggest.INVITE_HISTORY",aliasIntlKeys:[]},{url:"/invite/history/guests/",titleIntlKey:"autosuggest.GUEST_PASS_HISTORY",aliasIntlKeys:[]},{url:"/groups/",titleIntlKey:"autosuggest.YOUR_GROUPS",aliasIntlKeys:[]},{url:"/recent.gne/",titleIntlKey:"autosuggest.RECENT_GROUP_DISCUSSIONS",aliasIntlKeys:[]},{url:"/group_create.gne/",titleIntlKey:"autosuggest.CREATE_A_GROUP",aliasIntlKeys:[]},{url:"/explore/",titleIntlKey:"autosuggest.EXPLORE",aliasIntlKeys:[]},{url:"/photos/tags/",titleIntlKey:"autosuggest.POPULAR_TAGS",aliasIntlKeys:[]},{url:"/galleries/",titleIntlKey:"autosuggest.GALLERIES",aliasIntlKeys:[]},{url:"/analog/",titleIntlKey:"autosuggest.ANALOG",aliasIntlKeys:["autosuggest.FILM"]},{url:"/map/",titleIntlKey:"autosuggest.WORLD_MAP",aliasIntlKeys:[]},{url:"/places/",titleIntlKey:"autosuggest.PLACES",aliasIntlKeys:[]},{url:"/marketplace/",titleIntlKey:"autosuggest.FLICKR_MARKETPLACE",aliasIntlKeys:[]},{url:"/commons/",titleIntlKey:"autosuggest.THE_COMMONS",aliasIntlKeys:[]},{url:"/creativecommons/",titleIntlKey:"autosuggest.CREATIVE_COMMONS",aliasIntlKeys:["autosuggest.CC","autosuggest.LICENSE"]},{url:"/services/",titleIntlKey:"autosuggest.THE_APP_GARDEN",aliasIntlKeys:[]},{url:"/cameras/",titleIntlKey:"autosuggest.CAMERA_FINDER",aliasIntlKeys:[]},{url:"/services/api/",titleIntlKey:"autosuggest.API_DOCUMENTATION",aliasIntlKeys:["autosuggest.PROGRAMMING","autosuggest.CODE","autosuggest.DEVELOPER"]},{url:"/services/developer/",titleIntlKey:"autosuggest.DEVELOPER_GUIDE",aliasIntlKeys:["autosuggest.API","autosuggest.PROGRAMMING","autosuggest.CODE","autosuggest.DOCUMENTATION"]},{url:"/services/feeds/",titleIntlKey:"autosuggest.FEEDS",aliasIntlKeys:["autosuggest.RSS","autosuggest.ATOM","autosuggest.DATA"]},{url:"/help/",titleIntlKey:"autosuggest.HELP",aliasIntlKeys:[]},{url:"/help/guidelines/",titleIntlKey:"autosuggest.COMMUNITY_GUIDELINES",aliasIntlKeys:[]},{url:"/help/forum/",titleIntlKey:"autosuggest.HELP_FORUM",aliasIntlKeys:[]},{url:"/tools/",titleIntlKey:"autosuggest.TOOLS",aliasIntlKeys:["autosuggest.UPLOAD","autosuggest.MAC","autosuggest.WINDOWS"]},{url:"/about/",titleIntlKey:"autosuggest.ABOUT_FLICKR",aliasIntlKeys:["autosuggest.STAFF"]},{url:"/mail/",titleIntlKey:"autosuggest.FLICKR_MAIL",aliasIntlKeys:[]},{url:"/create/",titleIntlKey:"autosuggest.CREATE",aliasIntlKeys:["autosuggest.WALL_ART","autosuggest.PHOTO_BOOKS"]},{url:"/cameraroll/",titleIntlKey:"autosuggest.CAMERA_ROLL",aliasIntlKeys:["autosuggest.ORGANIZE"]},{url:"/20under20/",titleIntlKey:"autosuggest.TWENTY_UNDER_TWENTY",aliasIntlKeys:[]},{url:"http://blog.flickr.net",titleIntlKey:"autosuggest.THE_FLICKR_BLOG",aliasIntlKeys:[]},{url:"http://code.flickr.net",titleIntlKey:"autosuggest.THE_FLICKR_CODE_BLOG",aliasIntlKeys:["autosuggest.API","autosuggest.PROGRAMMING","autosuggest.CODE","autosuggest.DEVELOPER"]},{url:"/jobs/",titleIntlKey:"autosuggest.JOBS_AT_FLICKR",aliasIntlKeys:["autosuggest.CAREER"]}]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-autosuggest-getContextResults-fetcher","text-accentfold"],langBundles:["autosuggest"]});YUI.add("flickr-autosuggest-getContextResults-fetcher",function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-autosuggest-getContextResults-fetcher"]={run:function(s,r){var o=this,u=this._processParams(s);return e.Promise.all([r.callAPI("flickr.autosuggest.getContextResults",u),r.getModelRegistry("autosuggest-context-results-models")]).then(function(t){return o._processResponse(t,e.merge(u,s))},e.FetcherErrorLogger(t))},_processParams:function(t){var s=t.id.split("_");return{extras:e.APIHelper.request.getRebootPhotoExtras(),context_id:s[0],context_type:s[1]}},_processResponse:function(e,t){var s,r=e[0],o=e[1];if(s={id:t.id,contextId:t.context_id,contextType:t.context_type,tags:r.results.tags||[],people:r.results.people||[],groups:r.results.groups||[]},!r.results)throw new Error("No `results` property returned by API.");return o.add(s)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["autosuggest-context-results-models"]});