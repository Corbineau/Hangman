YUI.add("group-pool-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-groups-pools-getPhotos"].run(e,this.appContext)},addPhoto:function(e,o){return e.registryName=this.name,t.ModelCreators["flickr-groups-pools-add"].run(e,o)},removePhoto:function(e,o){return e.registryName=this.name,t.ModelDeletors["flickr-groups-pools-remove"].run(e,o)},invitePhoto:function(e,o){return t.ModelCreators["flickr-groups-invite-photo-invite"].run(e,o)},cancelPhotoInvitation:function(e,o){return t.ModelDeletors["flickr-groups-invite-photo-cancel"].run(e,o)},acceptPhoto:function(e,o){return t.ModelUpdaters["flickr-groups-admin-acceptPhoto"].run(e,o)}},addPhotoLocal:function(t,e){return this.getValue(t,"photoPageList").unshift(e),this.getValue(t,"photoContextList").hasMaxBoundary()&&this.getValue(t,"photoContextList").appendToList(e),this},addPhotoRemote:function(t,e){return this.remote.addPhoto.call(this,{photoID:e,groupID:t},this.appContext)},removePhotoLocal:function(t,e){return this.getValue(t,"photoPageList").removeFromList(e.getValue("id")),this.getValue(t,"photoContextList").removeFromList(e.getValue("id")),this},removePhotoRemote:function(t,e){return this.remote.removePhoto.call(this,{photoID:e,groupID:t},this.appContext)},invitePhotoRemote:function(t,e){return this.remote.invitePhoto.call(this,{photoID:e,groupID:t},this.appContext)},cancelPhotoInvitationRemote:function(t,e){return this.remote.cancelPhotoInvitation.call(this,{photoID:e,groupID:t},this.appContext)},hasPhoto:function(t,e){return this.getValue(t,"photoPageList").getFromListByID(e)||this.getValue(t,"photoContextList").getFromListByID(e)},acceptPhotoRemote:function(t,e){return this.remote.acceptPhoto.call(this,{photoID:e,groupID:t},this.appContext)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"group"}},pathAlias:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultFn:function(t){return t}},photoPageList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-groups-pools-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:t.ListFetchers["flickr-groups-pools-getContext"],listItemIdField:"photoId"}},group:{isModel:!0},urlSuffix:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(t){var e=this.getValue(t,"pathAlias");return e||(e=t),"pool-"+e}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("url")}},title:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("title")}},poolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("poolCount")}},filteredPoolCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultFn:function(t){return this.getValue(t,"group").getValue("poolCount")}},friendlyPoolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("friendlyPoolCount")}}}},{buildCompoundId:function(t,e){return t+"-"+e},extractGroupFromCompoundId:function(t){return t.split("-")[0]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getContext-fetcher","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor","flickr-groups-admin-acceptPhoto-updater","attribute-helpers"],optional:["group-top-contributors-models"]});YUI.add("flickr-groups-pools-getGroups-fetcher",function(e,r){"use strict";e.namespace("ListFetchers")["flickr-groups-pools-getGroups"]={run:function(s,o){var p=this;return e.Promise.all([o.callAPI("flickr.groups.pools.getGroups",{extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, needs_interstitial",page:s.page||0,per_page:s.perPage||400},!0),o.getModelRegistry("person-groups-models"),o.getModelRegistry("group-pool-models"),o.getModelRegistry("group-models")]).then(function(e){return p._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(r,s){var o=r[0],p=r[1],u=r[2],t=r[3],i=o.groups,a=s.id,l={},g=[];if(i)return i.group&&e.Array.each(i.group,function(e,r){var s,o,p;p=t.parseGroupModel(e.id,e.pathAlias,e),s=t.addOrUpdate(p),o=u.addOrUpdate({id:e.id,pathAlias:e.pathAlias,group:s}),g.push(o)}),l={id:a,memberCount:o.userGroupMemberships?o.userGroupMemberships.member:null,moderatorCount:o.userGroupMemberships?o.userGroupMemberships.moderator:null,adminCount:o.userGroupMemberships?o.userGroupMemberships.admin:null,invitedCount:o.userGroupMemberships?o.userGroupMemberships.invited:null},l.groups=e.APIHelper.response.addOrReplaceListByPage({current:p.exists(a)?p.proxy(a).getValue("groups").getList():[],perPage:s.perPage,pageNum:s.page,totalItems:o.groups.total,newPages:g}),p.exists(a)?p.setValue(a,"groups",l.groups):p.add(l),l.groups}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models","group-pool-models","person-models"]});YUI.add("flickr-groups-fave-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-groups-fave"]={run:function(s,o){return e.Promise.all([o.callAPI("flickr.groups.fave",s),o.getModelRegistry("person-groups-models")]).then(this._processResponse,e.FetcherErrorLogger(r))},_processResponse:function(e){}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});YUI.add("flickr-groups-unfave-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-groups-unfave"]={run:function(s,o){return e.Promise.all([o.callAPI("flickr.groups.unfave",s),o.getModelRegistry("person-groups-models")]).then(this._processResponse,e.FetcherErrorLogger(r))},_processResponse:function(e){}}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});YUI.add("flickr-people-getGroupsWithStatus-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-people-getGroupsWithStatus"]={run:function(s,i){var r=this,o={extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, date_activity, date_last_viewed",user_id:s.id,status:s.status};return s.id!==i.getViewer().nsid&&(o.public_only=1,o.status="2,3,4"),e.Promise.all([i.callAPI("flickr.people.getGroupsWithStatus",o,!0),i.getModelRegistry("person-groups-models"),i.getModelRegistry("group-models"),i.getModelRegistry("group-activity-models")]).then(function(e){return r._processResponse(e,s)},e.FetcherErrorLogger(t))},_processResponse:function(t,s){var i,r=t[0],o=t[1],a=t[2],u=t[3],d=r.groups,l=s.id,p={},n=[];if(d)return e.Array.each(d,function(t,r){var o,d,l,p=a.parseGroupModel(s.id,s.pathAlias,t);o=a.addOrUpdate(p),n.push(o),t.viewDates?(d="0"!==t.viewDates.pool?e.moment(t.viewDates.pool,"X"):u.getDefaultViewedDate(),(l="0"!==t.viewDates.discussions?e.moment(t.viewDates.discussions,"X"):u.getDefaultViewedDate()).isValid()||(l=u.getDefaultViewedDate()),d.isValid()||(d=u.getDefaultViewedDate())):(d=u.getDefaultViewedDate(),l=u.getDefaultViewedDate()),i={id:p.id,viewedPool:d,viewedDiscussions:l,group:o},u.addOrUpdate(i)}),p={id:l,memberCount:r.members?r.members:null,moderatorCount:0,adminCount:0,invitedCount:0},p[s.attribute]=n,o.exists(l)?o.setValue(l,s.attribute,p[s.attribute]):o.add(p),p[s.attribute]}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models"]});YUI.add("person-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},faveGroup:function(t,r){return e.ModelFetchers["flickr-groups-fave"].run(t,r)},unfaveGroup:function(t,r){return e.ModelFetchers["flickr-groups-unfave"].run(t,r)}},faveGroup:function(e){var t=this,r=e.group_id,o=e.user_id;return this.remote.faveGroup(e,this.appContext).then(null,function(){t.appContext.getModel("group-models",r).then(function(e){t.getValue(o,"groupsFaved").removeFromList(r)})}),this.appContext.getModel("group-models",r).then(function(e){t.getValue(o,"groupsFaved").appendToList(e)})},unfaveGroup:function(e){var t=e.group_id,r=e.user_id,o=this;return this.remote.unfaveGroup(e,this.appContext).then(null,function(){o.appContext.getModel("group-models",t).then(function(e){o.getValue(r,"groupsFaved").appendToList(e)})}),this.appContext.getModel("group-models",t).then(function(e){o.getValue(r,"groupsFaved").removeFromList(t)})},attributes:{id:{},memberCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},moderatorCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},adminCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},invitedCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},groups:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getGroups"]}},groupsAdministered:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsModerated:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsBelongingTo:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsFaved:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getGroups-fetcher","flickr-people-getInfo-fetcher","flickr-groups-fave-fetcher","flickr-groups-unfave-fetcher","flickr-people-getGroupsWithStatus-fetcher"]});YUI.add("flickr-photos-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photos.getContext",this._processParams(t,s),!0),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o,t){var s;return s={photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()},o.viewAs&&(s.view_as=o.viewAs),o.orderBy&&(s.order_by=o.orderBy),s},_processResponse:function(o,t){var s,r,n,p,a,i,h=o[0],l=o[1],d=o[2],g=o[3],u=o[4],m=[],c=[],x=d.proxy(t.photoId),y=x.getValue("owner"),M=[];return s=h.prevphotos,r=h.nextphotos,c=e.APIHelper.response.parsePhotos({photos:s.photo,existingPerson:y,photoModelRegistry:d,photoEngagementModelRegistry:g,photoStatsModelRegistry:u}),m=e.APIHelper.response.parsePhotos({photos:r.photo,existingPerson:y,photoModelRegistry:d,photoEngagementModelRegistry:g,photoStatsModelRegistry:u}),p=l.getValue(t.id,"photoContextList"),a=!!p.hasMinBoundary&&p.hasMinBoundary(),i=!!p.hasMaxBoundary&&p.hasMaxBoundary(),n=p.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:x,next:c,prev:m.reverse(),hasMin:a,hasMax:i,current:n,numNext:t.numNext,numPrev:t.numPrev}),l.setValue(t.id,"photoContextList",M),{next:c,previous:m.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photos-getPerms-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:function(s,i){var o={photo_id:s.id},t=this;return e.Promise.all([i.callAPI("flickr.photos.getPerms",o),i.getModelRegistry("photo-privacy-models")]).then(function(e){return t._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s,i=e[0],o=e[1];s={id:r.id,isPublic:i.perms.ispublic,isVisibleByFriends:i.perms.isfriend,isVisibleByFamily:i.perms.isfamily,permAddMeta:i.perms.permaddmeta,permComment:i.perms.permcomment},o.addOrUpdate(s)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});YUI.add("photo-privacy-models",function(e){function i(e){i.superclass.constructor.call(this,e)}e.Models[this.name]=i,e.extend(i,e.FlickrModelRegistry,{name:this.name,remote:{read:function(i){return e.ModelFetchers["flickr-photos-getInfo"].run(i,this.appContext)},update:function(i,t){var r;return r={photo_id:i,is_public:this.getValue(i,"isPublic"),is_friend:this.getValue(i,"isVisibleByFriends"),is_family:this.getValue(i,"isVisibleByFamily"),perm_addmeta:this.getValue(i,"permAddMeta"),perm_comment:this.getValue(i,"permComment")},e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)},batchUpdate:function(i,t){var r;switch(!0){case"privacy"in t&&"commenting"in t&&"addMeta"in t:r={photo_ids:i,is_public:t.privacy.isPublic,is_friend:t.privacy.isVisibleByFriends,is_family:t.privacy.isVisibleByFamily,perm_addmeta:t.addMeta,perm_comment:t.commenting};break;case"privacy"in t&&"commenting"in t:r={photo_ids:i,is_public:t.privacy.isPublic,is_friend:t.privacy.isVisibleByFriends,is_family:t.privacy.isVisibleByFamily,perm_comment:t.commenting};break;case"privacy"in t&&"addMeta"in t:r={photo_ids:i,is_public:t.privacy.isPublic,is_friend:t.privacy.isVisibleByFriends,is_family:t.privacy.isVisibleByFamily,perm_addmeta:t.addMeta};break;case"commenting"in t&&"addMeta"in t:r={photo_ids:i,perm_addmeta:t.addMeta,perm_comment:t.commenting};break;case"privacy"in t:r={photo_ids:i,is_public:t.privacy.isPublic,is_friend:t.privacy.isVisibleByFriends,is_family:t.privacy.isVisibleByFamily};break;case"commenting"in t:r={photo_ids:i,perm_comment:t.commenting};break;case"addMeta"in t:r={photo_ids:i,perm_addmeta:t.addMeta}}return r.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(i){return e.AttributeHelpers.validateBoolean(i)},setter:function(i){return e.AttributeHelpers.coerceBoolean(i)},defaultValue:!1},isVisibleByFriends:{validator:function(i){return e.AttributeHelpers.validateBoolean(i)},setter:function(i){return e.AttributeHelpers.coerceBoolean(i)},defaultValue:!1},isVisibleByFamily:{validator:function(i){return e.AttributeHelpers.validateBoolean(i)},setter:function(i){return e.AttributeHelpers.coerceBoolean(i)},defaultValue:!1},permAddMeta:{validator:function(i){return e.AttributeHelpers.validateInteger(i)},setter:function(i){return e.AttributeHelpers.coerceInteger(i)},defaultValue:0},permComment:{validator:function(i){return e.AttributeHelpers.validateInteger(i)},setter:function(i){return e.AttributeHelpers.coerceInteger(i)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});YUI.add("flickr-people-getPhotos-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-people-getPhotos"]={run:function(t,s){var r=this,p=[s.callAPI("flickr.people.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("photo-privacy-models")];return t.createCompoundID&&s.getViewer().signedIn&&s.getViewer().nsid&&p.push(s.getModel("person-preferences-models",s.getViewer().nsid)),e.Promise.all(p).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o){var t={per_page:o.perPage||20,page:o.page||1,extras:e.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:o.withPhotoId||""};return o.id||o.userId?t.user_id=(o.id||o.userId).split("-")[0]:o.pathAlias&&(t.path_alias=o.pathAlias),o.privacyFilter&&(t.privacy_filter=o.privacyFilter),o.viewAs&&(t.view_as=o.viewAs),o.orderBy&&("datetaken"===o.orderBy?t.sort="date-taken-desc":t.sort=o.orderBy),o.safeSearch&&(t.safe_search=o.safeSearch),o.media&&(t.media=o.media),o.withPhotoId&&(t.jump_to=o.withPhotoId),o.contentType&&(t.content_type=o.contentType),t},_processResponse:function(o,t){var s,r,p=o[0],a=o[1],i=o[2],d=o[3],n=o[4],l=o[5],h=o[6],g=p&&p.user?p.user.nsid:null,c=t.id||t.userId;if(!g)throw new Error("API was missing valid nsid");return r={id:g,pathAlias:p.user.pathAlias,owner:e.APIHelper.response.parsePerson(p.user),totalItems:p.photos.total},c&&c!==g&&(r.id=c),o[7]&&(r.id=g+"-"+e.Models["person-preferences-models"].buildContextSuffix(o[7],g)),r.owner=i.addOrUpdate(r.owner),s=e.APIHelper.response.parsePhotos({photos:p.photos.photo,ownerID:p.photos.owner,personModelRegistry:i,photoModelRegistry:a,photoEngagementModelRegistry:n,photoStatsModelRegistry:l,photoPrivacyModelRegistry:h}),r.photoPageList={perPage:p.photos.perpage,page:p.photos.page,pageContent:s,totalItems:parseInt(p.photos.total,10)||0},d.addOrUpdate(r),s}}},"@VERSION@",{requires:["flickr-promise","api-helper","person-preferences-models"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]});YUI.add("photostream-models",function(e,t){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t,r=this.appContext.getViewer(),n=this.getValue(e,"normalizedId");return r&&r.nsid===n?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(t=this.getValue(e,"owner"))?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:t.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"})}},pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),r=this.getValue(e,"normalizedId");return"/photos/"+(t?t.getValue("pathAlias"):r)+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,n=r.splitCompoundId(e);return n.orderBy?(t=n.orderBy,n.viewAs?t+="-"+n.viewAs:"dateposted"===n.orderBy&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,r){var n=e;return t&&(n+="-"+t),r&&(t||(n+="-dateposted"),n+="-"+r),n},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]});YUI.add("person-model-helper",function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},username:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/photos/"+this.getValue(e,"pathAlias")+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proBadge:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},canBuyPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var r=this.getValue(t,"isPro"),n=this.getValue(t,"isAdFree");return r||n}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},expiringPartner:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},uploadCount:{defaultValue:null},uploadLimit:{defaultValue:null},uploadLimitStatus:{defaultValue:null},isCognitoUser:{defaultValue:null},hasAuthorizedMobile:{defaultValue:null},hasInvalidEmail:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper"]});YUI.add("flickr-people-getInfo-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:function(s,o){var t=this,i=o.getViewer();return i&&i.signedIn&&(s.id===i.nsid||s.nsid===i.nsid)&&(s.storage=1),new e.FlickrPromise({apiResponse:o.callAPI("flickr.people.getInfo",this._processParams(s,o),!0),personModelRegistry:o.getModelRegistry("person-models"),personRelationshipModelRegistry:o.getModelRegistry("person-relationship-models"),personProfileModelRegistry:o.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:o.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:o.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:o.getModelRegistry("person-notifications-models"),photostreamModelRegistry:o.getModelRegistry("photostream-models")}).then(function(e){return t._processResponse(e,s,o)},e.FetcherErrorLogger(r))},_processParams:function(r,s){var o={datecreate:1};if(o.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&r.id===s.request.probableUser?(o.storage=1,o.extras+=", classic_user_id, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref, products_features",o.extras+=", is_minor"):s.getViewer().signedIn&&r.id===s.getViewer().nsid&&(o.extras+=", products_features"),r.extras&&"string"==typeof r.extras&&r.extras.length>0&&(o.extras=o.extras+","+r.extras),r.id)o.user_id=r.id;else{if(!r.pathAlias)throw new Error("`fetch` is missing required params.");o.path_alias=r.pathAlias}return r.storage&&(o.storage=r.storage),o.extras||(o.extras=""),o.extras+=", has_stats",o},_processResponse:function(r,s,o){var t,i,a,n=r.apiResponse,d=r.personModelRegistry,l=r.personRelationshipModelRegistry,p=r.personProfileModelRegistry,u=r.personPreferencesModelRegistry,g=r.personGroupsModelRegistry,c=r.personNotificationsModelRegistry,m=r.photostreamModelRegistry,h=n.person,f=o.getViewer(),y=h.id,M=f&&f.signedIn&&y===f.nsid;return a={id:y,pathAlias:h.pathAlias,username:h.username&&h.username._content,realname:h.realname&&h.realname._content,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(h.iconurls),isAdFree:h.isAdFree,isPro:h.ispro,proBadge:h.proBadge,isMinor:h.isMinor,canBuyPro:h.canBuyPro,hasStats:h.hasStats,location:h.location&&h.location._content,hasAdfree:h.hasAdfree,has1TB:h.has1TB,has2TB:h.has2TB,hasUnlimitedStorage:h.hasUnlimitedStorage,hasFreeStandardShipping:h.hasFreeStandardShipping,hasFreeEducationalResources:h.hasFreeEducationalResources,dateCreated:h.datecreate._content,expiringPartner:h.expiringPartner},h.ispro&&(a.proExpireDate=h.expire),M&&(a.uploadLimit=h.uploadLimit,a.uploadCount=h.uploadCount,a.uploadLimitStatus=h.uploadLimitStatus,a.isCognitoUser=h.isCognitoUser,a.hasInvalidEmail=!1,h.email&&(!h.email||h.email._content&&""!==h.email._content)?h.email._content&&-1===h.email._content.indexOf("@")?a.hasInvalidEmail=!0:a.hasInvalidEmail=!1:a.hasInvalidEmail=!0),d.addOrUpdate(a),c.addOrUpdate({id:y,unreadFlickrMailCount:h.unreadMessages?h.unreadMessages.content:0}),l.addOrUpdate({id:y,pathAlias:h.pathAlias,isContact:h.contact,isFriend:h.friend,isFamily:h.family,isIgnored:h.ignored,isIgnoredBy:h.ignoredby,isRevContact:h.revcontact,isRevFriend:h.revfriend,isRevFamily:h.revfamily}),M&&(i={id:y},h.safeSearch&&(i.safeSearch=(h.safeSearch||1)-1),h.viewPrefs&&(i.unifiedSearchViewPref=h.viewPrefs.unifiedSearchViewPref,i.photostreamViewOrderPref=h.viewPrefs.photostreamViewOrderPref,i.photostreamViewAsPref=h.viewPrefs.photostreamViewAsPref,i.albumViewLayoutPref=h.viewPrefs.albumViewLayout,i.galleryViewLayoutPref=h.viewPrefs.galleriesViewLayoutPref),u.exists(y)?u.setValues(y,i):u.add(i)),t={id:y,coverPhotoUrls:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(h.coverphoto_url),photoCount:h.photos.count.content,location:h.location?h.location.content:null,arrPhotoCount:h.all_rights_reserved_photos_count},h.storage&&(t.storageUsed=h.storage.used.content,t.storageTotal=h.storage.total.content),h.unreadMessages&&(t.unreadMessages=h.unreadMessages.content),p.addOrUpdate(t),g.addOrUpdate({id:y,memberCount:h.groupMemberships?h.groupMemberships.member:null,moderatorCount:h.groupMemberships?h.groupMemberships.moderator:null,adminCount:h.groupMemberships?h.groupMemberships.admin:null,invitedCount:h.groupMemberships?h.groupMemberships.invited:null}),m.addOrUpdate({id:y,pathAlias:h.pathAlias,owner:d.proxy(y),totalItems:h.photos.count&&h.photos.count.content}),h}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","photostream-models","api-helper"]});YUI.add("person-relationship-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[],n={};return e.Lang.isObject(i,!0)&&(n.user_id=t,n.friend=this.getValue(t,"isFriend"),n.family=this.getValue(t,"isFamily"),"isContact"in i&&(i.isContact.newVal?r.push(e.ModelUpdaters["flickr-contacts-add"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-remove"].run(n,this.appContext))),("isFriend"in i||"isFamily"in i)&&("isFriend"in i&&(n.friend=i.isFriend.newVal),"isFamily"in i&&(n.family=i.isFamily.newVal),r.push(e.ModelUpdaters["flickr-contacts-edit"].run(n,this.appContext))),"isIgnored"in i&&(!0===i.isIgnored.newVal?r.push(e.ModelUpdaters["flickr-contacts-block"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-unblock"].run(n,this.appContext)))),e.Promise.all(r)}},toggleFollowing:function(e){this.getValue(e,"isContact")?this.setValue(e,"isContact",!1):this.setValue(e,"isContact",!0)},toggleFriend:function(e){this.getValue(e,"isFriend")?this.setValue(e,"isFriend",!1):this.setValue(e,"isFriend",!0)},toggleFamily:function(e){this.getValue(e,"isFamily")?this.setValue(e,"isFamily",!1):this.setValue(e,"isFamily",!0)},toggleIgnore:function(e){this.getValue(e,"isIgnored")?this.setValue(e,"isIgnored",!1):this.setValue(e,"isIgnored",!0)},attributes:{pathAlias:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnoredBy:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnored:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isMe:{readOnly:!0,getter:function(e,t){var i=this.appContext.getViewer();return!!i&&this.getValue(t,"nsid")===i.nsid}},nsid:{readOnly:!0,defaultFn:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-contacts-add-updater","flickr-contacts-remove-updater","flickr-contacts-edit-updater","flickr-contacts-block-updater","flickr-contacts-unblock-updater","attribute-helpers"]});YUI.add("flickr-profile-setProfile-updater",function(e,i){"use strict";e.namespace("ModelUpdaters")["flickr-profile-setProfile"]={run:function(l,r){var t=(function(e){var i={};return i.extras="full_response,expand_bbml,social_urls","profileDescription"===e.field?e.field="description":"website"===e.field&&(e.field="website_url"),i[e.field]=e.value,i})(l);return new e.FlickrPromise({apiResponse:r.callAPI("flickr.profile.setProfile",t),personPublicProfileModel:r.getModel("person-public-profile-models",l.id)}).then(function(e){return(function(e,i,l,r){var t=e.apiResponse,o=e.personPublicProfileModel;if(t){var s=t[l.field],f={stat:t.stat,field:l.field,value:s};return"description"===l.field?(l.field="profileDescription",o.setValue("profileDescription",t.description),o.setValue("profileDescriptionExpanded",t.descriptionExpanded)):"website_url"===l.field?(l.field="website",o.setValue("website",s)):["instagram","facebook","tumblr","pinterest","twitter"].indexOf(l.field)>-1?(o.setValue(l.field,t[l.field]),o.setValue(l.field+"Url",t[l.field+"Url"])):void 0===s?o.setValue(l.field,i[l.field]):o.setValue(l.field,s),f}})(e,t,l)}.bind(this),e.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-public-profile-models"]});YUI.add("person-public-profile-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-profile-getProfile"].run(t,this.appContext)},updateField:function(t,r){return e.ModelUpdaters["flickr-profile-setProfile"].run(t,r)}},remoteUpdateDescription:function(e,t,r){return this.setValue(e,"description",t.description),this.remote.updateBioField(t,r)},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}},joinedDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},showcaseSetId:{defaultValue:0},city:{},country:{},firstName:{},lastName:{},hometown:{},email:{},occupation:{},profileDescription:{},profileDescriptionExpanded:{},timezone:{},website:{},facebook:{},facebookUrl:{},instagram:{},instagramUrl:{},tumblr:{},tumblrUrl:{},twitter:{},twitterUrl:{},pinterest:{},pinterestUrl:{},totalViews:{},totalTags:{},totalGeotagged:{},totalFaves:{},totalInGroup:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-profile-getProfile-fetcher","flickr-profile-setProfile-updater"]});YUI.add("flickr-profile-getProfile-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-profile-getProfile"]={run:function(t,s){var o=this,i=s.getViewer();return i&&i.signedIn&&(t.id===i.nsid||t.nsid===i.nsid)&&(t.storage=1),new e.FlickrPromise({apiResponse:s.callAPI("flickr.profile.getProfile",this._processParams(t,s),!0),personPublicProfileModelRegistry:s.getModelRegistry("person-public-profile-models")}).then(function(e){return o._processResponse(e,t,s)},e.FetcherErrorLogger(r))},_processParams:function(r,t){var s={datecreate:1};if(s.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&r.id===t.request.probableUser&&(s.storage=1,s.extras+=", classic_user_id, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref",s.extras+=", products_features",s.extras+=", is_minor"),r.extras&&"string"==typeof r.extras&&r.extras.length>0&&(s.extras=s.extras+","+r.extras),r.id)s.user_id=r.id;else{if(!r.pathAlias)throw new Error("`fetch` is missing required params.");s.path_alias=r.pathAlias}return r.storage&&(s.storage=r.storage),s.extras||(s.extras=""),s.extras+=", has_stats,expand_bbml,social_urls,with_stats",s},_processResponse:function(e,r,t){var s=e.apiResponse,o=e.personPublicProfileModelRegistry,i={};if(s&&s.profile){var a=s.profile,l=s.stats;return i={city:a.city,country:a.country,firstName:a.firstName,lastName:a.lastName,hometown:a.hometown,email:a.email,nsid:a.nsid,id:a.nsid,showcaseSetId:a.showcaseSet||0,joinedDate:a.join_date,occupation:a.occupation,profileDescription:a.profileDescription,profileDescriptionExpanded:a.profileDescriptionExpanded,website:a.website,twitter:a.twitter,twitterUrl:a.twitterUrl,instagram:a.instagram,instagramUrl:a.instagramUrl,facebook:a.facebook,facebookUrl:a.facebookUrl,tumblr:a.tumblr,tumblrUrl:a.tumblrUrl,pinterest:a.pinterest,pinterestUrl:a.pinterestUrl,totalViews:l?l.photoViews:0,totalTags:l?l.tags:0,totalGeotagged:l?l.geotagged:0,totalFaves:l?l.faves:0,totalInGroup:l?l.groups:0},o.addOrUpdate(i)}}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-public-profile-models","person-groups-models","photostream-models","api-helper"]});YUI.add("user-limits-helper",function(i){var t=i.config.flickr.account.photo_limit,e=i.config.flickr.account.near_photo_limit;i.UserLimitsHelper={isNearUploadLimit:function(i,o){return o.getViewer().signedIn&&!o.getViewer().isPro&&i.getValue("photoCount")>=e&&i.getValue("photoCount")<t},isAtUploadLimit:function(i,e){return e.getViewer().signedIn&&!e.getViewer().isPro&&i.getValue("photoCount")>=t},isOverUploadLimit:function(i,e){return e.getViewer().signedIn&&!e.getViewer().isPro&&i.getValue("photoCount")>t},isOverARRLimit:function(i,e){return e.getViewer().signedIn&&!e.getViewer().isPro&&this.getARRCount(i)>t},hasReachedNearUploadLimit:function(i,t){return this.isNearUploadLimit(i,t)||this.isAtUploadLimit(i,t)||this.isOverUploadLimit(i,t)},hasReachedUploadLimit:function(i,t){return this.isAtUploadLimit(i,t)||this.isOverUploadLimit(i,t)},remainingAvailableUploads:function(i,t){return t.getValue("uploadLimit")-i.getValue("photoCount")},getARRCount:function(i){var t=i.getValue("arrPhotoCount");return t>=0?t:i.getValue("photoCount")}}},"@VERSION@",{requires:[]});YUI.add("photo-limit-overlay-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("photo-limit-overlay-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(e){this.params=e},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e=this.params.overlayClassList||[];this.setContainerWithTemplate("photo-limit-overlay",{additionalClasses:e.join(" ")})},activate:function(){var t=this,i=this.get("container");if(this.panelContainer=i.one(".panel-container"),this.dismissCookieName=e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name,!this.appContext.getCookie(this.dismissCookieName))return e.Promise.all([this.appContext.getModel("person-public-profile-models",this.appContext.getViewer().nsid).then(function(e){t.publicProfileModel=e}),this.appContext.getModel("person-profile-models",this.appContext.getViewer().nsid).then(function(e){t.profileModel=e})]).then(function(){t.isLoaded=!0,t.fire("loaded")})},show:function(){var t,i,n,a,l,s=this,o=this.get("container"),p="",r=e.config.flickr.account.photo_limit,h=e.UserLimitsHelper.getARRCount(this.profileModel);this.appContext.getCookie(this.dismissCookieName)||(i=parseInt(this.publicProfileModel.getValue("totalViews")),n=parseInt(this.publicProfileModel.getValue("totalFaves")),a=parseInt(this.publicProfileModel.getValue("totalTags")),l=Math.max(h-r,0).toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),p="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.RIGHT_NOW_PHOTOS_AT_RISK",count:l}))+"</p>",i>1&&n<=1&&a<=1?p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS",views:e.IntlNumber.format(i,this.appContext.lang,1)}))+"</p>":i<=1&&n>1&&a<=1?p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES",faves:e.IntlNumber.format(n,this.appContext.lang,1)}))+"</p>":i>1&&n>1&&a<=1?p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES",views:e.IntlNumber.format(i,this.appContext.lang,1),faves:e.IntlNumber.format(n,this.appContext.lang,1)}))+"</p>":i<=1&&n<=1&&a>1?p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_TAGS",tags:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":i>1&&n<=1&&a>1?p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_TAGS",views:e.IntlNumber.format(i,this.appContext.lang,1),tags:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":i<=1&&n>1&&a>1?p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES_TAGS",faves:e.IntlNumber.format(n,this.appContext.lang,1),tags:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":i>1&&n>1&&a>1&&(p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES_TAGS",views:e.IntlNumber.format(i,this.appContext.lang,1),faves:e.IntlNumber.format(n,this.appContext.lang,1),tags:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>"),p+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.TAKE_MOMENT_TO_PROTECT_PHOTOS"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:0,title:this.intlMessage({intlName:"upload-blocking.PROTECT_THESE_PHOTOS"}),description:p,acceptButtonText:this.intlMessage({intlName:"upload-blocking.SAVE_YOUR_PHOTOS"}),declineButtonText:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"upload-blocking.MARK_PHOTOS_FOR_DELETION_B",count:l}):this.intlMessage({intlName:"upload-blocking.MARK_PHOTOS_FOR_DELETION",count:l}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"}),initialActive:!0})),p="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.UPGRADE_YOU_ALSO_GET"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:1,title:this.intlMessage({intlName:"upload-blocking.DID_YOU_KNOW_FLICKR_PRO"}),description:p,acceptButtonText:this.intlMessage({intlName:"refencing-announcement.UPGRADE_TO_PRO"}),declineButtonText:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"upload-blocking.CONTINUE_WITHOUT_SECURING_PHOTOS_B",count:l}):this.intlMessage({intlName:"upload-blocking.CONTINUE_WITHOUT_SECURING_PHOTOS",count:l}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"})})),p="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.FLICKR_PROS_LOVE_PHOTOGRAPHY"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:2,title:this.intlMessage({intlName:"upload-blocking.DONT_NEED_TO_BE_PROFESSIONAL"}),description:p,acceptButtonText:this.intlMessage({intlName:"upload-blocking.JOIN_FLICKR_PRO"}),declineButtonText:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"upload-blocking.DONT_REMIND_AGAIN_B"}):this.intlMessage({intlName:"upload-blocking.DONT_REMIND_AGAIN"})})),t=this.panelContainer.all(".panel"),o.addClass("unhidden"),setTimeout(function(){o.addClass("active")},50),this.panelCount=t?t.size():0,this.registerEventHandler(o.delegate("click",function(e){s.handleDeclineClick(e)},".decline-button")))},hide:function(){var t=this.get("container");t.removeClass("active"),setTimeout(function(){t.removeClass("unhidden"),e.fire("photoLimitOverlay:hidden")},1e3)},showPanel:function(e){var t,i=this.get("container"),n=i.all(".panel"),a=i.one(".panel.active");e<n.size()&&(a.addClass("off-left"),a.removeClass("active"),setTimeout(function(){a.addClass("hidden")},1e3),(t=n.item(e)).removeClass("hidden"),t.addClass("active"),setTimeout(function(){t.removeClass("off-right")},50))},handleDeclineClick:function(t){var i=t.target.ancestor(".panel",!0),n=parseInt(i.getAttribute("data-panel-index"));if(n+1<this.panelCount)this.showPanel(n+1);else{var a=new Date;a.setTime(a.getTime()+36e10),this.appContext.setCookie({cookieName:this.dismissCookieName,cookieValue:1,expires:a,path:"/"}),this.appContext.setCookie({cookieName:e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,cookieValue:1,expires:a,path:"/"}),this.hide()}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-limit-overlay","hermes-template-photo-limit-panel","person-public-profile-models","intl-number","user-limits-helper","string-helper"],langBundles:["upload-blocking","refencing-announcement"]});