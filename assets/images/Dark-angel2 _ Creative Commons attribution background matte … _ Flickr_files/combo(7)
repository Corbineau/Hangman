YUI.add("flickr-photos-getInfo-fetcher",function(o,e){"use strict";o.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:function(t,s){var r,i=this;return s.flipper.isFlipped("enable-scrappy-photo-page")&&(t.scrappy=!0),r=this._processParams(t),new o.FlickrPromise({apiResponse:s.callAPI("flickr.photos.getInfo",r,!0),photoRegistry:s.getModelRegistry("photo-models"),personRegistry:s.getModelRegistry("person-models"),personRelationshipRegistry:s.getModelRegistry("person-relationship-models"),photoEngagementRegistry:s.getModelRegistry("photo-engagement-models"),photoStatsRegistry:s.getModelRegistry("photo-stats-models"),photoPrivacyRegistry:s.getModelRegistry("photo-privacy-models"),photoNotesRegistry:s.getModelRegistry("photo-notes-models"),noteRegistry:s.getModelRegistry("note-models"),photoGeoRegistry:s.getModelRegistry("photo-geo-models"),photoLocationRegistry:s.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:s.getModelRegistry("photo-head-meta-models"),groupRegistry:s.getModelRegistry("group-models"),contextsRegistry:s.getModelRegistry("photo-contexts-models"),favoriteRegistry:s.getModelRegistry("favorite-models"),galleryRegistry:s.getModelRegistry("gallery-models"),groupsPoolRegistry:s.getModelRegistry("group-pool-models"),setRegistry:s.getModelRegistry("set-models"),photostreamRegistry:s.getModelRegistry("photostream-models")}).then(function(o){return i._processResponse(o,s.flipper,r)},o.FetcherErrorLogger(e))},_processParams:function(e){var t,s;return t=["sizes","icon_urls","ignored","rev_ignored","rev_contacts","venue","datecreate"].join(","),t=t+","+o.APIHelper.request.getRebootPhotoExtras(),s={datecreate:1,extras:t,photo_id:e.id,get_contexts:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"},e.userId?s.user_id=e.userId:e.pathAlias&&(s.path_alias=e.pathAlias),e.context&&(s.context=e.context,s.num_prev=1,s.num_next=1),e.scrappy&&(o.APIHelper.request.addStaticMapsParams(s),delete s.get_contexts,delete s.primary_photo_extras,delete s.context),s},_processResponse:function(e,t,s){var r,i,p,n,a,h,d,l,g,c,y=e.apiResponse,m=e.photoRegistry,u=e.personRegistry,R=e.personRelationshipRegistry,M=e.photoEngagementRegistry,f=e.photoStatsRegistry,w=e.photoPrivacyRegistry,v=e.photoNotesRegistry,T=e.noteRegistry,x=e.photoGeoRegistry,A=e.photoLocationRegistry,H=e.photoHeadMetaRegistry,P=e.groupRegistry,_={},k=[];if(!y.photo.sizes)throw new Error("Missing photo sizes from flickr.photos.getInfo call.");i={id:y.photo.id,title:y.photo.title.content,description:y.photo.description.content,sizes:o.APIHelper.response.parsePhotoSize(y.photo.sizes.size,!0),needsInterstitial:y.photo.needsInterstitial,canComment:y.photo.editability.cancomment,canPublicComment:y.photo.publiceditability.cancomment,canAddMeta:y.photo.editability.canaddmeta,safetyLevel:y.photo.safetyLevel,license:y.photo.license,mediaType:y.photo.media,secret:y.photo.secret,isHD:o.APIHelper.response.isHD(y.photo.sizes.size),rotation:y.photo.rotation,oWidth:y.photo.oWidth?parseInt(y.photo.oWidth,10):"",oHeight:y.photo.oHeight?parseInt(y.photo.oHeight,10):"",visibilitySource:y.photo.visibilitySource,isVideoPending:y.photo.video?y.photo.video.pending:0},p={id:y.photo.owner.nsid,username:y.photo.owner.username,realname:y.photo.owner.realname,pathAlias:y.photo.owner.pathAlias,buddyicon:o.APIHelper.response.agnosticizeFarmPathTransferProtocol(y.photo.owner.iconurls),isAdFree:y.photo.owner.isAdFree,isPro:y.photo.owner.ispro,proBadge:y.photo.owner.proBadge,dateCreated:y.photo.owner.datecreate,location:y.photo.owner.location},n={id:y.photo.owner.nsid,pathAlias:y.photo.owner.pathAlias,isContact:y.photo.contactIscontact,isFamily:y.photo.contactIsfamily,isFriend:y.photo.contactIsfriend,isIgnored:y.photo.owner.isignored,isIgnoredBy:y.photo.owner.revIgnored,isRevContact:y.photo.owner.revContact,isRevFamily:y.photo.owner.revFamily,isRevFriend:y.photo.owner.revFriend},a={id:y.photo.id,ownerNsid:y.photo.owner.nsid,isFaved:y.photo.isfavorite||!1,canShare:y.photo.usage.canshare,canDownload:y.photo.usage.candownload,commentCount:y.photo.comments.content,noteCount:y.photo.notes&&y.photo.notes.note&&y.photo.notes.note.length,faveCount:y.photo.countFaves,viewCount:y.photo.views},h={id:y.photo.id,dateTaken:y.photo.dates.taken,datePosted:y.photo.dates.posted,takenGranularity:y.photo.dates.takengranularity,isDateTakenUnknown:y.photo.datetakenunknown||"1"===y.photo.datetakenunknown||1===y.photo.datetakenunknown},l={id:y.photo.id,title:y.photo.HTMLMETA["og:title"],noindexfollow:y.photo.owner.noindexfollow,keywords:y.photo.HTMLMETA.keywords,"og:title":y.photo.HTMLMETA["og:title"],"og:description":y.photo.HTMLMETA["og:description"],"og:type":y.photo.HTMLMETA["og:type"],"og:url":y.photo.HTMLMETA["og:url"],"og:image":y.photo.HTMLMETA["og:image"],"og:image:width":y.photo.HTMLMETA["og:image:width"],"og:image:height":y.photo.HTMLMETA["og:image:height"],"flickr_photos:by":y.photo.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":y.photo.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":y.photo.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":y.photo.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":y.photo.HTMLMETA["flickr_photos:galleries"],"twitter:card":y.photo.HTMLMETA["twitter:card"],"twitter:description":y.photo.HTMLMETA["twitter:description"],"twitter:app:url:iphone":y.photo.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":y.photo.HTMLMETA["twitter:creator"],pinterest:y.photo.HTMLMETA.pinterest},d={id:y.photo.id,isPublic:y.photo.visibility.ispublic,isVisibleByFriends:y.photo.visibility.isfriend,isVisibleByFamily:y.photo.visibility.isfamily,permAddMeta:y.photo.permissions?y.photo.permissions.permaddmeta:0,permComment:y.photo.permissions?y.photo.permissions.permcomment:0},y.photo&&y.photo.notes&&y.photo.notes.note&&o.Array(y.photo.notes.note).forEach(function(o){k.push(T.addOrUpdate({id:o.id,author:o.author,authorName:o.authorname,authorRealName:o.authorrealname,authorIsPro:o.authorispro,authorProBadge:o.proBadge,authorIsDeleted:o.authorisdeleted,left:o.x,top:o.y,width:o.w,height:o.h,text:o.content}))}),g=o.ModelFetchers["flickr-photos-getLocation"].mapResponse(y,x),i.owner=u.addOrUpdate(p),i.engagement=M.addOrUpdate(a),R.addOrUpdate(n),c=m.addOrUpdate(i),f.addOrUpdate(h),w.addOrUpdate(d),v.addOrUpdate({id:i.id,notes:k}),H.addOrUpdate(l),A.addOrUpdate(g),y.photo.contexts&&(r=e.contextsRegistry,_.faves=e.favoriteRegistry,_.gallery=e.galleryRegistry,_.pool=e.groupsPoolRegistry,_.set=e.setRegistry,_.stream=e.photostreamRegistry,(function(e){var t=e.photoModel,s=e.contextRegistries,r=e.contextsResponse,i=e.personRegistry,p=e.contextsRegistry,n=e.photoEngagementRegistry,a=e.photoStatsRegistry,h=e.groupRegistry,d=e.apiParams,l=[];o.Object.each(s,function(e,s){r[s]&&o.Array.each(r[s],function(s){o.APIHelper.response.addContextToRegistry(s,e,i,h),l.push(e.proxy(s.id)),d.context&&(function(){var r,p,h,l,g,c,y,m,u;p=!!(r=e.getValue(s.id,"photoContextList")).hasMinBoundary&&r.hasMinBoundary(),h=!!r.hasMaxBoundary&&r.hasMaxBoundary(),l=r.getList(),c=s.nextphotos,y=s.prevphotos,m=c?o.APIHelper.response.parsePhotos({photos:c.photo,personModelRegistry:i,photoModelRegistry:t.registry,photoEngagementModelRegistry:n,photoStatsModelRegistry:a}):[],((u=y?o.APIHelper.response.parsePhotos({photos:y.photo,personModelRegistry:i,photoModelRegistry:t.registry,photoEngagementModelRegistry:n,photoStatsModelRegistry:a}):[]).length||m.length)&&(g=o.APIHelper.response.addOrReplaceListByContext({model:t,next:m,prev:u.reverse(),current:l,hasMin:p,hasMax:h,numNext:d.num_next,numPrev:d.num_prev})),e.setValue(s.id,"photoContextList",g)})()})}),p.exists(t.id)||(p.add({id:t.id,totalGroups:r.pool?r.pool.length:0,totalSets:r.set?r.set.length:0,totalGalleries:r.gallery?r.gallery.length:0}),p.setValue(t.id,"contexts",l))})({photoModel:c,contextRegistries:_,contextsResponse:y.photo.contexts,personRegistry:u,contextsRegistry:r,photoEngagementRegistry:M,photoStatsRegistry:f,groupRegistry:P,apiParams:s}))}}},"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-geo-models","photo-location-models","photo-head-meta-models","note-models","photo-notes-models","autotag-models","photo-autotags-models"]});YUI.add("flickr-photos-setPerms-updater",function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:function(s,o){var t=this;return s.nsid=o.getViewer().nsid,e.Promise.all([o.callAPI("flickr.photos.setPerms",s),o.getModelRegistry("photostream-models")]).then(function(e){return t._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s=e[0],o=e[1];if(o.attributeSearch({normalizedId:r.nsid},!0).forEach(function(e){o.remove(e)}),r.full_response)return s.photoIdsSent=r.photo_ids,s}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photos-setMeta-updater",function(t,e){"use strict";var o=require("hermes-core/flog")(e);t.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:function(r,i){var s={};return r.fullResponse?(s.full_response=1,s.photo_ids=r.photoId):s.photo_id=r.photoId,void 0!==r.title&&(s.title=r.title),void 0!==r.description&&(s.description=r.description),t.Promise.all([i.callAPI("flickr.photos.setMeta",s),i.getModelRegistry("photo-models")]).then(function(t){var e=t[0],i=t[1];if(r.fullResponse){if("errors"in e)return e.api="setMeta",e}else{if(!i.exists(r.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");e.photo&&e.photo.title&&e.photo.description?i.setValues(r.photoId,{title:e.photo.title.content,description:e.photo.description.content}):o.warn("No updated data returned from API.")}},function(t){throw r.fullResponse&&(t.photoIds=r.photoId,t.returnApi="setMeta"),t}).then(null,t.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-photos-licenses-setLicense-updater",function(e,s){"use strict";e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:function(o,n){var t={};return o.fullResponse?(t.photo_ids=o.photoId,t.full_response=1):t.photo_id=o.photoId,t.license_id=o.license,n.callAPI("flickr.photos.licenses.setLicense",t).then(function(e){if("errors"in e)return e.api="setLicense",e},function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setLicense"),e}).then(null,e.FetcherErrorLogger(s))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photos-setSafetyLevel-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:function(o,r){var s={};return o.fullResponse?(s.photo_ids=o.photoId,s.full_response=1):s.photo_id=o.photoId,s.safety_level=o.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",s).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setSafety"),e}).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[];return("title"in i||"description"in i)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title?i.title.newVal:this.getValue(t,"title"),description:i.description?i.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in i&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:i.license.newVal},this.appContext)),"safetyLevel"in i&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:i.safetyLevel.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,i){var r=[];return"safetyLevel"in i&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(i.safetyLevel,10),fullResponse:1},this.appContext)),"title"in i&&"description"in i?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title,description:i.description,fullResponse:1},this.appContext)):"title"in i?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title,fullResponse:1},this.appContext)):"description"in i&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:i.description,fullResponse:1},this.appContext)),"license"in i&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:i.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getSizeForCanvas:e.PhotoModelHelper.getSizeForCanvas,getGuestpass:function(t){var i=this;return new e.Promise(function(e,r){i.getValue(t,"guestpass")?e():i.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then(function(r){i.setValue(t,"guestpass",r.guestpass.url),e()})})},canVr:function(t){var i,r=!1;return this.appContext.flipper.isFlipped("enable-vr")?(this&&(i=this.getValue(t,"aspectRatio"))&&i>=1.99&&i<=2.01&&(r=!0),r?e.Promise.all([this.appContext.callAPI("flickr.vr.isEquirectangular",{photo_id:t})]).then(function(t){return e.Promise.resolve(!!t[0].is_equirectangular)}):e.Promise.resolve(!1)):e.Promise.resolve(!1)},attributes:{title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,canPublicComment:e.PhotoModelHelper.attributes.canPublicComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,similaritySearchURL:e.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:e.PhotoModelHelper.attributes.basicSimilaritySearchURL,owner:{isModel:!0},engagement:{isModel:!0},isHD:{},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(t){var i=this.getValue(t,"sizes");return e.Object.each(i,function(e,t){e.src=e.url}),i}},stats:{isModel:!0},visibilitySource:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1},isVideoPending:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});YUI.add("flickr-groups-pools-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-groups-pools-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.groups.pools.getContext",this._processParams(t),!0),s.getModelRegistry("group-pool-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 2===e.code&&"Photo not in pool"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){var t={photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras()+",datecreate",num_prev:o.numNext,num_next:o.numPrev,get_group_info:1};if(o.id)t.group_id=o.id;else{if(!o.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=o.pathAlias}return t},_processResponse:function(o,t){var s,r,n,p,i,a,l=o[0],h=o[1],g=o[2],d=o[3],u=o[4],m=o[5],c=[],x=[],y=g.proxy(t.photoId),M=[];return s=l.prevphotos,r=l.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:d,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:d,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=h.getValue(t.id,"photoContextList"),p=!!a.hasMinBoundary&&a.hasMinBoundary(),i=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),current:n,hasMin:p,hasMax:i,numNext:t.numNext,numPrev:t.numPrev}),h.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","photo-engagement-models","photo-stats-models","group-models"]});YUI.add("flickr-groups-pools-add-creator",function(o,e){"use strict";o.namespace("ModelCreators")["flickr-groups-pools-add"]={run:function(t,r){var p=this,s=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.add",s),groupPoolModel:r.getModel(l,t.groupID),photoModel:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModel=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return p._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModel,p=o.photoModel,s=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,u=o.unfilteredGroupPoolModel;if("ok"===t.stat)return r&&!r.hasPhoto(p.getValue("id"))&&(r.addPhotoLocal(p),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1)),u&&u.hasPhoto(p.getValue("id"))&&u.addPhotoLocal(p),s.exists(e.photoID)&&!s.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(s.getValue(e.photoID,"groups").unshift(r),s.setValue(e.photoID,"total",s.getValue(e.photoID,"total")+1)),l.exists(e.photoID)&&!l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")+1),l.getValue(e.photoID,"contexts").push(r)),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-pools-remove-deletor",function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-groups-pools-remove"]={run:function(t,r){var s=this,p=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:r.callAPI("flickr.groups.pools.remove",p),groupPoolModelRegistry:r.getModel(l,t.groupID),photoModelRegistry:r.getModel("photo-models",t.photoID),photoGroupsModelRegistry:r.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:r.getModelRegistry("photo-contexts-models")};return t.unfilteredGroupId=p.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModelRegistry=r.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return s._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t=o.apiResponse,r=o.groupPoolModelRegistry,s=o.photoModelRegistry,p=o.photoGroupsModelRegistry,l=o.photoContextsModelRegistry,u=o.unfilteredGroupPoolModelRegistry;if("ok"===t.stat)return l.exists(e.photoID)&&l.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(l.setValue(e.photoID,"totalGroups",l.getValue(e.photoID,"totalGroups")-1),l.getValue(e.photoID,"contexts").removeFromList(e.unfilteredGroupId)),p.exists(e.photoID)&&p.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(p.setValue(e.photoID,"total",p.getValue(e.photoID,"total")-1),p.getValue(e.photoID,"groups").removeFromList(e.unfilteredGroupId)),r&&(r.hasPhoto(s.getValue("id"))&&r.removePhotoLocal(s),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")-1)),u&&u.hasPhoto(s.getValue("id"))&&u.removePhotoLocal(s),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-invite-creator",function(o,t){"use strict";o.namespace("ModelCreators")["flickr-groups-invite-photo-invite"]={run:function(e,i){var r={},p=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return r.photo_id=e.photoID,r.group_id=p,o.Promise.all([i.callAPI("flickr.groups.invite.photo.invite",r),i.getModel("group-pool-models",p),i.getModelRegistry("photo-group-invitation-models"),i.getModelRegistry("photo-group-invitations-models")]).then(function(o){var t,r,n,s=o[0],l=o[1],u=o[2],d=o[3];if("ok"===s.stat)return t=[e.photoID,p].join("-"),r={id:t,photoId:e.photoID,groupId:p,invitedBy:i.getViewer().nsid},n=u.exists(t)?u.proxy(t):u.add(r),d.exists(e.photoID)&&!d.getValue(e.photoID,"invitations").getFromListByID(t)&&(d.getValue(e.photoID,"groups").prependToList(l),d.getValue(e.photoID,"invitations").prependToList(n),d.setValue(e.photoID,"total",d.getValue(e.photoID,"total")+1)),l},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("flickr-groups-invite-photo-cancel-deletor",function(o,t){"use strict";o.namespace("ModelDeletors")["flickr-groups-invite-photo-cancel"]={run:function(e,r){var i={},l=o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID);return i.photo_id=e.photoID,i.group_id=l,o.Promise.all([r.callAPI("flickr.groups.invite.photo.cancel",i),r.getModel("group-pool-models",l),r.getModelRegistry("photo-group-invitation-models"),r.getModelRegistry("photo-group-invitations-models")]).then(function(o){var t,r=o[0],i=o[1],p=o[2],s=o[3];if("ok"===r.stat)return t=[e.photoID,l].join("-"),s.exists(e.photoID)&&s.getValue(e.photoID,"invitations").getFromListByID(t)&&(s.setValue(e.photoID,"total",s.getValue(e.photoID,"total")-1),s.getValue(e.photoID,"groups").removeFromList(l),s.getValue(e.photoID,"invitations").removeFromList(t)),p.remove(t),i},o.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-pool-by-person-models",function(e){function o(e){o.superclass.constructor.call(this,e)}e.Models[this.name]=o,e.extend(o,e.Models["group-pool-models"],{name:this.name,attributes:e.merge(e.Models["group-pool-models"].prototype.attributes,{personFilter:{validator:function(o,r){return e.AttributeHelpers.validateString(o)},setter:function(o){return e.AttributeHelpers.coerceString(o)},defaultValue:null}})})},"@VERSION@",{requires:["attribute-helpers","group-pool-models","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor"]});YUI.add("group-pool-by-tag-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.Models["group-pool-models"],{name:this.name,attributes:{tagFilter:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:null}}})},"@VERSION@",{requires:["attribute-helpers"]});YUI.add("flickr-groups-pools-getPhotos-fetcher",function(o,e){"use strict";o.namespace("ListFetchers")["flickr-groups-pools-getPhotos"]={run:function(t,r){var s=this,p=this._processParams(t),l={apiResponse:r.callAPI("flickr.groups.pools.getPhotos",p,!0),photoModelRegistry:r.getModelRegistry("photo-models"),personModelRegistry:r.getModelRegistry("person-models"),groupPoolModelRegistry:r.getModelRegistry("group-pool-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:r.getModelRegistry("photo-stats-models"),groupModelRegistry:r.getModelRegistry("group-models")};return t.personFilter&&(l.groupPoolByPersonModelRegistry=r.getModelRegistry("group-pool-by-person-models")),t.tagFilter&&(l.groupPoolByTagModelRegistry=r.getModelRegistry("group-pool-by-tag-models")),new o.FlickrPromise(l).then(function(o){return s._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){var t={extras:o.APIHelper.request.getRebootPhotoExtras()+","+o.APIHelper.request.getRebootGroupExtras(),per_page:e.perPage||20,page:e.page||1,get_group_info:1};if(e.id)t.group_id=o.Models["group-pool-models"].extractGroupFromCompoundId(e.id);else{if(!e.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");t.group_path_alias=e.pathAlias}return e.withPhotoId&&(t.jump_to=e.withPhotoId),e.privacyFilter&&(t.privacy_filter=e.privacyFilter),e.safeSearch&&(t.safe_search=e.safeSearch),e.media&&(t.media=e.media),e.personFilter&&(t.user_id=e.personFilter),e.tagFilter&&(t.tags=e.tagFilter),t},_processResponse:function(e,t){var r,s,p,l,i=e.apiResponse,g=e.photoModelRegistry,a=e.personModelRegistry,d=e.groupPoolModelRegistry,u=e.groupPoolByPersonModelRegistry,n=e.groupPoolByTagModelRegistry,h=e.photoEngagementModelRegistry,m=e.photoStatsModelRegistry,y=e.groupModelRegistry;return i.group.pathAlias=""===i.group.pathalias?null:i.group.pathalias,r=y.parseGroupModel(i.group.nsid,i.group.pathAlias,i.group),y.addOrUpdate(r),s={pathAlias:i.group.pathAlias,group:y.proxy(r.id),filteredPoolCount:i.group.poolCount},p=o.APIHelper.response.parsePhotos({photos:i.photos.photo,personModelRegistry:a,photoModelRegistry:g,photoEngagementModelRegistry:h,photoStatsModelRegistry:m}),s.photoPageList={perPage:i.photos.perpage,page:i.photos.page,pageContent:p,totalItems:s.filteredPoolCount},t.personFilter?(s.id=o.Models["group-pool-models"].buildCompoundId(i.group.nsid,t.personFilter),s.personFilter=t.personFilter,s.filteredPoolCount=s.photoPageList.totalItems=i.photos.total,l=u):t.tagFilter?(s.id=o.Models["group-pool-models"].buildCompoundId(i.group.nsid,t.tagFilter),s.tagFilter=t.tagFilter,s.filteredPoolCount=s.photoPageList.totalItems=i.photos.total,l=n):(t.id&&t.id!==i.group.nsid?s.id=t.id:s.id=i.group.nsid,l=d),l.exists(s.id)?(l.setValue(s.id,"photoPageList",s.photoPageList),l.setValue(s.id,"group",s.group),l.setValue(s.id,"pathAlias",s.pathAlias),l.setValue(s.id,"filteredPoolCount",parseInt(s.filteredPoolCount,10)||0),s.group.setValue("poolCount",parseInt(i.group.poolCount,10)||0)):l.add(s),p}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photo-engagement-models","photo-stats-models","group-models","group-pool-models","group-pool-by-person-models","group-pool-by-tag-models"]});YUI.add("flickr-groups-admin-acceptPhoto-updater",function(o,e){"use strict";o.namespace("ModelUpdaters")["flickr-groups-admin-acceptPhoto"]={run:function(t,p){var r=this,s=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:p.callAPI("flickr.groups.admin.acceptPhoto",s),groupPoolModel:p.getModel(l,t.groupID),photoModel:p.getModel("photo-models",t.photoID),photoGroupsModelRegistry:p.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:p.getModelRegistry("photo-contexts-models"),pendingModelRegistry:p.getModelRegistry("photo-group-pending-models"),pendingsModelRegistry:p.getModelRegistry("photo-group-pendings-models")};return t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModel=p.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return r._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t,p=o.apiResponse,r=o.groupPoolModel,s=o.photoModel,l=o.photoGroupsModelRegistry,u=o.photoContextsModelRegistry,d=o.unfilteredGroupPoolModel,g=o.pendingModelRegistry,i=o.pendingsModelRegistry;if("ok"===p.stat)return r&&!r.hasPhoto(s.getValue("id"))&&(r.addPhotoLocal(s),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1)),d&&d.hasPhoto(s.getValue("id"))&&d.addPhotoLocal(s),l.exists(e.photoID)&&!l.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(l.getValue(e.photoID,"groups").unshift(r),l.setValue(e.photoID,"total",l.getValue(e.photoID,"total")+1)),u.exists(e.photoID)&&!u.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(u.setValue(e.photoID,"totalGroups",u.getValue(e.photoID,"totalGroups")+1),u.getValue(e.photoID,"contexts").push(r)),t=[e.photoID,e.unfilteredGroupId].join("-"),i.exists(e.photoID)&&i.getValue(e.photoID,"pendings").getFromListByID(t)&&(i.setValue(e.photoID,"total",i.getValue(e.photoID,"total")-1),i.getValue(e.photoID,"pendings").removeFromList(t)),g.remove(t),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-contributor-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},dateJoined:{validator:function(e){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")}},groupDiscussionCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},groupPhotoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},pathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},rank:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},realname:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},username:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoTitle:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},avatarUrl:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(t,e){return!!this.getValue(e,"latestPhotoId")&&this.getValue(e,"contributorUrl")+this.getValue(e,"latestPhotoId")+"/"}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(t,e){return this.getValue(e,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(t,e){return"/photos/"+(this.getValue(e,"pathAlias")||this.getValue(e,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(e){return t.AttributeHelpers.coerceBoolean(e)}},proBadge:{defaultValue:"standard",setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});YUI.add("flickr-groups-getTopContributors-fetcher",function(o,r){"use strict";function t(r,t){var e={id:r.id+"-"+t,nsid:r.id,dateJoined:r.dateJoined?o.moment(r.dateJoined.toString(),"X"):o.moment(),groupDiscussionCount:r.groupDiscussionCount,groupPhotoCount:r.groupPhotoCount,pathAlias:r.pathAlias,rank:r.rank,realname:r.realname,username:r.username,isPro:r.isPro,proBadge:r.proBadge,avatarUrl:o.URLHelper.getBuddyIconURL(r.id,r.iconfarm,r.iconserver)};return r.latestPhoto&&(e.latestPhotoId=r.latestPhoto.id,e.latestPhotoTitle=r.latestPhoto.name),e}o.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:function(t,e){var i=this;return o.Promise.all([e.callAPI("flickr.groups.getTopContributors",this._processParams(t),!0),e.getModelRegistry("group-top-contributors-models"),e.getModelRegistry("group-contributor-models")]).then(function(o){return i._processResponse(o,t)},o.FetcherErrorLogger(r))},_processParams:function(o){return{group_id:o.id,type:"all",extras:"include_viewer,is_pro"}},_processResponse:function(o,r){var e,i,s,n=o[0],u=o[1],a=o[2];return i={photoContributors:[],discussionContributors:[],id:r.id},n&&n.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach(function(o){n.contributors[o.k]&&(e=n.contributors[o.k]).contributor&&e.contributor.forEach(function(e){s=t(e,r.id),i[o.v].push(a.addOrUpdate(s))})}),n&&n.viewer&&0!==n.viewer.length?(s=t(n.viewer,r.id),i.viewer=a.addOrUpdate(s)):i.viewer=null,u.addOrUpdate(i),u.proxy(i.id)}}},"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]});YUI.add("group-top-contributors-models",function(t){function r(t){r.superclass.constructor.call(this,t)}t.Models[this.name]=r,t.extend(r,t.FlickrModelRegistry,{name:this.name,remote:{read:function(r){var o=this;return t.ModelFetchers["flickr-groups-getTopContributors"].run(r,this.appContext).then(function(t){return o})}},attributes:{viewer:{isModel:!0,defaultValue:null},contributors:{isCollection:!0},photoContributors:{isCollection:!0},discussionContributors:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getTopContributors-fetcher","attribute-helpers"]});