YUI.add("hermes-template-photo-note-read-mode",function(a,e){var t=a.Template.Handlebars.revive({1:function(a,e,t,n,l){var r,s=null!=e?e:{},o=t.helperMissing,u=a.escapeExpression;return'\t\t\t<span class="author">'+u("function"==typeof(r=null!=(r=t.authorName||(null!=e?e.authorName:e))?r:o)?r.call(s,{name:"authorName",hash:{},data:l}):r)+" ("+u((t.intlMessage||e&&e.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"common.DELETED_USER"},data:l}))+")</span><br>\n"},3:function(a,e,t,n,l){var r,s,o=null!=e?e:{},u=t.helperMissing,h=a.escapeExpression;return'\t\t\t<a href="'+h("function"==typeof(s=null!=(s=t.authorURL||(null!=e?e.authorURL:e))?s:u)?s.call(o,{name:"authorURL",hash:{},data:l}):s)+'" class="author">'+h("function"==typeof(s=null!=(s=t.authorName||(null!=e?e.authorName:e))?s:u)?s.call(o,{name:"authorName",hash:{},data:l}):s)+"</a>"+(null!=(r=t.if.call(o,null!=e?e.authorIsPro:e,{name:"if",hash:{},fn:a.program(4,l,0),inverse:a.noop,data:l}))?r:"")+"<br>\n"},4:function(a,e,t,n,l){var r;return null!=(r=a.invokePartial(n["pro-badge"],e,{name:"pro-badge",hash:{badgeType:null!=e?e.authorProBadge:e},data:l,helpers:t,partials:n,decorators:a.decorators}))?r:""},compiler:[7,">= 4.0.0"],main:function(a,e,t,n,l){var r,s,o=null!=e?e:{},u=t.helperMissing,h=a.escapeExpression;return'<div class="note-text" style="z-index:'+h("function"==typeof(s=null!=(s=t.z||(null!=e?e.z:e))?s:u)?s.call(o,{name:"z",hash:{},data:l}):s)+';">\n\t<div class="text-alignment-fix hyphenate" style="left:'+h("function"==typeof(s=null!=(s=t.x||(null!=e?e.x:e))?s:u)?s.call(o,{name:"x",hash:{},data:l}):s)+"px;top:"+h("function"==typeof(s=null!=(s=t.y||(null!=e?e.y:e))?s:u)?s.call(o,{name:"y",hash:{},data:l}):s)+'px">\n'+(null!=(r=t.if.call(o,null!=e?e.authorIsDeleted:e,{name:"if",hash:{},fn:a.program(1,l,0),inverse:a.program(3,l,0),data:l}))?r:"")+"\t\t"+h((t.renderTrustedMarkup||e&&e.renderTrustedMarkup||u).call(o,null!=e?e.text:e,{name:"renderTrustedMarkup",hash:{},data:l}))+"\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),n={};a.Array.each(["pro-badge"],function(e){var t=a.Template.get("hermes/"+e);t&&(n[e]=t)}),a.Template.register("hermes/photo-note-read-mode",function(e,l){return l=l||{},l.partials=l.partials?a.merge(n,l.partials):n,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge"]});YUI.add("hermes-template-photo-note-write-mode",function(e,t){var a=e.Template.Handlebars.revive({1:function(e,t,a,n,l){return'<button class="delete-note danger tiny">'+e.escapeExpression((a.intlMessage||t&&t.intlMessage||a.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:l}))+"</button>"},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,l){var s,i,o=null!=t?t:{},r=a.helperMissing,c="function",m=e.escapeExpression;return'<div class="note-text adding" data-for-note-yuid="'+m(typeof(i=null!=(i=a.noteYUID||(null!=t?t.noteYUID:t))?i:r)===c?i.call(o,{name:"noteYUID",hash:{},data:l}):i)+'" style="z-index:'+m(typeof(i=null!=(i=a.z||(null!=t?t.z:t))?i:r)===c?i.call(o,{name:"z",hash:{},data:l}):i)+';">\n\t<div class="text-alignment-fix hyphenate" style="left:'+m(typeof(i=null!=(i=a.x||(null!=t?t.x:t))?i:r)===c?i.call(o,{name:"x",hash:{},data:l}):i)+"px;top:"+m(typeof(i=null!=(i=a.y||(null!=t?t.y:t))?i:r)===c?i.call(o,{name:"y",hash:{},data:l}):i)+'px">\n\t\t<textarea class="note-text-textarea" placeholder="'+m((a.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_NOTE"},data:l}))+'">'+m(typeof(i=null!=(i=a.text||(null!=t?t.text:t))?i:r)===c?i.call(o,{name:"text",hash:{},data:l}):i)+'</textarea>\n\t\t<div class="note-text-buttons">\n\t\t\t<button class="save-note tiny">'+m((a.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"common.SAVE"},data:l}))+'</button>\n\t\t\t<button class="cancel-note alt tiny">'+m((a.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:l}))+"</button>"+(null!=(s=a.if.call(o,null!=t?t.canDelete:t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?s:"")+"\n\t\t</div>\n\t</div>\n</div>"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/photo-note-write-mode",function(t,l){return l=l||{},l.partials=l.partials?e.merge(n,l.partials):n,a(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-note-drag-handles",function(a,e){var r=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,r,n,t){return'<span class="note-drag-handle note-drag-handle-tl" data-drag-resize-direction="tl"></span><span class="note-drag-handle note-drag-handle-tr" data-drag-resize-direction="tr"></span><span class="note-drag-handle note-drag-handle-br" data-drag-resize-direction="br"></span><span class="note-drag-handle note-drag-handle-bl" data-drag-resize-direction="bl"></span>'},useData:!0}),n={};a.Array.each([],function(e){var r=a.Template.get("hermes/"+e);r&&(n[e]=r)}),a.Template.register("hermes/photo-note-drag-handles",function(e,t){return t=t||{},t.partials=t.partials?a.merge(n,t.partials):n,r(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-notes-scrappy-view",function(e,t){function o(t){this.yuid=e.guid(),this.id=t.id,this.photoId=t.photoId,this.x=t.x,this.y=t.y,this.z=0,this.w=t.w,this.h=t.h,this.text=t.text,this.author=t.author,this.authorName=t.authorName,this.authorRealName=t.authorRealName,this.authorIsPro=t.authorIsPro,this.authorProBadge=t.authorProBadge,this.authorIsDeleted=t.authorIsDeleted,this.canEdit=t.canEdit,this.canDelete=t.canDelete,this.isStoredOnServer=t.isStoredOnServer}o.prototype.getScaled=function(e){return{x:this.x*e,y:this.y*e,w:this.w*e,h:this.h*e}};var i=1,n={idle:{begin:"beginIdle",end:"endIdle",events:{mousedown:"handleIdleMouseDown",mouseup:"handleIdleMouseUp",mouseenter:{handler:"handleIdleMouseEnter",delegate:".note"},mouseleave:{handler:"handleIdleMouseLeave",delegate:".note"}}},editing:{begin:"beginEditing",events:{mousedown:"handleEditingMouseDown",mouseup:"handleEditingMouseUp",keydown:"handleEditingKeyDown"}},dragging:{begin:"beginDragging",end:"endDragging",events:{mousemove:"handleDraggingMouseMove",mouseup:"handleDraggingMouseUp"}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.stateEventHandles=[],this},loadState:function(){var t,o=this;return t={photo:this.appContext.getModel("photo-models",this._params.photoId),photoNotes:this.appContext.getModel("photo-notes-models",this._params.photoId),noteModel:this.appContext.getModelRegistry("note-models")},this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid&&(t.viewer=this.appContext.getModel("person-models",this.appContext.getViewer().nsid)),new e.FlickrPromise(t).then(function(e){o.set("photoModel",e.photo),o.set("photoNotesModel",e.photoNotes),o.set("noteModel",e.noteModel),e.viewer&&o.set("viewer",e.viewer)})},buildContainer:function(){return this},activate:function(){var t,i,n,a,s=this.appContext.flipper.isFlipped("enable-scrappy-notes-deleting"),r=this.appContext.flipper.isFlipped("enable-scrappy-notes-editing"),h=this.get("photoModel"),d=h.getValue("owner").getValue("id"),l=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid,g=this.get("photoNotesModel").getValue("notes").toJSON();if(h.getValue("isVideo"))return this.deactivate(),this;for(this.box=this.get("container"),this.notes=[],this.canAddNotes=h.getValue("canAddMeta"),this.canAddNotes&&this.box.setStyle("pointerEvents","auto"),this.registerEventHandler(this.box.on("mouseenter",this.revealNotes.bind(this))),this.registerEventHandler(this.box.on("mouseleave",this.hideNotes.bind(this))),this.registerEventHandler(e.on("photo:entering-vr",this.deactivate.bind(this))),i=0;i<g.length;i++)t=g[i],n=r&&(l===d||l===t.author),a=s&&(l===d||l===t.author),this.notes.push(new o({id:t.id,photoId:h.getValue("id"),x:t.left,y:t.top,w:t.width,h:t.height,text:t.text,author:t.author,authorName:t.authorName,authorRealName:t.authorRealName,authorIsPro:t.authorIsPro,authorProBadge:t.authorProBadge,authorIsDeleted:t.authorIsDeleted,canEdit:n,canDelete:a,isStoredOnServer:!0}));return this.restackNotes(),this.syncWithPhoto(),this.renderNotes(),this.revealNotes(),this.pageLoadNotesFlashTimer=setTimeout(this.hideNotes.bind(this),1e3),this.enterState("idle"),this},onParentViewEvent:function(e,t){t&&"photoWellResized"===t[0]&&this.isActivated&&this.box&&(this.syncWithPhoto(),this.renderNotes())},enterState:function(e,t){var o;if(t=t||{},n[e]){for(;this.stateEventHandles.length;)this.stateEventHandles.pop().detach();this.currentState&&n[this.currentState].end&&this[n[this.currentState].end]&&this[n[this.currentState].end].call(this,t);for(var i in n[e].events)"string"==typeof(o=n[e].events[i])?this.stateEventHandles.push(this.box.on(i,this[o].bind(this))):"object"==typeof o&&(o.delegate?this.stateEventHandles.push(this.box.delegate(i,this[o.handler].bind(this),o.delegate)):this.stateEventHandles.push(this.box.on(i,this[o.handler].bind(this))));n[e].begin&&this[n[e].begin]&&this[n[e].begin].call(this,t),this.currentState=e}},revealNotes:function(e){this.box.addClass("box-hovered"),clearTimeout(this.pageLoadNotesFlashTimer)},hideNotes:function(){this.box.removeClass("box-hovered"),this.hideHovered()},beginIdle:function(e){var t=e.element;this.box.removeClass("box-note-clicked"),delete this.draggingMemo,this.box.all(".note-text").remove(!0),t&&t.getDOMNode()&&t.removeClass("note-clicked"),e.rerender&&(this.restackNotes(),this.renderNotes())},endIdle:function(e){this.tempMouseMoveListener&&(this.tempMouseMoveListener.detach(),delete this.tempMouseMoveListener)},handleIdleMouseDown:function(t){var i,n,a,s,r=!1;1!==t.button||t.ctrlKey||t.metaKey||t.target.hasClass("note-text")||(t.target.hasClass("note")&&(i=this.getNoteByID(t.target.getAttribute("data-note-yuid"))),i&&(i.canEdit||i.canDelete)?this.enterState("editing",{note:i,element:t.target}):(a={x:t.clientX,y:t.clientY},s=this.box.getXY(),this.canAddNotes&&(t.preventDefault(),this.tempMouseMoveListener=this.box.on("mousemove",function(t){var i,h,d,l,g;if(i=Math.sqrt(Math.pow(t.clientX-a.x,2)+Math.pow(t.clientY-a.y,2)),h="",!(i<20)){switch(r||(r=!0,this.box.addClass("doing-initial-drag")),h+=a.y-t.clientY>=0?"t":"b",h+=a.x-t.clientX>=0?"l":"r"){case"tl":l=0,g=0;break;case"tr":l=8,g=0;break;case"bl":l=0,g=8;break;case"br":l=8,g=8}d=this.get("viewer"),n=new o({id:e.guid(),photoId:this.get("photoModel").getValue("id"),x:(Math.min(a.x,t.clientX)-s[0]+window.pageXOffset)/this.ratio,y:(Math.min(a.y,t.clientY)-s[1]+window.pageYOffset)/this.ratio,w:Math.abs(a.x-t.clientX)/this.ratio-l,h:Math.abs(a.y-t.clientY)/this.ratio-g,text:"",author:d.getValue("nsid"),authorName:d.getValue("username"),authorRealName:d.getValue("displayname"),authorIsPro:d.getValue("isPro"),authorProBadge:d.getValue("proBadge"),authorIsDeleted:!1,canEdit:!0,canDelete:!0,isStoredOnServer:!1}),this.notes.push(n),this.createNewNote(n),this.storeNoteBackup(n),n.node.append(this.templates("photo-note-drag-handles")()),this.box.addClass("box-note-clicked"),n.node.addClass("note-clicked"),n.node.addClass("note-can-edit"),this.enterState("dragging",{note:n,element:n.node,dragMetadata:{type:"resize",startX:Math.min(a.x,t.clientX)+window.pageXOffset,startY:Math.min(a.y,t.clientY)+window.pageYOffset,dragHandle:n.node.one(".note-drag-handle-"+h),direction:h}})}}.bind(this)))))},handleIdleMouseUp:function(t){this.tempMouseMoveListener&&(this.tempMouseMoveListener.detach(),delete this.tempMouseMoveListener),t.target===this.box&&e.fire("photo:zoom",{x:t.pageX,y:t.pageY})},handleIdleMouseEnter:function(e){var t,o=e.target.ancestor(".note",!0),n=this.getNoteByID(o.getAttribute("data-note-yuid")),a=n.getScaled(this.ratio);this.delayedNoteMouseLeaveHandler&&(this.hideHovered(),clearTimeout(this.delayedNoteMouseLeaveHandler),delete this.delayedNoteMouseLeaveHandler),o.addClass("note-hovered"),o.insert(this.templates("photo-note-read-mode")({x:a.x,y:a.y+a.h+2,z:i,text:n.text.replace(/\n/g,"<br>"),authorName:n.authorRealName||n.authorName,authorURL:"/photos/"+n.author+"/",authorIsPro:n.authorIsPro,authorProBadge:n.authorProBadge,authorIsDeleted:n.authorIsDeleted}),"after"),(t=this.box.one(".note-text")).on("mouseenter",function(e){this.delayedNoteMouseLeaveHandler&&(clearTimeout(this.delayedNoteMouseLeaveHandler),delete this.delayedNoteMouseLeaveHandler)}.bind(this)),t.on("mouseleave",this.handleIdleMouseLeave.bind(this))},handleIdleMouseLeave:function(e){this.delayedNoteMouseLeaveHandler=setTimeout(this.hideHovered.bind(this),100)},beginEditing:function(e){var t=e.note,o=e.element,n=t.getScaled(this.ratio);this.storeNoteBackup(t),this.hideHovered(),this.box.hasClass("box-note-clicked")||this.box.addClass("box-note-clicked"),o.hasClass("note-clicked")||o.addClass("note-clicked"),0===o.siblings(".note-text.adding").size()&&o.insert(this.templates("photo-note-write-mode")({noteYUID:t.yuid,x:n.x,y:n.y+n.h+2,z:i,text:t.text.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),canDelete:t.isStoredOnServer}),"after"),o.one(".note-drag-handle")||o.append(this.templates("photo-note-drag-handles")()),setTimeout(function(){this.box.one(".note-text[data-for-note-yuid="+t.yuid+"] textarea").focus()}.bind(this),10)},handleEditingMouseDown:function(e){var t,o,i;1!==e.button||e.ctrlKey||e.metaKey||(o=e.target.ancestor(".note",!0))&&(t=this.getNoteByID(o.getAttribute("data-note-yuid")))&&t.canEdit&&(e.target.hasClass("note-drag-handle")?i={type:"resize",startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset,dragHandle:e.target,direction:e.target.getAttribute("data-drag-resize-direction")}:e.target.hasClass("note-clicked")&&(i={type:"move",startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset,dragHandle:e.target}),i&&this.enterState("dragging",{note:t,element:o,dragMetadata:i}))},handleEditingMouseUp:function(e){e.target.test("button")&&this.performButtonAction(e)},handleEditingKeyDown:function(e){var t=this.box.one(".note-clicked"),o=this.getNoteByID(t.getAttribute("data-note-yuid"));switch(e.keyCode){case 8:(e.ctrlKey||e.metaKey)&&window.confirm(this.intlMessage({intlName:"photo-page-scrappy.CONFIRM_NOTE_DELETION"}))&&(this.deleteNote(o,t),e.preventDefault());break;case 13:(e.ctrlKey||e.metaKey)&&(this.saveNoteEdits(o,t),e.preventDefault()),e.target.test("button")&&this.performButtonAction(e);break;case 27:this.cancelNoteEdits(o,t);break;case 32:e.target.test("button")&&this.performButtonAction(e)}},performButtonAction:function(e){var t=this.box.one(".note-clicked"),o=this.getNoteByID(t.getAttribute("data-note-yuid"));e.target.hasClass("save-note")?this.saveNoteEdits(o,t):e.target.hasClass("cancel-note")?this.cancelNoteEdits(o,t):e.target.hasClass("delete-note")&&window.confirm(this.intlMessage({intlName:"photo-page-scrappy.CONFIRM_NOTE_DELETION"}))&&this.deleteNote(o,t)},saveNoteEdits:function(e,t){var o=this.get("noteModel"),i=this;e.text=i.box.one(".note-text[data-for-note-yuid="+e.yuid+"] textarea").get("value").trim(),e.text&&(e.isStoredOnServer?(o.setValues(e.id,{left:e.x,top:e.y,width:e.w,height:e.h,text:e.text}),o.remoteUpdate(e.id).then(function(o){o&&(e.text=o.getValue("text")),i.deleteNoteBackup(),i.enterState("idle",{note:e,element:t,rerender:!0})},function(e){})):o.remoteCreate({photoId:e.photoId,left:e.x,top:e.y,width:e.w,height:e.h,text:e.text,author:e.author,authorName:e.authorName,authorRealName:e.authorRealName,authorIsPro:e.authorIsPro,authorProBadge:e.authorProBadge,authorIsDeleted:!1}).then(function(o){e.id=o.getValue("id"),e.text=o.getValue("text"),e.isStoredOnServer=!0,i.deleteNoteBackup(),i.enterState("idle",{note:e,element:t,rerender:!0})},function(e){}))},cancelNoteEdits:function(e,t){var o;e.isStoredOnServer?(o=this.getNoteBackup(),e.w=o.w,e.h=o.h,e.x=o.x,e.y=o.y,this.positionNote(e)):(this.notes.pop(),this.box.one("[data-note-yuid="+e.yuid+"]").remove(!0),e=null,t=null),this.deleteNoteBackup(),this.enterState("idle",{note:e,element:t})},deleteNote:function(e,t){var o,i=this,n=!1;this.get("noteModel").remoteDelete(e.id).then(function(a){for(t.remove(!0),o=i.notes.length-1;o>=0;o--)if(i.notes[o].id===e.id){n=!0;break}n&&i.notes.splice(o,1),i.deleteNoteBackup(),i.enterState("idle",{note:e,element:t})},function(e){})},beginDragging:function(t){this.draggingMemo=e.merge(t.dragMetadata,{note:t.note,noteAtStart:e.clone(t.note),element:t.element})},endDragging:function(e){this.box.removeClass("doing-initial-drag")},handleDraggingMouseMove:function(e){var t,o,i,n,a,s,r,h,d,l,g,u,c,p=19/this.ratio;if(t=this.draggingMemo.note,o=this.draggingMemo.startX-e.clientX-window.pageXOffset,i=this.draggingMemo.startY-e.clientY-window.pageYOffset,this.boxWidth>this.boxHeight?(u=500,c=500/(this.boxWidth/this.boxHeight)):(c=500,u=500/(this.boxHeight/this.boxWidth)),"resize"===this.draggingMemo.type){switch(this.draggingMemo.direction){case"tl":n=o/this.ratio*-1,s=o/this.ratio,a=i/this.ratio*-1,r=i/this.ratio;break;case"tr":n=0,s=o/this.ratio*-1,a=i/this.ratio*-1,r=i/this.ratio;break;case"br":n=0,s=o/this.ratio*-1,a=0,r=i/this.ratio*-1;break;case"bl":n=o/this.ratio*-1,s=o/this.ratio,a=0,r=i/this.ratio*-1}h=this.draggingMemo.noteAtStart.x+n,l=this.draggingMemo.noteAtStart.w+s,d=this.draggingMemo.noteAtStart.y+a,g=this.draggingMemo.noteAtStart.h+r,l<p&&(n&&(h=this.draggingMemo.noteAtStart.w+this.draggingMemo.noteAtStart.x-p),l=p),l+h>u&&(l=u-h),h<0&&(h=0,l=this.draggingMemo.noteAtStart.w+this.draggingMemo.noteAtStart.x),t.x=h,t.w=l,g<p&&(a&&(d=this.draggingMemo.noteAtStart.h+this.draggingMemo.noteAtStart.y-p),g=p),g+d>c&&(g=c-d),d<0&&(d=0,g=this.draggingMemo.noteAtStart.h+this.draggingMemo.noteAtStart.y),t.y=d,t.h=g}else"move"===this.draggingMemo.type&&(h=this.draggingMemo.noteAtStart.x-o/this.ratio,d=this.draggingMemo.noteAtStart.y-i/this.ratio,h<0&&(h=0),h+this.draggingMemo.noteAtStart.w>u&&(h=u-this.draggingMemo.noteAtStart.w),d<0&&(d=0),d+this.draggingMemo.noteAtStart.h>c&&(d=c-this.draggingMemo.noteAtStart.h),t.x=h,t.y=d);this.positionNote(t)},handleDraggingMouseUp:function(e){this.enterState("editing",{note:this.draggingMemo.note,element:this.draggingMemo.element})},storeNoteBackup:function(t){this.noteBeforeEdits||(this.noteBeforeEdits=e.clone(t))},getNoteBackup:function(){return this.noteBeforeEdits},deleteNoteBackup:function(){delete this.noteBeforeEdits},getNoteByID:function(e){return this.notes.find?this.notes.find(function(t){return t.yuid===e}):this.notes.filter(function(t){return t.yuid===e})[0]},renderNotes:function(){var t,o,i=this.getNoteBackup();i&&(t=e.clone(i.node.getDOMNode())),this.box.all(".note").remove(!0),this.notes.forEach(this.createNewNote.bind(this)),i&&((o=this.box.one("[data-note-yuid="+i.yuid+"]")).set("className",t.className),i.node=o)},createNewNote:function(t){t.node=e.Node.create('<span class="note" data-note-yuid="'+t.yuid+'"></span>'),t.canEdit&&t.node.addClass("note-can-edit"),this.box.append(t.node),this.positionNote(t)},positionNote:function(e){var t,o=e.getScaled(this.ratio);e.node.setStyles({left:o.x+"px",top:o.y+"px",width:o.w+"px",height:o.h+"px",zIndex:e.z}),(t=this.box.one(".note-text[data-for-note-yuid="+e.yuid+"]"))&&(t.setStyle("z-index",i),t.one(".text-alignment-fix").setStyles({left:o.x+"px",top:o.y+o.h+2+"px"}))},restackNotes:function(){this.notes.sort(function(e,t){return t.w*t.h-e.w*e.h}).forEach(function(e){e.z=i++})},syncWithPhoto:function(){var t=e.one(".photo-well-media-scrappy-view").getDOMNode(),o=parseInt(getComputedStyle(t).paddingTop,10),i=parseInt(getComputedStyle(t).paddingBottom,10),n=t.offsetWidth,a=t.offsetHeight-o-i,s=t.offsetLeft,r=t.offsetTop+o;this.box.setStyles({width:n+"px",height:a+"px",left:s+"px",top:r+"px"}),this.ratio=Math.max(n,a)/500,this.boxWidth=n,this.boxHeight=a,this.boxLeft=s,this.boxTop=r},hideHovered:function(){this.box.all(".note-hovered").removeClass("note-hovered"),this.box.all(".note-text:not(.adding)").remove(!0)},deactivate:function(){this.get("container").setStyle("display","none").remove()}})},"@VERSION@",{requires:["hermes-template-photo-note-read-mode","hermes-template-photo-note-write-mode","hermes-template-photo-note-drag-handles","flickr-view"],optional:["photo-notes-models","photo-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-photo-sidebar-toggle",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,l,r){return"Close"},3:function(e,a,n,l,r){return"Open"},5:function(e,a,n,l,r){return"fullscreen"},7:function(e,a,n,l,r){return"&#10529;"},9:function(e,a,n,l,r){return"&#10530;"},compiler:[7,">= 4.0.0"],main:function(e,a,n,l,r){var t,s,i=null!=a?a:{};return'<a href="'+e.escapeExpression("function"==typeof(s=null!=(s=n.url||(null!=a?a.url:a))?s:n.helperMissing)?s.call(i,{name:"url",hash:{},data:r}):s)+'" class="toggle" data-track="lightbox'+(null!=(t=n.if.call(i,null!=a?a.isRealFullscreen:a,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r}))?t:"")+'Click">\n\t<span class="toggle-icon hide-text '+(null!=(t=n.if.call(i,null!=a?a.isRealFullscreen:a,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r}))?t:"")+'">'+(null!=(t=n.if.call(i,null!=a?a.isRealFullscreen:a,{name:"if",hash:{},fn:e.program(7,r,0),inverse:e.program(9,r,0),data:r}))?t:"")+"</span>\n</a>"},useData:!0}),l={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(l[a]=n)}),e.Template.register("hermes/photo-sidebar-toggle",function(a,r){return r=r||{},r.partials=r.partials?e.merge(l,r.partials):l,n(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-sidebar-toggle-view",function(t){t.FlickrView.create(this.name,t.FlickrView,[],{initializer:function(e){return this.photoId=e.photoId,this.realFullscreen=!!e.realFullscreen,this.contextData=t.clone(e.context,!0),this.inlineStyling=e.inlineStyling,this},loadState:function(){var e=this,i=[];return i.push(this.appContext.getModel("photo-models",this.photoId).then(function(t){t&&e.set("photo",t)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&i.push(this.appContext.getModel(this.contextData.modelName,this.contextData.params).then(function(t){t&&e.set("contextModel",t)}).then(null,function(){return"whatever"})),t.Promise.all(i)},buildContainer:function(){var t=this.appContext.experiments.fullscreen.getMode(),e=this.get("container");return this.inlineStyling&&e.addClass("inline"),this.setContainerWithTemplate("photo-sidebar-toggle",{isRealFullscreen:t,url:this.getLightboxURL()}),e.addClass("show"),this},activate:function(){var e=this;return this.appContext.getViewer().prefs.keyboardShortcutsEnabled&&(this.attachKeyEvent("down:76",function(i){i.preventDefault(),t.rapidTracker.beacon(e.name,"lightbox"+(e.appContext.experiments.fullscreen.getMode()?"Close":"Open")+"KeyPress"),e.appContext.flapp.navigate(e.getLightboxURL())}),this.appContext.flipper.isFlipped("enable-scrappy-photo-page")&&this.attachKeyEvent("up:27",function(i){e.appContext.experiments.fullscreen.getMode()&&(i.preventDefault(),t.rapidTracker.beacon(e.name,"lightboxCloseEscKeyPress"),e.appContext.flapp.navigate(e.getLightboxURL()))})),this},getLightboxURL:function(){var e=this.get("photo"),i="";return this.get("contextModel")&&(i=this.get("contextModel").getValue("urlSuffix")),e?t.URLHelper.getPhotoPage({photoId:e.getValue("id"),pathAlias:e.getValue("owner").getValue("pathAlias"),contextSuffix:i,lightbox:!this.appContext.experiments.fullscreen.getMode()}):"#"}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar-toggle","promise"]});YUI.add("hermes-template-account-menu",function(t,a){var n=t.Template.Handlebars.revive({1:function(t,a,n,e,l){var s,r=null!=a?a:{},i=t.escapeExpression;return'\t<div class="c-account-menu">\n\t\t<div class="c-account-buddyicon">\n\t\t\t<a href="/account"\n\t\t\t\ttabindex="0"\n\t\t\t\taria-haspopup="true"\n\t\t\t\taria-expanded="false"\n\t\t\t\taria-label="'+i((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"autosuggest.YOUR_ACCOUNT"},data:l}))+'">\n\t\t\t\t<div class="avatar person tiny" style="background-image: url('+i(t.lambda(null!=(s=null!=(s=null!=a?a.user:a)?s.buddyicon:s)?s.default:s,a))+')"></div>\n\t\t\t</a>\n\n'+(null!=(s=n.if.call(r,null!=a?a.showOverLimitWarning:a,{name:"if",hash:{},fn:t.program(2,l,0),inverse:t.noop,data:l}))?s:"")+"\t\t</div>\n\t</div>\n"},2:function(t,a,n,e,l){return'\t\t\t\t<span class="exceed-warning-dot">\n\t\t\t\t\t<span class="exclamation">!</span>\n\t\t\t\t</span>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,n,e,l){var s;return null!=(s=n.if.call(null!=a?a:{},null!=(s=null!=a?a.user:a)?s.signedIn:s,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?s:""},useData:!0}),e={};t.Array.each([],function(a){var n=t.Template.get("hermes/"+a);n&&(e[a]=n)}),t.Template.register("hermes/account-menu",function(a,l){return l=l||{},l.partials=l.partials?t.merge(e,l.partials):e,n(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-greetings",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,s){var t,u=a.lambda,i=a.escapeExpression,m=null!=e?e:{},h=n.helperMissing;return"<h4>Hola, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SPANISH"},data:s}))+"</p>\n<h4>Guten Tag, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GERMAN"},data:s}))+"</p>\n<h4>Servus, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GERMAN"},data:s}))+"</p>\n<h4>G&rsquo;day, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_AUSTRALIAN"},data:s}))+"</p>\n<h4>Hoi, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_DUTCH"},data:s}))+"</p>\n<h4>Yo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Hi, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Oi, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Hala, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ARABIC"},data:s}))+"</p>\n<h4>Ahoy, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Hello, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Bonjour, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FRENCH"},data:s}))+"</p>\n<h4>Salut, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FRENCH"},data:s}))+"</p>\n<h4>Salaam, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ARABIC"},data:s}))+"</p>\n<h4>Ciao, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ITALIAN"},data:s}))+"</p>\n<h4>Hola, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SPANISH"},data:s}))+"</p>\n<h4>Hej, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SWEDISH"},data:s}))+"</p>\n<h4>Aloha, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HAWAIIAN"},data:s}))+"</p>\n<h4>Kumusta, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TAGALOG"},data:s}))+"</p>\n<h4>Shalom, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HEBREW"},data:s}))+"</p>\n<h4>'Allo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Namaste, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HINDI"},data:s}))+"</p>\n<h4>Ni hao, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_MANDARIN"},data:s}))+"</p>\n<h4>Ol&aacute;, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_PORTUGUESE"},data:s}))+"</p>\n<h4>P&euml;rsh&euml;ndetje, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ALBANIAN"},data:s}))+"</p>\n<h4>Tere, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ESTONIAN"},data:s}))+"</p>\n<h4>Yasou, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GREEK"},data:s}))+"</p>\n<h4>Szia, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HUNGARIAN"},data:s}))+"</p>\n<h4>Mbote, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LINGALA"},data:s}))+"</p>\n<h4>Jambo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SWAHILI"},data:s}))+"</p>\n<h4>Moyo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TSHILUBA"},data:s}))+"</p>\n<h4>Merhaba, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TURKISH"},data:s}))+"</p>\n<h4>Mingalaba, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BURMESE"},data:s}))+"</p>\n<h4>G&#243;&#240;an daginn, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ICELANDIC"},data:s}))+"</p>\n<h4>Sawubona, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ZULU"},data:s}))+"</p>\n<h4>Bangawoyo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KOREAN"},data:s}))+"</p>\n<h4>F&aacute;ilte, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_IRISH"},data:s}))+"</p>\n<h4>Labdien, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LATVIAN"},data:s}))+"</p>\n<h4>Kaixo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BASQUE"},data:s}))+"</p>\n<h4>Nomoshkar, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BENGALI"},data:s}))+"</p>\n<h4>Zdrasti, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BULGARIAN"},data:s}))+"</p>\n<h4>Bok, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_CROATIAN"},data:s}))+"</p>\n<h4>Dobr&yacute; den, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_CZECH"},data:s}))+"</p>\n<h4>Hej, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_DANISH"},data:s}))+"</p>\n<h4>Hyv&auml;&auml; p&auml;iv&auml;&auml;, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FINNISH"},data:s}))+"</p>\n<h4>Mike, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HOPI"},data:s}))+"</p>\n<h4>Szia, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HUNGARIAN"},data:s}))+"</p>\n<h4>Halo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_INDONESIAN"},data:s}))+"</p>\n<h4>Namaskara, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KANNADA"},data:s}))+"</p>\n<h4>Chonî, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KURDISH"},data:s}))+"</p>\n<h4>Labas, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LITHUANIAN"},data:s}))+"</p>\n<h4>Selamat datang, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_MALAYSIAN"},data:s}))+"</p>\n<h4>Hei, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_NORWEGIAN"},data:s}))+"</p>\n<h4>Witaj, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_POLISH"},data:s}))+"</p>\n<h4>Bun&#x103; Ziua, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ROMANIAN"},data:s}))+"</p>\n<h4>Privet, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_RUSSIAN"},data:s}))+"</p>\n<h4>Zdravo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SERBIAN"},data:s}))+"</p>\n<h4>Ahoj, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SLOVAKIAN"},data:s}))+"</p>\n<h4>Pryvit, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_UKRAINIAN"},data:s}))+"</p>\n<h4>Xin ch&agrave;o, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_VIETNAMESE"},data:s}))+"</p>\n<h4>Sawubona, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ZULU"},data:s}))+"</p> \n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,s){var t,u,i;return u=null!=(u=n.randomLine||(null!=e?e.randomLine:e))?u:n.helperMissing,i={name:"randomLine",hash:{},fn:a.program(1,s,0),inverse:a.noop,data:s},t="function"==typeof u?u.call(null!=e?e:{},i):u,n.randomLine||(t=n.blockHelperMissing.call(e,t,i)),null!=t?t:""},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/greetings",function(e,s){return s=s||{},s.partials=s.partials?a.merge(l,s.partials):l,n(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-account-menu-dialog-styleguide",function(a,n){var l=a.Template.Handlebars.revive({1:function(a,n,l,t,e){var s;return'\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((l.intlHTMLMessage||n&&n.intlHTMLMessage||l.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{used:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageUsedFormatted:s,intlName:"account-menu.SPACE_USED_UNLIMITED"},data:e}))+"</span>\n"},3:function(a,n,l,t,e){var s,r=null!=n?n:{},u=a.escapeExpression;return(null!=(s=l.if.call(r,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.photoCount:s,{name:"if",hash:{},fn:a.program(4,e,0),inverse:a.program(12,e,0),data:e}))?s:"")+'\t\t\t<span class="storage-count secondary">'+u((l.intlHTMLMessage||n&&n.intlHTMLMessage||l.helperMissing).call(r,{name:"intlHTMLMessage",hash:{total:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageTotalFormatted:s,percentage:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageUsedPercentage:s,intlName:"account-menu.SPACE_USED_STYLEGUIDE"},data:e}))+'</span></div>\n\t\t\t<div class="bar" style="box-shadow: 0 0 0 1px #898989, inset '+u(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.barWidth:s,n))+'px 0 #008ddf;">\n'},4:function(a,n,l,t,e){var s;return null!=(s=l.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.pluralPhotos:s,{name:"if",hash:{},fn:a.program(5,e,0),inverse:a.program(10,e,0),data:e}))?s:""},5:function(a,n,l,t,e){var s;return null!=(s=l.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.oneK:s,{name:"if",hash:{},fn:a.program(6,e,0),inverse:a.program(8,e,0),data:e}))?s:""},6:function(a,n,l,t,e){var s;return'\t\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((l.intlHTMLMessage||n&&n.intlHTMLMessage||l.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{num:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.photoCount:s,intlName:"account-menu.PHOTO_COUNT_1K"},data:e}))+"</span>\n"},8:function(a,n,l,t,e){var s;return'\t\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((l.intlHTMLMessage||n&&n.intlHTMLMessage||l.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{num:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.photoCount:s,intlName:"account-menu.PHOTO_COUNT_MANY"},data:e}))+"</span>\n"},10:function(a,n,l,t,e){return'\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((l.intlHTMLMessage||n&&n.intlHTMLMessage||l.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{intlName:"account-menu.PHOTO_COUNT_ONE"},data:e}))+"</span>\n"},12:function(a,n,l,t,e){return'\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((l.intlHTMLMessage||n&&n.intlHTMLMessage||l.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{intlName:"account-menu.PHOTO_COUNT_NONE"},data:e}))+"</span>\n"},14:function(a,n,l,t,e){var s;return null!=(s=l.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.canBuyPro:s,{name:"if",hash:{},fn:a.program(15,e,0),inverse:a.noop,data:e}))?s:""},15:function(a,n,l,t,e){return'\t\t\t\t<div class="upgrade">\n\t\t\t\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GOPRO"},data:e}))+"</a>\n\t\t\t\t</div>\n"},17:function(a,n,l,t,e){var s;return"<span >&nbsp;("+a.escapeExpression(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.unreadMessages:s,n))+")</span>"},compiler:[7,">= 4.0.0"],main:function(a,n,l,t,e){var s,r=a.lambda,u=a.escapeExpression,i=null!=n?n:{},o=l.helperMissing;return'<div class="fluid">\n\t<div class="top-half dark" style="background-image: url('+u(r(null!=(s=null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.coverPhotoUrls:s)?s.t:s,n))+')">\n\t\t<a href="/photos/me"><span class="avatar person medium" style="background-image: url('+u(r(null!=(s=null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.buddyicon:s)?s.default:s,n))+')"></span></a>\n'+(null!=(s=a.invokePartial(t.greetings,n,{name:"greetings",data:e,indent:"\t\t",helpers:l,partials:t,decorators:a.decorators}))?s:"")+'\t</div>\n\t<div class="bottom-half light">\n\t\t<div class="labels">\n'+(null!=(s=l.if.call(i,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.isPro:s,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(3,e,0),data:e}))?s:"")+"\t\t</div>\n\n"+(null!=(s=l.unless.call(i,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.isNoAds:s,{name:"unless",hash:{},fn:a.program(14,e,0),inverse:a.noop,data:e}))?s:"")+'\n\n\t\t<div class="links secondary">\n\t\t\t<span class="link-wrapper">\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href="/mail"  data-action="follow">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:e}))+(null!=(s=l.if.call(i,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.unreadMessages:s,{name:"if",hash:{},fn:a.program(17,e,0),inverse:a.noop,data:e}))?s:"")+'</a></li>\n\t\t\t\t\t<li><a href="//help.flickr.com/"  data-action="follow">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.HELP"},data:e}))+'</a></li>\n\t\t\t\t\t<li><a href="/account"  data-action="follow">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:e}))+'</a></li>\n\t\t\t\t\t<li><a href="/logout.gne?csrf='+u(r(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.csrf:s,n))+'"  data-action="follow">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.SIGN_OUT"},data:e}))+"</a></li>\n\t\t\t\t</ul>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),t={};a.Array.each(["greetings"],function(n){var l=a.Template.get("hermes/"+n);l&&(t[n]=l)}),a.Template.register("hermes/account-menu-dialog-styleguide",function(n,e){return e=e||{},e.partials=e.partials?a.merge(t,e.partials):t,l(n,e)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings"]});YUI.add("hermes-template-account-menu-card",function(a,t){var e=a.Template.Handlebars.revive({1:function(a,t,e,n,l){var s;return null!=(s=e.if.call(null!=t?t:{},null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.isPro:s,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.program(4,l,0),data:l}))?s:""},2:function(a,t,e,n,l){var s;return'\t\t\t\t\t<span class="storage-count tertiary">'+a.escapeExpression((e.intlHTMLMessage||t&&t.intlHTMLMessage||e.helperMissing).call(null!=t?t:{},{name:"intlHTMLMessage",hash:{used:null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.storageUsedFormatted:s,intlName:"account-menu.SPACE_USED_UNLIMITED"},data:l}))+"</span>\n"},4:function(a,t,e,n,l){var s,r=a.escapeExpression;return'\t\t\t\t\t<div class="bar" style="box-shadow: 0 0 0 1px transparent, inset '+r(a.lambda(null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.barWidth:s,t))+'px 0 #008ddf;">\n\t\t\t\t\t\t<span class="storage-count tertiary">'+r((e.intlHTMLMessage||t&&t.intlHTMLMessage||e.helperMissing).call(null!=t?t:{},{name:"intlHTMLMessage",hash:{total:null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.storageTotalFormatted:s,percentage:null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.storageUsedPercentage:s,intlName:"account-menu.SPACE_USED"},data:l}))+"</span>\n\t\t\t\t\t</div>\n"},6:function(a,t,e,n,l){var s;return null!=(s=e.if.call(null!=t?t:{},null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.hasUnlimitedStorage:s,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.program(4,l,0),data:l}))?s:""},compiler:[7,">= 4.0.0"],main:function(a,t,e,n,l){var s,r=null!=t?t:{},i=e.helperMissing,u=a.escapeExpression;return'<div class="fluid account-menu-card">\n\t<div class="title">\n'+(null!=(s=a.invokePartial(n.greetings,t,{name:"greetings",data:l,indent:"\t\t",helpers:e,partials:n,decorators:a.decorators}))?s:"")+'\t</div>\n\t<div class="info">\n\t\t<div class="labels">\n\n'+(null!=(s=(e.isFlipped||t&&t.isFlipped||i).call(r,"enable-all-pros-unlimited-storage",{name:"isFlipped",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?s:"")+(null!=(s=(e.isNotFlipped||t&&t.isNotFlipped||i).call(r,"enable-all-pros-unlimited-storage",{name:"isNotFlipped",hash:{},fn:a.program(6,l,0),inverse:a.noop,data:l}))?s:"")+'\n\t\t</div>\n\n\t\t<div class="upgrade" style="display: none;">\n\t\t\t<a href="/account/upgrade/pro" data-track="accountMenuCardProClick" class="small butt"><div class="balls"></div></a>\n\t\t</div>\n\n\t\t<div class="links secondary">\n\t\t\t<span class="link-wrapper">\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href="//help.flickr.com/"  data-track="accountMenuHelpClick">'+u((e.intlMessage||t&&t.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.HELP"},data:l}))+'</a></li>\n\n\t\t\t\t\t<li><a href="/account" data-track="accountMenuWalletClick">'+u((e.intlMessage||t&&t.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:l}))+'</a></li>\n\n\t\t\t\t\t<li><a href="/logout.gne?csrf='+u(a.lambda(null!=(s=null!=(s=null!=t?t.attrs:t)?s.user:s)?s.csrf:s,t))+'"  data-track="accountMenuSignoutClick">'+u((e.intlMessage||t&&t.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.SIGN_OUT"},data:l}))+"</a></li>\n\t\t\t\t</ul>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),n={};a.Array.each(["greetings"],function(t){var e=a.Template.get("hermes/"+t);e&&(n[t]=e)}),a.Template.register("hermes/account-menu-card",function(t,l){return l=l||{},l.partials=l.partials?a.merge(n,l.partials):n,e(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings"]});YUI.add("hermes-template-account-menu-card-get-pro-button",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,t,l){var s,r=null!=e?e:{};return(null!=(s=n.if.call(r,null!=e?e.canPurchase:e,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.noop,data:l}))?s:"")+(null!=(s=n.if.call(r,null!=e?e.canResubscribe:e,{name:"if",hash:{},fn:a.program(4,l,0),inverse:a.noop,data:l}))?s:"")},2:function(a,e,n,t,l){return'\t<div class="upgrade">\n\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"account-menu.GETPRO"},data:l}))+"</a>\n\t</div>\n"},4:function(a,e,n,t,l){return'\t<div class="upgrade">\n\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"account-menu.RESUBSCRIBE_TO_PRO"},data:l}))+"</a>\n\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,t,l){var s;return null!=(s=n.unless.call(null!=e?e:{},null!=e?e.isOneTimePro:e,{name:"unless",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?s:""},useData:!0}),t={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(t[e]=n)}),a.Template.register("hermes/account-menu-card-get-pro-button",function(e,l){return l=l||{},l.partials=l.partials?a.merge(t,l.partials):t,n(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-subscriptions-changePlan-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-subscriptions-changePlan-updater"]={run:function(n,c){return c.callAPI("flickr.subscriptions.changePlan",n).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-braintree-close-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-braintree-close-deletor"]={run:function(l,c){return c.callAPI("flickr.subscriptions.braintree.close",l).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("subscriptions-helper",function(o){"use strict";o.SubscriptionsHelper=function(){this.FLICKR_PRO_3_MONTH_PLAN_ID=1,this.FLICKR_PRO_1_YEAR_PLAN_ID=2,this.FLICKR_PRO_2_YEARS_PLAN_ID=3,this.FLICKR_PRO_MONTHLY_PLAN_ID=7,this.FLICKR_PRO_ANNUAL_PLAN_ID=8,this.FLICKR_PRO_ANNUAL_TRIAL=9,this.FLICKR_PRO_OLD_ANNUAL_TRIAL=10,this.FLICKR_PRO_ANNUAL_PRICE=49.99,this.FLICKR_PRO_MONTHLY_PRICE=5.99,this.subscriptionsIdByName={"pro-3month":this.FLICKR_PRO_3_MONTH_PLAN_ID,"pro-1year":this.FLICKR_PRO_1_YEAR_PLAN_ID,"pro-2year":this.FLICKR_PRO_2_YEARS_PLAN_ID,"pro-monthly":this.FLICKR_PRO_MONTHLY_PLAN_ID,"pro-annual":this.FLICKR_PRO_ANNUAL_PLAN_ID,"pro-trial":this.FLICKR_PRO_ANNUAL_TRIAL},this.subscriptionStatusMap={initiated:1,active:2,closed:3,canceled:4,failed:5,refunded:6,pending:7,subscription_canceled:8,subscription_charged_successfully:9,subscription_charged_unsuccessfully:10,subscription_expired:11,subscription_went_past_due:12,change_initiated:13,closed_pending:14},this.subscriptionsIdHasAnnualPerk={1:!1,2:!0,3:!0,4:!0,6:!1,7:!1,8:!0,9:!0,10:!0},this.cardTypeMap={1:"visa",2:"master-card",3:"discover",4:"american-express",5:"JCB"},this.paymentVendorMap={braintree:10,oldpaypal:20,digitalriver:30},this.countriesArray=[{countryCode:"US",countryName:"United States"},{countryCode:"AF",countryName:"Afghanistan"},{countryCode:"AX",countryName:"Åland"},{countryCode:"AL",countryName:"Albania"},{countryCode:"DZ",countryName:"Algeria"},{countryCode:"AS",countryName:"American Samoa"},{countryCode:"AD",countryName:"Andorra"},{countryCode:"AO",countryName:"Angola"},{countryCode:"AI",countryName:"Anguilla"},{countryCode:"AQ",countryName:"Antarctica"},{countryCode:"AG",countryName:"Antigua and Barbuda"},{countryCode:"AR",countryName:"Argentina"},{countryCode:"AM",countryName:"Armenia"},{countryCode:"AW",countryName:"Aruba"},{countryCode:"AU",countryName:"Australia"},{countryCode:"AT",countryName:"Austria"},{countryCode:"AZ",countryName:"Azerbaijan"},{countryCode:"BS",countryName:"Bahamas"},{countryCode:"BH",countryName:"Bahrain"},{countryCode:"BD",countryName:"Bangladesh"},{countryCode:"BB",countryName:"Barbados"},{countryCode:"BY",countryName:"Belarus"},{countryCode:"BE",countryName:"Belgium"},{countryCode:"BZ",countryName:"Belize"},{countryCode:"BJ",countryName:"Benin"},{countryCode:"BM",countryName:"Bermuda"},{countryCode:"BT",countryName:"Bhutan"},{countryCode:"BO",countryName:"Bolivia"},{countryCode:"BQ",countryName:"Bonaire, Sint Eustatius and Saba"},{countryCode:"BA",countryName:"Bosnia and Herzegovina"},{countryCode:"BW",countryName:"Botswana"},{countryCode:"BV",countryName:"Bouvet Island"},{countryCode:"BR",countryName:"Brazil"},{countryCode:"IO",countryName:"British Indian Ocean Territory"},{countryCode:"BN",countryName:"Brunei Darussalam"},{countryCode:"BG",countryName:"Bulgaria"},{countryCode:"BF",countryName:"Burkina Faso"},{countryCode:"BI",countryName:"Burundi"},{countryCode:"KH",countryName:"Cambodia"},{countryCode:"CM",countryName:"Cameroon"},{countryCode:"CA",countryName:"Canada"},{countryCode:"CV",countryName:"Cape Verde"},{countryCode:"KY",countryName:"Cayman Islands"},{countryCode:"CF",countryName:"Central African Republic"},{countryCode:"TD",countryName:"Chad"},{countryCode:"CL",countryName:"Chile"},{countryCode:"CN",countryName:"China"},{countryCode:"CX",countryName:"Christmas Island"},{countryCode:"CC",countryName:"Cocos (Keeling) Islands"},{countryCode:"CO",countryName:"Colombia"},{countryCode:"KM",countryName:"Comoros"},{countryCode:"CG",countryName:"Congo (Brazzaville)"},{countryCode:"CD",countryName:"Congo (Kinshasa)"},{countryCode:"CK",countryName:"Cook Islands"},{countryCode:"CR",countryName:"Costa Rica"},{countryCode:"CI",countryName:"Côte d'Ivoire"},{countryCode:"HR",countryName:"Croatia"},{countryCode:"CW",countryName:"Curaçao"},{countryCode:"CY",countryName:"Cyprus"},{countryCode:"CZ",countryName:"Czech Republic"},{countryCode:"DK",countryName:"Denmark"},{countryCode:"DJ",countryName:"Djibouti"},{countryCode:"DM",countryName:"Dominica"},{countryCode:"DO",countryName:"Dominican Republic"},{countryCode:"EC",countryName:"Ecuador"},{countryCode:"EG",countryName:"Egypt"},{countryCode:"SV",countryName:"El Salvador"},{countryCode:"GQ",countryName:"Equatorial Guinea"},{countryCode:"ER",countryName:"Eritrea"},{countryCode:"EE",countryName:"Estonia"},{countryCode:"ET",countryName:"Ethiopia"},{countryCode:"FK",countryName:"Falkland Islands"},{countryCode:"FO",countryName:"Faroe Islands"},{countryCode:"FJ",countryName:"Fiji"},{countryCode:"FI",countryName:"Finland"},{countryCode:"FR",countryName:"France"},{countryCode:"GF",countryName:"French Guiana"},{countryCode:"PF",countryName:"French Polynesia"},{countryCode:"TF",countryName:"French Southern Lands"},{countryCode:"GA",countryName:"Gabon"},{countryCode:"GM",countryName:"Gambia"},{countryCode:"GE",countryName:"Georgia"},{countryCode:"DE",countryName:"Germany"},{countryCode:"GH",countryName:"Ghana"},{countryCode:"GI",countryName:"Gibraltar"},{countryCode:"GR",countryName:"Greece"},{countryCode:"GL",countryName:"Greenland"},{countryCode:"GD",countryName:"Grenada"},{countryCode:"GP",countryName:"Guadeloupe"},{countryCode:"GU",countryName:"Guam"},{countryCode:"GT",countryName:"Guatemala"},{countryCode:"GG",countryName:"Guernsey"},{countryCode:"GN",countryName:"Guinea"},{countryCode:"GW",countryName:"Guinea-Bissau"},{countryCode:"GY",countryName:"Guyana"},{countryCode:"HT",countryName:"Haiti"},{countryCode:"HM",countryName:"Heard and McDonald Islands"},{countryCode:"HN",countryName:"Honduras"},{countryCode:"HK",countryName:"Hong Kong"},{countryCode:"HU",countryName:"Hungary"},{countryCode:"IS",countryName:"Iceland"},{countryCode:"IN",countryName:"India"},{countryCode:"ID",countryName:"Indonesia"},{countryCode:"IE",countryName:"Ireland"},{countryCode:"IM",countryName:"Isle of Man"},{countryCode:"IL",countryName:"Israel"},{countryCode:"IT",countryName:"Italy"},{countryCode:"JM",countryName:"Jamaica"},{countryCode:"JP",countryName:"Japan"},{countryCode:"JE",countryName:"Jersey"},{countryCode:"JO",countryName:"Jordan"},{countryCode:"KZ",countryName:"Kazakhstan"},{countryCode:"KE",countryName:"Kenya"},{countryCode:"KI",countryName:"Kiribati"},{countryCode:"KR",countryName:"Korea, South"},{countryCode:"KW",countryName:"Kuwait"},{countryCode:"KG",countryName:"Kyrgyzstan"},{countryCode:"LA",countryName:"Laos"},{countryCode:"LV",countryName:"Latvia"},{countryCode:"LB",countryName:"Lebanon"},{countryCode:"LS",countryName:"Lesotho"},{countryCode:"LR",countryName:"Liberia"},{countryCode:"LY",countryName:"Libya"},{countryCode:"LI",countryName:"Liechtenstein"},{countryCode:"LT",countryName:"Lithuania"},{countryCode:"LU",countryName:"Luxembourg"},{countryCode:"MO",countryName:"Macau"},{countryCode:"MK",countryName:"Macedonia"},{countryCode:"MG",countryName:"Madagascar"},{countryCode:"MW",countryName:"Malawi"},{countryCode:"MY",countryName:"Malaysia"},{countryCode:"MV",countryName:"Maldives"},{countryCode:"ML",countryName:"Mali"},{countryCode:"MT",countryName:"Malta"},{countryCode:"MH",countryName:"Marshall Islands"},{countryCode:"MQ",countryName:"Martinique"},{countryCode:"MR",countryName:"Mauritania"},{countryCode:"MU",countryName:"Mauritius"},{countryCode:"YT",countryName:"Mayotte"},{countryCode:"MX",countryName:"Mexico"},{countryCode:"FM",countryName:"Micronesia"},{countryCode:"MD",countryName:"Moldova"},{countryCode:"MC",countryName:"Monaco"},{countryCode:"MN",countryName:"Mongolia"},{countryCode:"ME",countryName:"Montenegro"},{countryCode:"MS",countryName:"Montserrat"},{countryCode:"MA",countryName:"Morocco"},{countryCode:"MZ",countryName:"Mozambique"},{countryCode:"MM",countryName:"Myanmar"},{countryCode:"NA",countryName:"Namibia"},{countryCode:"NR",countryName:"Nauru"},{countryCode:"NP",countryName:"Nepal"},{countryCode:"NL",countryName:"Netherlands"},{countryCode:"AN",countryName:"Netherlands Antilles"},{countryCode:"NC",countryName:"New Caledonia"},{countryCode:"NZ",countryName:"New Zealand"},{countryCode:"NI",countryName:"Nicaragua"},{countryCode:"NE",countryName:"Niger"},{countryCode:"NG",countryName:"Nigeria"},{countryCode:"NU",countryName:"Niue"},{countryCode:"NF",countryName:"Norfolk Island"},{countryCode:"MP",countryName:"Northern Mariana Islands"},{countryCode:"NO",countryName:"Norway"},{countryCode:"OM",countryName:"Oman"},{countryCode:"PK",countryName:"Pakistan"},{countryCode:"PW",countryName:"Palau"},{countryCode:"PS",countryName:"Palestine"},{countryCode:"PA",countryName:"Panama"},{countryCode:"PG",countryName:"Papua New Guinea"},{countryCode:"PY",countryName:"Paraguay"},{countryCode:"PE",countryName:"Peru"},{countryCode:"PH",countryName:"Philippines"},{countryCode:"PN",countryName:"Pitcairn"},{countryCode:"PL",countryName:"Poland"},{countryCode:"PT",countryName:"Portugal"},{countryCode:"PR",countryName:"Puerto Rico"},{countryCode:"QA",countryName:"Qatar"},{countryCode:"RE",countryName:"Reunion"},{countryCode:"RO",countryName:"Romania"},{countryCode:"RU",countryName:"Russian Federation"},{countryCode:"RW",countryName:"Rwanda"},{countryCode:"BL",countryName:"Saint Barthélemy"},{countryCode:"SH",countryName:"Saint Helena"},{countryCode:"KN",countryName:"Saint Kitts and Nevis"},{countryCode:"LC",countryName:"Saint Lucia"},{countryCode:"MF",countryName:"Saint Martin (French part)"},{countryCode:"PM",countryName:"Saint Pierre and Miquelon"},{countryCode:"VC",countryName:"Saint Vincent and the Grenadines"},{countryCode:"WS",countryName:"Samoa"},{countryCode:"SM",countryName:"San Marino"},{countryCode:"ST",countryName:"Sao Tome and Principe"},{countryCode:"SA",countryName:"Saudi Arabia"},{countryCode:"SN",countryName:"Senegal"},{countryCode:"RS",countryName:"Serbia"},{countryCode:"SC",countryName:"Seychelles"},{countryCode:"SL",countryName:"Sierra Leone"},{countryCode:"SG",countryName:"Singapore"},{countryCode:"SX",countryName:"Sint Maarten (Dutch part)"},{countryCode:"SK",countryName:"Slovakia"},{countryCode:"SI",countryName:"Slovenia"},{countryCode:"SB",countryName:"Solomon Islands"},{countryCode:"SO",countryName:"Somalia"},{countryCode:"ZA",countryName:"South Africa"},{countryCode:"GS",countryName:"South Georgia and South Sandwich Islands"},{countryCode:"SS",countryName:"South Sudan"},{countryCode:"ES",countryName:"Spain"},{countryCode:"LK",countryName:"Sri Lanka"},{countryCode:"SD",countryName:"Sudan"},{countryCode:"SR",countryName:"Suriname"},{countryCode:"SJ",countryName:"Svalbard and Jan Mayen Islands"},{countryCode:"SZ",countryName:"Swaziland"},{countryCode:"SE",countryName:"Sweden"},{countryCode:"CH",countryName:"Switzerland"},{countryCode:"TW",countryName:"Taiwan"},{countryCode:"TJ",countryName:"Tajikistan"},{countryCode:"TZ",countryName:"Tanzania"},{countryCode:"TH",countryName:"Thailand"},{countryCode:"TL",countryName:"Timor-Leste"},{countryCode:"TG",countryName:"Togo"},{countryCode:"TK",countryName:"Tokelau"},{countryCode:"TO",countryName:"Tonga"},{countryCode:"TT",countryName:"Trinidad and Tobago"},{countryCode:"TN",countryName:"Tunisia"},{countryCode:"TR",countryName:"Turkey"},{countryCode:"TM",countryName:"Turkmenistan"},{countryCode:"TC",countryName:"Turks and Caicos Islands"},{countryCode:"TV",countryName:"Tuvalu"},{countryCode:"UG",countryName:"Uganda"},{countryCode:"UA",countryName:"Ukraine"},{countryCode:"AE",countryName:"United Arab Emirates"},{countryCode:"GB",countryName:"United Kingdom"},{countryCode:"UM",countryName:"United States Minor Outlying Islands"},{countryCode:"UY",countryName:"Uruguay"},{countryCode:"UZ",countryName:"Uzbekistan"},{countryCode:"VU",countryName:"Vanuatu"},{countryCode:"VA",countryName:"Vatican City"},{countryCode:"VE",countryName:"Venezuela"},{countryCode:"VN",countryName:"Vietnam"},{countryCode:"VG",countryName:"Virgin Islands, British"},{countryCode:"VI",countryName:"Virgin Islands, U.S."},{countryCode:"WF",countryName:"Wallis and Futuna Islands"},{countryCode:"EH",countryName:"Western Sahara"},{countryCode:"YE",countryName:"Yemen"},{countryCode:"ZM",countryName:"Zambia"},{countryCode:"ZW",countryName:"Zimbabwe"}]},o.SubscriptionsHelper.prototype.canSeeAnnualProPerks=function(e,t){if(t){var n=t.toJSON();if(!e.getValue("isPro"))return!1;if(n.oneTimePro.isOneTimePro)return!0;if(e.getValue("isPro")){var r=o.Array.filter(n.subscriptions,function(e){return e.status===this.subscriptionStatusMap.active||e.status===this.subscriptionStatusMap.closed&&void 0!==e.effectiveEndDate&&e.effectiveEndDate.isAfter(o.moment())||e.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this));return!(!r||!r[0])&&this.subscriptionsIdHasAnnualPerk[r[0].type]}}},o.SubscriptionsHelper.prototype.canPlanIdSeeAnnualPerks=function(o){return this.subscriptionsIdHasAnnualPerk[o]},o.SubscriptionsHelper.prototype.convertDesiredPlan=function(o,e,t,n){var r;if(t=!0,e=!1,"pro-3month"===o||"pro-1year"===o||"pro-2year"===o){if(e)r=o;else if(t)switch(o){case"pro-3month":r="pro-monthly";break;case"pro-1year":case"pro-2year":r="pro-annual"}}else if(t)r=o;else if(e)switch(o){case"pro-monthly":r="pro-3month";break;case"pro-annual":r="pro-1year"}return r},o.SubscriptionsHelper.prototype.getPlanIdWithPlanName=function(o){var e=this.FLICKR_PRO_ANNUAL_PLAN_ID;return void 0!==this.subscriptionsIdByName[o]&&(e=this.subscriptionsIdByName[o]),e},o.SubscriptionsHelper.prototype.canPurchaseAtLeastOnePlan=function(o){var e=[];return o&&(e=o.filter(function(o){return 1===o.canPurchase})),e.length>0},o.SubscriptionsHelper.prototype.canPurchaseThisPlanId=function(o,e){var t=[];return o&&e&&(t=e.filter(function(e){return e.planId===o})),t.length>0},o.SubscriptionsHelper.prototype.getNewProPlans=function(o){if(o)return o.filter(function(o){return"FlickrNewPro"===o.familyName})},o.SubscriptionsHelper.prototype.getOldProPlans=function(o){if(o)return o.filter(function(o){return"FlickrPro"===o.familyName})},o.SubscriptionsHelper.prototype.getPlanWithIdInPlansList=function(o){},o.SubscriptionsHelper.prototype.sanitizeCouponCode=function(o){var e=!1;if(o){if(e=o.trim(),o.length<=1)return!1;if(!e.match(/^[\w\-]+$/))return!1}return e},o.SubscriptionsHelper.prototype.convertLocaleToPaypalFormat=function(o){if(o){return{"de-DE":"de_DE","en-US":"en_US","es-US":"es_ES","fr-FR":"fr_FR","id-ID":"id_ID","it-IT":"it_IT","ko-KR":"ko_KR","pt-BR":"pt_PT","vi-VN":"en_US","zh-Hant-HK":"zh_HK"}[o]}},o.SubscriptionsHelper.prototype.getNiceCardType=function(o){return this.cardTypeMap[o]},o.SubscriptionsHelper.prototype.getPaymentVendorType=function(o){return this.paymentVendorMap[o]},o.SubscriptionsHelper.prototype.isPaymentVendorBraintree=function(o){return o===this.paymentVendorMap.braintree},o.SubscriptionsHelper.prototype.isPaymentVendorDigitalRiver=function(o){return o===this.paymentVendorMap.digitalriver},o.SubscriptionsHelper.prototype.hasYearlyLegalNotice=function(o){return this.subscriptionsIdHasAnnualPerk[o]},o.SubscriptionsHelper.prototype.log=function(e,t){!YUI.Env.isServer&&o.config.win.beaconError&&o.config.win.beaconError("[flickr-add-payment-method] "+e,o.config.win.location.href,t||{})},o.SubscriptionsHelper.prototype.beaconTransactionStep=function(e,t){!YUI.Env.isServer&&o.config.win.beaconError&&o.config.win.beaconError("[PRO] "+e,o.config.win.location.href,t||{})},o.SubscriptionsHelper.prototype.doesPlanIdHaveTrial=function(o){return o===this.FLICKR_PRO_ANNUAL_PLAN_ID||o===this.FLICKR_PRO_1_YEAR_PLAN_ID||o===this.FLICKR_PRO_2_YEARS_PLAN_ID},o.SubscriptionsHelper.prototype.canPurchaseTrialPlan=function(e,t){if(e&&t){var n;return n=e.getValue("products"),o.Array.filter(n,function(o){return o.planId===this.FLICKR_PRO_ANNUAL_TRIAL&&1===o.canPurchase||o.planId===this.FLICKR_PRO_OLD_ANNUAL_TRIAL&&1===o.canPurchase}.bind(this)).length>0}},o.SubscriptionsHelper.prototype.getTrialLength=function(){return 45},o.SubscriptionsHelper.prototype.formatSubscriptionModels=function(e){var t=e;return!t||!t.toJSON()||!t.toJSON().subscriptions||!t.toJSON().subscriptions instanceof Array||0===t.toJSON().subscriptions.length?[]:o.Array.map(t.toJSON().subscriptions,function(o){var e,t=o.amountBilled?o.amountBilled.toFixed(2):"0.00",n=o.pendingPrice?o.pendingPrice.toFixed(2):"0.00";return e=o.status!==this.subscriptionStatusMap.closed&&"object"==typeof o.effectiveEndDate&&"object"==typeof o.nextBillingDate?o.nextBillingDate.format("LL"):"",{type:o.type,startDate:"object"==typeof o.startDate?o.startDate.format("LL"):"",renewDate:e,nextBillingDate:o.nextBillingDate,id:o.id,name:o.prettyName,duration:o.prettyNameDuration,price:t,pendingPrice:n,status:o.status,isClosed:o.status===this.subscriptionStatusMap.closed,isPastDue:o.status===this.subscriptionStatusMap.subscription_went_past_due,effectiveEndDate:o.effectiveEndDate,paymentVendorType:o.paymentVendorType,isDigitalRiverSubscription:this.isPaymentVendorDigitalRiver(o.paymentVendorType),transactions:o.transactions}}.bind(this))},o.SubscriptionsHelper.prototype.getActiveAndPendingSubscriptions=function(e){var t,n;return t=o.Array.filter(this.formatSubscriptionModels(e),function(o){return o.status===this.subscriptionStatusMap.pending}.bind(this)),n=o.Array.filter(this.formatSubscriptionModels(e),function(e){return e.status===this.subscriptionStatusMap.active||e.status===this.subscriptionStatusMap.closed&&void 0!==e.effectiveEndDate&&e.effectiveEndDate.isAfter(o.moment())||e.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this)),{activeSubs:n,pendingSubs:t}},o.SubscriptionsHelper.prototype.isUserOnActiveButClosedPro=function(e){return o.Array.filter(this.formatSubscriptionModels(e),function(e){return e.status===this.subscriptionStatusMap.closed&&void 0!==e.effectiveEndDate&&e.effectiveEndDate.isAfter(o.moment())||e.status===this.subscriptionStatusMap.subscription_went_past_due}.bind(this)).length>=1},o.SubscriptionsHelper.prototype.isUserCurrentlyOnADigitalRiverSub=function(o){var e=this.getActiveAndPendingSubscriptions(o),t=!1;if(e.activeSubs&&e.activeSubs.length>0){var n=e.activeSubs[0];if(e.pendingSubs&&e.pendingSubs.length>0){var r=e.pendingSubs[0];r&&(t=r.isDigitalRiverSubscription)}else t=n.isDigitalRiverSubscription}return t},o.SubscriptionsHelper.prototype.hasPurchasedTrialInThePast=function(e){var t=e.toJSON();return o.Array.filter(t,function(o){return o.planId===this.FLICKR_PRO_ANNUAL_TRIAL||o.planId===this.FLICKR_PRO_OLD_ANNUAL_TRIAL}.bind(this)).length>0},o.SubscriptionsHelper.prototype.isOnActiveTrial=function(o){var e=this.getActiveAndPendingSubscriptions(o),t=!1;return e&&e.activeSubs&&e.activeSubs.length>0&&(t=e.activeSubs[0].type===this.FLICKR_PRO_ANNUAL_TRIAL||e.activeSubs[0].type===this.FLICKR_PRO_OLD_ANNUAL_TRIAL),t},o.SubscriptionsHelper.prototype.isOneTimePro=function(o){return o.toJSON().oneTimePro.isOneTimePro},o.SubscriptionsHelper.prototype.getShopperCurrencyAndLocale=function(e){var t="US",n="en_US",r="USD",a=!1;if(!e&&o.config.flickr.geo?(o.config.flickr.geo.countryCode&&(t=o.config.flickr.geo.countryCode),o.config.flickr.geo.eu&&(a=o.config.flickr.geo.eu)):e&&(t=e.countryCode||"US",a=e.eu||!1),a)"GB"===t?(n="en_IE",r="GBP"):(n="en_IE",r="EUR");else switch(t){case"US":n="en_US",r="USD";break;case"CA":n="en_IE",r="CAD";break;default:n="en_IE",r="USD"}return{locale:n,currency:r}},o.SubscriptionsHelper.prototype.canUserSeeDigitalRiver=function(o){return!0},o.SubscriptionsHelper.prototype.getPriceWithCurrency=function(o,e,t){var n=t.replace("_","-");return new Intl.NumberFormat(n,{style:"currency",currency:e}).format(o)}},"@VERSION@",{requires:["moment","timezone-helper","array-extras"],optional:[]});YUI.add("subscription-history-list-models",function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-braintree-customerDetails-fetcher"].run(r,this.appContext)}},attributes:{subscriptions:{isListProxy:!0},oneTimePro:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-braintree-customerDetails-fetcher"]});YUI.add("flickr-braintree-customerDetails-fetcher",function(e,t){"use strict";function s(e){return{account_id:e.id}}require("hermes-core/flog")(t);e.namespace("ModelFetchers")["flickr-braintree-customerDetails-fetcher"]={run:function(i,r){var n=this,a=s(i);return e.Promise.all([r.callAPI("flickr.subscriptions.braintree.getCustomerDetails",a,!0),r.getModelRegistry("subscription-history-list-models"),r.getModelRegistry("subscription-history-models")]).then(function(e){return n._processResponse(e,i,r)},e.PromiseCatcher(t))},_processParams:s,_processResponse:function(t,s,i){var r,n=t[0],a=t[1],o=t[2],c={};(r=n.customerDetails.subscriptions)&&r instanceof Array&&(c.subscriptions=r.map(function(t){var s={};return t.status=parseInt(t.status,10),t.type=parseInt(t.type,10),s.startDate=1e3*t.startDate,s.billingScheduleMonths=t.billingScheduleMonths,s.nextBillingDate=1e3*t.nextBillingDate,s.effectiveEndDate=1e3*t.effectiveEndDate,s.type=t.type,s.paymentMethodId=t.paymentMethodId,s.status=t.status,s.amountBilled=t.amountBilled,s.transactions=t.transactions,s.prettyName=t.planInfo.prettyName,s.prettyNameDuration=t.planInfo.prettyNameDuration,s.pendingPrice=t.pendingPrice||void 0,s.paymentVendorType=t.paymentVendorType||void 0,e.Array.each(s.transactions,function(t){t.formattedCreateDate=e.moment(t.dateCreate,"X").format("MMM Do, YYYY"),t.isRefund=!1,3===parseInt(t.transactionType,10)&&(t.isRefund=!0)}),o.exists(t.id)?(o.setValues(t.id,s),o.proxy(t.id)):(s.id=t.id,o.add(s))}),n.customerDetails.paymentHistory&&(c.oneTimePro=n.customerDetails.paymentHistory.proStatus)),a.exists(s.id)?a.setValues(s.id,c):(c.id=s.id,a.add(c))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["subscription-history-models","subscription-history-list-models"]});YUI.add("subscription-history-models",function(t){function e(t){e.superclass.constructor.call(this,t)}var r=new t.SubscriptionsHelper;t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){return t.ModelUpdaters["flickr-subscriptions-changePlan-updater"].run({current_plan_type:r.type.prevVal,new_plan_type:r.type.newVal},this.appContext)},delete:function(e){return t.ModelDeletors["flickr-braintree-close-deletor"].run({subscription_id:e},this.appContext)}},attributes:{startDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},nextBillingDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},effectiveEndDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},billingScheduleMonths:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return 0}},type:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},paymentMethodId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyNameDuration:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},status:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},amountBilled:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},pendingPrice:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},transactions:{},paymentVendorType:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:r.getPaymentVendorType("braintree")}}})},"@VERSION@",{requires:["flickr-braintree-customerDetails-fetcher","flickr-subscriptions-changePlan-updater","flickr-braintree-close-deletor","subscriptions-helper"]});YUI.add("subscription-info-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-subscriptions-info-fetcher"].run(e,this.appContext)}},getFamilyInfoById:function(t,e){return this.getValue(t,"products").filter(function(t){return t.plan_id===e})},getPlanInfoById:function(t,e){return this.getValue(t,"products").filter(function(t){return t.planId===e})},getRawPlanPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].priceAfterTax},getFormattedPlanPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].formattedPriceAfterTax},getRawPlanDiscountPriceById:function(t,e){var n=this.getPlanInfoById(t,e);if(n&&n.length)return n[0].discountedPrice},attributes:{products:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-subscriptions-info-fetcher"]});