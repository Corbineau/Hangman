YUI.add("hermes-template-photo-limit-panel",function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,a,r){return" active"},3:function(n,e,t,a,r){return" hidden off-right"},5:function(n,e,t,a,r){return'<p class="sub-text">'+n.escapeExpression((t.preventOrphans||e&&e.preventOrphans||t.helperMissing).call(null!=e?e:{},null!=e?e.subText:e,{name:"preventOrphans",hash:{},data:r}))+"</p>"},compiler:[7,">= 4.0.0"],main:function(n,e,t,a,r){var l,s,p=null!=e?e:{},i=t.helperMissing,u=n.escapeExpression;return'<div class="panel'+(null!=(l=t.if.call(p,null!=e?e.initialActive:e,{name:"if",hash:{},fn:n.program(1,r,0),inverse:n.program(3,r,0),data:r}))?l:"")+'" data-panel-index="'+u("function"==typeof(s=null!=(s=t.panelIndex||(null!=e?e.panelIndex:e))?s:i)?s.call(p,{name:"panelIndex",hash:{},data:r}):s)+'">\n\t<div class="panel-content">\n\t\t<h2>'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.title:e,{name:"preventOrphans",hash:{},data:r}))+'</h2>\n\t\t<div class="description-container">\n\t\t\t'+u((t.renderTrustedMarkup||e&&e.renderTrustedMarkup||i).call(p,null!=e?e.description:e,{name:"renderTrustedMarkup",hash:{},data:r}))+'\n\t\t</div>\n\n\t\t<div class="button-container">\n\t\t\t<a href="/account/upgrade/pro" class="button accept-button pro-link">'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.acceptButtonText:e,{name:"preventOrphans",hash:{},data:r}))+'</a>\n\t\t\t<button class="button unfluid decline-button">'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.declineButtonText:e,{name:"preventOrphans",hash:{},data:r}))+"</button>\n\t\t</div>\n\n\t\t"+(null!=(l=t.if.call(p,null!=e?e.subText:e,{name:"if",hash:{},fn:n.program(5,r,0),inverse:n.noop,data:r}))?l:"")+"\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/photo-limit-panel",function(e,r){return r=r||{},r.partials=r.partials?n.merge(a,r.partials):a,t(e,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("model-proxy",function(e,t){var r=require("hermes-core/flog")(t);e.getModelProxyConstructor=function(t){var o;return o=function(e){this.id=e,this.registry=t,this.isModel=!0},o.prototype={},e.getModelProxyConstructor.skipList.forEach(function(e){o.prototype[e]=function(){var t=new Error("Registry methods are not exposed on models.");throw r.error({err:t,method:e}),t}}),e.Object.each(t,function(r,n){o.prototype[n]||0!==n.indexOf("_")&&e.Lang.isFunction(r)&&(Object.keys(r.prototype).length>0||(o.prototype[n]=(function(e){return function(){for(var r=new Array(arguments.length),o=0;o<r.length;++o)r[o]=arguments[o];return r.unshift(this.id),t[e].apply(t,r)}})(n)))},this,!0),o},e.getModelProxyConstructor.skipList=["add","get","load","proxy","remoteRead","remoteCreate","attributeSearch","removeAll","getCount","serialize","deserialize"]},"@VERSION@",{requires:[]});YUI.add("flickr-collection",function(t){var i,n={};(i=t.FlickrCollection=function(t,i,n){this.registry=t,this.id=i,this.attrName=n,this._data=[],this.fetchedStart=!1,this.fetchedEnd=!1,this.totalItems=Number.MAX_VALUE}).prototype={constructor:i,push:function(t){var i=this._data.concat();i.push(t),this.registry.setValue(this.id,this.attrName,i)},unshift:function(t){var i=this._data.concat();i.unshift(t),this.registry.setValue(this.id,this.attrName,i)},concat:function(t){var i=this._data.concat(t);this.registry.setValue(this.id,this.attrName,i)},remove:function(t){"string"==typeof t&&(t={id:t});var i,n=this.find(t,!0);return n&&((i=this._data.concat()).splice(n.index,1),this.registry.setValue(this.id,this.attrName,i)),n&&n.value},find:function(t,i){if(!t)return null;var n=null,e=Object.keys(t);return this._data.some(function(i,r){if(i)return e.every(function(n){return i[n]===t[n]})?(n={value:i,index:r},!0):void 0}),i?n:n?n.value:null},getFirstItem:function(){var t,i;for(t=0;t<this._data.length;t++)if(i=this._data[t])return{item:i,index:t};return null},getLastItem:function(){var t,i;for(t=this._data.length-1;t>=0;t--)if(i=this._data[t])return{item:i,index:t};return null},getList:function(){return this._data.concat()},size:function(){return this._data.length},toJSON:function(){var i=[];return t.Array.each(this.getList(),function(t){t&&i.push(t.toJSON())}),i},toString:function(){return this.registry.name+'["'+this.attrName+'"]'},appendToListMulti:function(t){this.concat(t)},appendToList:function(t){this.push(t)},prependToList:function(t){this.unshift(t)},getFromListByID:function(t,i){var n={};return n[i||"id"]=t,this.find(n)||void 0},removeFromList:function(t,i){var n={};return n[i||"id"]=t,this.remove(n)},hasMinBoundary:function(){return this.fetchedStart},hasMaxBoundary:function(){return this.fetchedEnd},_setValue:function(t){this._data=t}},t.FlickrCollection.executeFetch=function(i,e,r,a){var s;return a&&t.Lang.isFunction(a.run)?(s=JSON.stringify(i),n[s]||(n[s]=a.run.call(a,i,e.appContext).then(function(t){return delete n[s],t},function(t){throw delete n[s],t}),n[s])):t.Promise.reject("(flickr-collection::executeFetch) invalid fetcher for "+e.name+"["+r+"]")},t.FlickrCollection.trimArray=function(t){for(var i=0,n=t.length-1;i<t.length&&!t[i];)i++;for(;n>i&&!t[n];)n--;return t.slice(i,n+1)}},"@VERSION@",{requires:[]});YUI.add("paged-collection",function(t,e){var a=require("hermes-core/flog")(e);t.PagedCollection=function(t,e,a,s){this.constructor.superclass.constructor.call(this,t,e,a),s&&(s instanceof Array&&(s={pageContent:s,page:1,perPage:s.length}),s.totalPages&&(this.totalPages=s.totalPages),void 0===typeof s.totalItems||isNaN(parseFloat(s.totalItems))||(this.totalItems=parseFloat(s.totalItems)),this.fetchedStart=!!s.fetchedStart,this.fetchedEnd=!!s.fetchedEnd,this.addPage(s))},t.extend(t.PagedCollection,t.FlickrCollection,{getPage:function(e){var a,s,i,o,r,n,h;if(e&&e.page&&e.perPage&&!e.forceAPICall){if(n=this.totalPages&&e.page>=this.totalPages,h=this.totalItems&&s>=this.totalItems,a=e.perPage*(e.page-1),s=Math.min(e.perPage*e.page,this.totalItems),!n&&!h||!this.fetchedEnd)for(i=a;i<s;i++)if(void 0===this._data[i]||!this._data[i].exists()){o=!0;break}}else e||(e={}),o=!0;return o?(e.pathAlias||(e.id=this.id),e.isCollection=!0,(r=this.registry.attributes[this.attrName].pageFetch).fetchParams&&(e=t.merge(e,r.fetchParams)),t.FlickrCollection.executeFetch(e,this.registry,this.attrName,r.listFetcher)):t.Promise.resolve(this._data.slice(a,s))},addPage:function(t){var e,a,s=t.perPage*(t.page-1),i=s+Math.min(t.pageContent.length,t.perPage),o=0;if(t.forceAppend)this._data=this._data.concat(t.pageContent);else if(this._data.length<=s)this._data.length=s,this._data=this._data.concat(t.pageContent);else for(this._data.length<i&&(this._data.length=i),e=s;e<i;e++)this._data[e]=t.pageContent[o],o++;t.totalPages&&(this.totalPages=t.totalPages,t.page>=this.totalPages&&(this.fetchedEnd=!0)),void 0===typeof t.totalItems||isNaN(parseFloat(t.totalItems))||(a=parseFloat(t.totalItems),this.totalItems=a,this._data.length>=a?this.fetchedEnd=!0:s+parseInt(t.perPage,10)>a&&this._data.length<a&&(this.fetchedEnd=!0)),this.fetchedStart=this._data&&void 0!==this._data[0]},removePage:function(t){},getPageOf:function(t,e){e||(a.warn("`perPage` must be specified; defaulting to 50."),e=50);var s=this.find(t,!0);return s?Math.floor(s.index/e)+1:-1},getNextIncompletePage:function(t){var e=t.page*(t.perPage-1),a=Math.floor(this._data.length/t.perPage)+1;for(e;e<this._data.length;e++)if(void 0===this._data[e]||!this._data[e].exists()){a=Math.floor(e/t.perPage)+1;break}return a},_setValue:function(e){if(e instanceof Array)this.constructor.superclass._setValue.call(this,e);else{if(!(e=(function(e){return e?(e instanceof Array&&(e={pageContent:e}),e=t.merge({page:1,perPage:0,pageContent:[]},e)):(a.warn("No pageData sent to PagedCollection; aborting."),null)})(e)))return;e.remove?this.removePage(e):this.addPage(e)}}})},"@VERSION@",{requires:["flickr-collection"]});YUI.add("flickr-model-registry",function(e,t){function i(t,s,a){return!1===a&&"string"==typeof t&&"string"==typeof s&&(t=t.toLowerCase(),s=s.toLowerCase()),t===s||(e.moment.isMoment(t)&&e.moment.isMoment(s)?0===t.diff(s):!!(e.Lang.isArray(t)&&e.Lang.isArray(s)&&(function(t,s){var a=!0;t.length!==s.length&&(a=!1);a&&e.Array.some(t,function(e,t){if(!i(s[t],e))return a=!1,!0});return a})(t,s))||!!(e.Lang.isObject(t,!0)&&e.Lang.isObject(s,!0)&&(function(t,s){var a=!0;e.Object.size(t)!==e.Object.size(s)&&(a=!1);a&&e.Object.some(t,function(e,t){if(!s.hasOwnProperty(t)||!i(s[t],e))return a=!1,!0});a&&e.Object.some(s,function(e,s){if(!t.hasOwnProperty(s)||!i(t[s],e))return a=!1,!0});return a})(t,s)))}function s(t){var i=t;return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Array.prototype?(i=t.slice(),void 0!==t.hasMinBoundary&&(i.hasMinBoundary=t.hasMinBoundary),void 0!==t.hasMaxBoundary&&(i.hasMaxBoundary=t.hasMaxBoundary)):Object.getPrototypeOf(t)===Object.prototype&&(i={},e.Object.each(t,function(e,t){i[t]=e},this))),i}var a=require("hermes-core/flog")(t);e.Models={};var r=e.FlickrModelRegistry=function(t){this.appContext=t,this.attributes=this.attributes||{},this.attributes.id={writeOnce:"initOnly",setter:function(t){return e.Lang.isString(t)||(e.Lang.isNumber(t)?t+="":(a.info("`id` falling back to a Y.guid",{topic:this.name,val:t}),t=e.guid())),t}},this._setDefaultRemoteMethods(),this._validateAttributes(),this._data={},this._dataSize=0,this._subscribers=[],this.hasWeakSubscribers=!1,this._chainedEvents={},this._derivedCache=void 0,this._unsavedModels={}};r.prototype={attributeSearch:function(t,s){var a=[];return t.id?a.push(t.id):e.Object.each(this._data,function(r,n){var o=!0;e.Object.some(t,function(e,t){if(!i(e,r[t],!1)){if(!0!==s)return o=!1,!0;if(!i(e,this.getDefaultValue(r.id,t),!1))return o=!1,!0}},this),o&&a.push(n)},this),a},load:function(t,i){var s,a,r=this;return i||(i={}),e.Lang.isObject(t,!0)?(s=this.attributeSearch(t).sort()[0],i=e.merge(t,i||{})):(s=t,i=e.merge({id:s},i)),s&&this.exists(s)?e.Promise.resolve(s):(this._fetchPromises||(this._fetchPromises={}),a=s||JSON.stringify(i),this._fetchPromises[a]?this._fetchPromises[a]:(this._fetchPromises[a]=this.remoteRead(i).then(function(){var e,i,n=s;if(s||(e=r.attributeSearch(t)).length>0&&(n=e[0]),delete r._fetchPromises[a],n&&r.exists(n))return n;throw i=new Error("["+r.name+"] Model ID is missing after fetching."),i.getModelFailure=!0,i}),this._fetchPromises[a]))},get:function(e,t){return this.load(e,t).then(this.proxy.bind(this))},add:function(t,i,s){var r;{if(e.Lang.isObject(t,!0)&&!e.Lang.isArray(t))return void 0===i&&(i=!1),r=this.attributes.id.setter.apply(this,[t.id,void 0]),this._data[r]?a.warn("Attempt to add a model that is already in the registry.",{topic:this.name,id:r}):(this._data[r]={},this._dataSize++,this._queueEvent("modelsAdded",{id:r}),i?this._data[r]=t:Object.keys(this.attributes).forEach(function(e){var i=this.attributes[e],a=t[e];i.readOnly||this.setValue(r,e,a,!0,s)},this),this.appContext.markAsNewlyFetched(this.name,r)),this.proxy(r);a.warn("`add` requires an object",{topic:this.name,data:t})}},remove:function(e){this.exists(e)&&(delete this._data[e],this._dataSize--,this._removeChainedEvents(e),this._removeEventSubscribers(e),this._queueEvent("modelsRemoved",{id:e}))},removeAll:function(){e.Object.each(this._data,function(e,t){this.remove(t)},this)},removeAllExcept:function(t){var i=t.reduce(function(e,t){return e[t]=!0,e},{});e.Object.each(this._data,function(e,t){i[t]||this.remove(t)},this)},_removeChainedEvents:function(t){var i;this._chainedEvents[t]&&(e.Object.each(this._chainedEvents[t],function(t,s){(i=this.attributes[s])&&(i.isModel?t.detach():(i.isListProxy||i.isCollection)&&e.Array.each(t,function(e){e.detach&&e.detach()}))},this),delete this._chainedEvents[t])},_removeEventSubscribers:function(t){var i=[];this._subscribers.length&&(e.Array.each(this._subscribers,function(e,s){e.id===t&&i.push(s)},this),e.Array.each(i,function(e){this._subscribers.splice(e,1)},this))},proxy:function(t){return this._ModelProxy||(this._ModelProxy=e.getModelProxyConstructor(this)),new this._ModelProxy(t)},getValue:function(t,i,r){var n,o,h;if(t&&i)if(this.exists(t)){if(o=this.attributes[i])return o.isListProxy?n=new e.ListProxy(this,t,i):(void 0===(n=this._data[t][i])&&(n=this.getDefaultValue(t,i)),h=o.getter,!r&&h&&(n=h.apply(this,[n,t])),n=s(n)),n;a.warn("`getValue` called for an attribute that isn't defined",{topic:this.name,id:t,attr:i})}else a.warn("`getValue` called for an id that doesn't exist in the registry.",{topic:this.name,id:t,attr:i});else a.warn("`getValue` requires two arguments.",{topic:this.name,id:t,attr:i})},setValue:function(t,r,n,o,h){var d,u,l,c,f,v,g;if(!t||!r||arguments.length<3)a.warn("`setValue` requires three arguments.",{topic:this.name,id:t});else if(this.exists(t))if(d=this.attributes[r])if(d.readOnly)a.warn("Attribute is readOnly.",{topic:this.name,id:t,attr:r});else if("initOnly"!==d.writeOnce||o)if(!0===d.writeOnce&&this._data[t][r])a.warn("Attribute can only be set once.",{topic:this.name,id:t,attr:r});else{if(l=this.getValue(t,r),c=this._data[t][r],d.isListProxy&&(l=c),!h&&d.validator){if(v=d.validator,!e.Lang.isFunction(v))return void a.warn("Attribute has an invalid validator.",{topic:this.name,validator:d.validator,attr:r});if(!v.apply(this,[n,t]))return void a.info("Attribute validation failed.",{topic:this.name,id:t,val:n,attr:r})}n=s(n),!h&&d.setter&&(n=d.setter.apply(this,[n,t])),d.isListProxy&&!e.Lang.isArray(n)&&(n=[]),d.isCollection&&(n?"object"==typeof n&&n instanceof e.PagedCollection||(l?(c=l.getList(),l._setValue(n),n=l):(c=null,n=new e.PagedCollection(this,t,r,n))):n=new e.PagedCollection(this,t,r)),this._isDifferentValue(t,r,n,l)&&(!d.isModel||e.Lang.isObject(n)&&n.isModel?(o||(u=this._getAttributeValuesDerivedBy(t,r)),this._data[t][r]=n,d.isListProxy&&n&&(n.hasMinBoundary&&this.getValue(t,r).setMinBoundary(),n.hasMaxBoundary&&this.getValue(t,r).setMaxBoundary()),(d.isModel||d.isListProxy||d.isCollection)&&this._chainEvents(t,r),o||(f=this.getValue(t,r),d.isListProxy||d.isCollection||this._setUnsaved(t,r,f,l,c),g={id:t,attrName:r,prevVal:l,newVal:f},d.isListProxy?g.listDiff=this._calcListDiff(f,l):d.isCollection&&(g.listDiff=this._calcListDiff(f,c)),this._queueEvent("valuesChanged",g),e.Object.size(u)&&e.Object.each(u,function(e,s){var a=this.getValue(t,s);i(a,e)||(g={id:t,attrName:s,prevVal:e,newVal:a,derivedBy:[r]},(this.attributes[s].isListProxy||this.attributes[s].isCollection)&&(g.listDiff=this._calcListDiff(a,e)),this._queueEvent("valuesChanged",g))},this))):a.warn("Attribute must be a ModelProxy instance.",{topic:this.name,id:t,attr:r}))}else a.warn("Attribute can only be set during initialization.",{topic:this.name,id:t,attr:r});else a.warn("Attribute is not present in the attributes list.",{topic:this.name,id:t,attr:r});else a.warn("`setValue called for an id that is not in the registry.",{topic:this.name,id:t})},setValues:function(t,i){var s={};e.Object.each(i,function(e,i){"id"!==i&&(s[i]=this.setValue(t,i,e))},this)},revertValue:function(e,t){this._unsavedModels[e]&&void 0!==this._unsavedModels[e][t]&&this.setValue(e,t,this._unsavedModels[e][t].lastSavedValRaw)},exists:function(t){var i;return i=e.Lang.isArray(t)?t[0]:e.Lang.isObject(t,!0)?this.attributeSearch(t)[0]:t,!!this._data[i]},addOrUpdate:function(e){if(this.exists(e.id)){var t,i;Object.keys(e).forEach(function(s){t=this.attributes[s],i=e[s],t&&!t.readOnly&&"initOnly"!==t.writeOnce&&this.setValue(e.id,s,i)},this)}else this.add(e);return this.appContext.markAsNewlyFetched(this.name,e.id),this.markChildModelsAsNewlyFetched(e.id),this.proxy(e.id)},markChildModelsAsNewlyFetched:function(e){var t=this;this.getOwnedModels(e).forEach(function(e){e&&(t.appContext.markAsNewlyFetched(e.registry.name,e.id),e.markChildModelsAsNewlyFetched(e.id))})},getOwnedModels:function(t){var i,s,r,n=[];if(!t)return a.warn("`getOwnedModels` requires a model id.",{topic:this.name,id:t}),n;if(!this.exists(t))return n;this._ModelProxy||(this._ModelProxy=e.getModelProxyConstructor(this));for(i in this.attributes)(s=this.attributes[i]).isModel?(r=this.getValue(t,i))&&r.exists()&&n.push(r):(s.isListProxy||s.isCollection)&&(n=n.concat(this.getValue(t,i).getList().filter(function(e){return e&&e.isModel&&e.exists()})));return n},hasAttribute:function(e){return!!this.attributes[e]},toJSON:function(e){var t,i,s={};if(e)for(t in this.attributes)s[t]=this.getValue(e,t),s[t]&&(this.attributes[t].isModel||this.attributes[t].isListProxy||this.attributes[t].isCollection)&&(s[t]=s[t].toJSON());else for(i in this._data)s[i]=this.toJSON(i);return s},on:function(t,i,s,a){var r;return t||(t=null),r={eventName:i,fn:s,id:t,weak:a},this._subscribers.push(r),a&&(this.hasWeakSubscribers=!0),{detach:function(){var t=e.Array.indexOf(this._subscribers,r);this._subscribers.splice(t,1)}.bind(this)}},removeWeakSubscribers:function(){var e=this._subscribers.length;if(e)for(;e--;)this._subscribers[e].weak&&this._subscribers.splice(e,1);this.hasWeakSubscribers=!1},getCount:function(){return this._dataSize},getDefaultValue:function(e,t){var i,s;return"function"==typeof(i=this.attributes[t]).defaultFn&&(s=i.defaultFn.call(this,e)),void 0===s&&void 0!==i.defaultValue&&(s=i.defaultValue),s},_isDifferentValue:function(e,t,s,a){var r=this.attributes[t],n=r.getter;if(n&&(s=n.apply(this,[s,e])),void 0!==r.isListProxy&&r.isListProxy&&void 0!==a){if(s.hasMaxBoundary!==(void 0!==a.hasMaxBoundary&&a.hasMaxBoundary)||s.hasMinBoundary!==(void 0!==a.hasMinBoundary&&a.hasMinBoundary))return!0}else if(r.isCollection)return!0;return!i(s,a)},_calcListDiff:function(t,i){var s,a,r,n,o={added:null,removed:null};return s=t instanceof e.ListProxy||t instanceof e.PagedCollection?t.getList():t,a=i instanceof e.ListProxy||i instanceof e.PagedCollection?i.getList():i,r=a.reduce(function(e,t){return t&&t.id&&(e[t.id]=!0),e},{}),n=s.reduce(function(e,t){return t&&t.id&&(e[t.id]=!0),e},{}),o.added=s.filter(function(e){return e&&!r[e.id]}),o.removed=a.filter(function(e){return e&&!n[e.id]}),o},_getAttributesDerivedBy:function(t){return this._derivedCache||(this._derivedCache={},e.Object.each(this.attributes,function(t,i){t.derivedBy&&e.Lang.isArray(t.derivedBy)&&e.Array.each(t.derivedBy,function(e){this._derivedCache[e]||(this._derivedCache[e]=[]),this._derivedCache[e].push(i)},this)},this)),this._derivedCache[t]},_getAttributeValuesDerivedBy:function(t,i){var s=this._getAttributesDerivedBy(i),a={};return s&&s.length&&e.Array.each(s,function(e){a[e]=this.getValue(t,e)},this),a},_queueEvent:function(t,i){var s;this._eventQueue||(this._eventQueue=[]),(s=this._eventQueue).push({type:t,data:i}),this._eventPending||(this._eventPending=!0,setTimeout(function(){var t={};this._eventPending=!1,delete this._eventQueue,e.Array.each(s,function(e){var i=e.type,s=e.data,a=s.id;switch(i){case"modelsAdded":case"modelsRemoved":t[i]=t[i]||{},t[i][a]=s;break;case"valuesChanged":if(t.valuesChanged&&t.valuesChanged[a]&&t.valuesChanged[a][s.attrName]&&t.valuesChanged[a][s.attrName].newVal){t.valuesChanged[a][s.attrName].newVal=s.newVal,t.valuesChanged[a][s.attrName].derivedBy&&s.derivedBy&&(t.valuesChanged[a][s.attrName].derivedBy=t.valuesChanged[a][s.attrName].derivedBy.concat(s.derivedBy)),t.valuesChanged[a][s.attrName].chained&&!s.chained&&delete t.valuesChanged[a][s.attrName].chained;break}t.valuesChanged=t.valuesChanged||{},t.valuesChanged[a]=t.valuesChanged[a]||{},t.valuesChanged[a][s.attrName]=s}}),e.Object.each(t,function(e,t){this._fireEvent(t,e)},this)}.bind(this),0))},_fireEvent:function(t,i){e.Array.each(this._subscribers,function(e){e.eventName===t&&(e.id?i[e.id]&&e.fn.call(void 0,i[e.id]):e.fn.call(void 0,i))})},_chainEvents:function(t,i){var s,a,r=this.attributes[i];this._chainedEvents[t]=this._chainedEvents[t]||{},r.isModel?(this._chainedEvents[t][i]&&this._chainedEvents[t][i].detach(),a=this.getValue(t,i),this._chainedEvents[t][i]=a.on("valuesChanged",function(e){this._queueChainedEvent(t,i)}.bind(this))):(r.isListProxy||r.isCollection)&&(this._chainedEvents[t][i]&&e.Array.each(this._chainedEvents[t][i],function(e){e.detach()}),this._chainedEvents[t][i]=[],s=this.getValue(t,i),e.Array.each(s.getList(),function(e){e&&this._chainedEvents[t][i].push(e.on("valuesChanged",function(e){this._queueChainedEvent(t,i)}.bind(this)))},this))},_queueChainedEvent:function(t,i){var s,a=this.getValue(t,i);this._queueEvent("valuesChanged",{id:t,attrName:i,prevVal:a,newVal:a,chained:!0}),s=this._getAttributeValuesDerivedBy(t,i),e.Object.size(s)&&e.Object.each(s,function(e,s){this._queueEvent("valuesChanged",{id:t,attrName:s,newVal:e,derivedBy:[i],chained:!0})},this)},_deleteUnsaved:function(t,i){this._unsavedModels[t]&&this._unsavedModels[t][i]&&(delete this._unsavedModels[t][i],0===e.Object.size(this._unsavedModels[t])&&delete this._unsavedModels[t])},_setUnsaved:function(e,t,s,a,r){this._unsavedModels[e]&&this._unsavedModels[e][t]?i(s,this._unsavedModels[e][t].lastSavedVal)&&this._deleteUnsaved(e,t):(this._unsavedModels[e]=this._unsavedModels[e]||{},this._unsavedModels[e][t]={lastSavedVal:a,lastSavedValRaw:r})},_validateAttributes:function(){var t,i;t=["setter","getter","validator","defaultValue","defaultFn","derivedBy","readOnly","writeOnce","isModel","serialize","deserialize"],i=["isListProxy","isCollection","pageFetch","contextFetch","rangeFetch"],e.Object.each(this.attributes,function(s,r){e.Object.each(s,function(n,o){s.isListProxy||s.isCollection?-1===e.Array.indexOf(i,o)&&a.warn("Unknown property on collection attribute.",{topic:this.name,prop:o,attr:r}):-1===e.Array.indexOf(t,o)&&a.warn("Unknown property on attribute.",{topic:this.name,prop:o,attr:r})},this)},this)},_setDefaultRemoteMethods:function(){this.remote=this.remote||{},this.remote.create||(this.remote.create=function(t){return a.error("`remote.create` was called without being implemented.",{topic:this.name,attrs:t}),e.Promise.reject()}),this.remote.read||(this.remote.read=function(t){Object.keys(this.attributes).some(function(e){var t=this.attributes[e];if(!("id"===e||t.readOnly||t.isListProxy||t.isCollection||t.defaultValue||t.defaultFn))return!0},this),"object"!=typeof t&&(t={id:t});var i={id:t.id};return this.add(i),e.Promise.resolve(i)}),this.remote.update||(this.remote.update=function(t,i){return a.error("`remote.update` was called without being implemented.",{topic:this.name,id:t,attrs:i}),e.Promise.reject()}),this.remote.delete||(this.remote.delete=function(t){return a.error("`remote.delete` was called without being implemented.",{topic:this.name,id:t}),e.Promise.reject()})},remoteCreate:function(e){return this.remote.create.call(this,e)},remoteRead:function(e){return this.remote.read.call(this,e)},remoteUpdate:function(t){var i={},s=this;return this._unsavedModels[t]&&e.Object.each(this._unsavedModels[t],function(e,s){i[s]={newVal:this.getValue(t,s),prevVal:e.lastSavedVal}},this),e.Object.size(i)>0?this.remote.update.call(this,t,i).then(function(e){return s._unsavedModels={},e}):e.Promise.resolve()},remoteBatchUpdate:function(e,t){return this.remote.batchUpdate.call(this,e,t)},remoteDelete:function(e){var t=this;return this.remote.delete.call(this,e).then(function(){t.remove(e)})},getListPageByContinuation:function(t,i){var s,a,r,n,o,h,d,u,l,c,f=this,v=f.appContext,g=e.APIHelper.request.getRebootPhotoExtras();switch(f.name){case"photo-groups-models":s="group-pool-models",a="groups",r="flickr.photos.getGroups",n="groups.group",g+=","+e.APIHelper.request.getRebootGroupExtras();break;case"photo-sets-models":s="set-models",a="sets",r="flickr.photos.getSets",n="sets.set";break;case"photo-galleries-models":s="gallery-models",a="galleries",r="flickr.photos.getGalleries",n="galleries.gallery"}return r?f.exists(t)?(f.continuationKeys=f.continuationKeys||{},f.getMorePromises=f.getMorePromises||{},"-1"===(h=f.continuationKeys[t]||"0")?e.Promise.resolve({newItems:[],loadedAll:!0}):("0"===h&&(i+=f.getValue(t,a).getList().length),o={photo_id:t,extras:g,primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:h,per_page:i},u=t+"_"+h,(l=f.getMorePromises[u])?l:(c={apiResponse:v.callAPI(r,o,!0),contextRegistry:v.getModelRegistry(s),personRegistry:v.getModelRegistry("person-models")},"photo-groups-models"===f.name&&(c.groupRegistry=v.getModelRegistry("group-models")),f.getMorePromises[u]=new e.FlickrPromise(c).then(function(i){var s,r,o,h=[],l=i.apiResponse,c=i.contextRegistry,v=i.personRegistry,g=i.groupRegistry;return(r=n.split(".").reduce(function(t,i){return e.Lang.isObject(t)?t[i]:void 0},l))&&(e.Array.each(r,function(t){e.APIHelper.response.addContextToRegistry(t,c,v,g),h.push(c.proxy(t.id))}),h.length&&(o=f.getValue(t,a).getList().map(function(e){return e.getValue("id")}),(h=h.filter(function(e){return-1===o.indexOf(e.getValue("id"))})).length&&f.getValue(t,a).appendToListMulti(h))),void 0===(d=l[a].continuation)?d="-1":e.Lang.isNumber(d)&&(d+=""),s="-1"===d,f.continuationKeys[t]=d,delete f.getMorePromises[u],{newItems:h,loadedAll:s}},function(e){throw delete f.getMorePromises[u],e}),f.getMorePromises[u]))):e.Promise.reject("[api-helper] getListPageByContinuation was called for an ID that isn't in the registry: "+t):e.Promise.reject("[api-helper] getListPageByContinuation was called without an invalid registry type: "+f.name)},getBuriedValue:function(e,t){var i,s={};return(i=this.getValue(e,t))&&i.payload&&(s=i.payload),s},setBuriedValue:function(e,t,i,s){return this.setValue(e,t,{payload:i},s)}},e.mix(r.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-promise","model-proxy","list-proxy","moment","paged-collection","localizable"]});YUI.add("flickr-contacts-add-updater",function(r,c){"use strict";r.namespace("ModelUpdaters")["flickr-contacts-add"]={run:function(t,e){return e.callAPI("flickr.contacts.add",t).then(null,r.FetcherErrorLogger(c))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-contacts-remove-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-contacts-remove"]={run:function(c,t){return t.callAPI("flickr.contacts.remove",c).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-contacts-edit-updater",function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-contacts-edit"]={run:function(e,c){return c.callAPI("flickr.contacts.edit",e).then(null,r.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-contacts-block-updater",function(c,r){"use strict";c.namespace("ModelUpdaters")["flickr-contacts-block"]={run:function(t,e){return e.callAPI("flickr.contacts.block",t).then(null,c.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-contacts-unblock-updater",function(c,r){"use strict";c.namespace("ModelUpdaters")["flickr-contacts-unblock"]={run:function(n,t){return t.callAPI("flickr.contacts.unblock",n).then(null,c.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("attribute-helpers",function(n){function e(n){if(void 0===n||null===n)return!0}n.AttributeHelpers={validateString:function(t){return!!e(t)||!!n.Lang.isString(t)||!!n.Lang.isNumber(t)},coerceString:function(e){return n.Lang.isNumber(e)&&(e=e.toString()),n.Lang.isString(e)?e:void 0},validateInteger:function(t){return!!e(t)||(n.Lang.isString(t)&&(t=parseInt(t,10)),!!n.Lang.isNumber(t))},coerceInteger:function(e){return n.Lang.isString(e)&&(e=parseInt(e,10)),n.Lang.isNumber(e)?e<0?Math.ceil(e):Math.floor(e):void 0},validateFloat:function(t){return!!e(t)||(n.Lang.isString(t)&&(t=parseFloat(t)),!!n.Lang.isNumber(t))},coerceFloat:function(e){if(n.Lang.isString(e)&&(e=parseFloat(e)),n.Lang.isNumber(e))return e},validateBoolean:function(t){return!!e(t)||!!n.Lang.isBoolean(t)||[0,"0","false"].indexOf(t)>-1||[1,"1","true"].indexOf(t)>-1},coerceBoolean:function(n){return!([!1,"0",0,"false"].indexOf(n)>-1)&&([!0,"1",1,"true"].indexOf(n)>-1||void 0)},validateDate:function(t){return!!e(t)||-1===[!0,!1].indexOf(t)&&!(t instanceof Array)&&("string"==typeof t&&(t=parseInt(t,10)),"object"==typeof t&&void 0!==t._d&&(t=t._d),!!n.moment(t).isValid())},coerceDate:function(e){var t=null,i=null;return n.moment.isMoment(e)?e:e&&"object"==typeof e&&e._d&&((i=n.moment(e)).isValid()||(i=n.moment(e._d)),i.isValid())?i:"number"==typeof e||e===parseInt(e,10).toString()?(t=parseInt(e,10),i=t.toString().length<=10?n.moment(t.toString(),"X"):n.moment(t)):e&&!n.Lang.isBoolean(e)&&(n.moment(new Date(e)).isValid()||n.moment(new Date(e.toString().replace(" ","T"))).isValid())?n.moment(e):void 0}}},"@VERSION@",{requires:[]});YUI.add("flickr-prefs-setSafeSearch-updater",function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-prefs-setSafeSearch"]={run:function(c,a){return a.callAPI("flickr.prefs.setSafeSearch",c).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("person-preferences-models",function(e){function t(e){t.superclass.constructor.call(this,e)}t.UNIFIED_SEARCH_VIEW_TYPE_DEFAULT=(t.UNIFIED_SEARCH_VIEW_TYPES={justified:"jst",thumbs:"thm",tiles:"til"}).justified,t.PHOTOSTREAM_VIEW_ORDER_DEFAULT=(t.PHOTOSTREAM_VIEW_ORDER_TYPES={dateposted:"dc",datetaken:"dt"}).dateposted,t.PHOTOSTREAM_VIEW_AS_TYPES={me:"me",friend:"fr",family:"fa",ff:"ff",public:"pu"},t.PHOTOSTREAM_VIEW_PREF_MAP={me:"me",fr:"friend",fa:"family",ff:"ff",pu:"public",dc:"dateposted",dt:"datetaken"},t.ALBUM_VIEW_LAYOUT_TYPES={justified:"justified",story:"story"},t.GALLERY_VIEW_LAYOUT_TYPES={large:"lv",justified:"jv",thumbnail:"tv"},t.ALBUM_VIEW_LAYOUT_DEFAULT=t.ALBUM_VIEW_LAYOUT_TYPES.story,t.GALLERY_VIEW_LAYOUT_DEFAULT=t.GALLERY_VIEW_LAYOUT_TYPES.large,t.PHOTOSTREAM_VIEW_AS_DEFAULT=t.PHOTOSTREAM_VIEW_AS_TYPES.public,e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,r){var i=[],n={};return e.Lang.isObject(r,!0)&&("safeSearch"in r?(n.safe_search=e.AttributeHelpers.coerceInteger(r.safeSearch.newVal)+1,i.push(e.ModelUpdaters["flickr-prefs-setSafeSearch"].run(n,this.appContext))):"photostreamViewOrderPref"in r||"photostreamViewAsPref"in r?(r.photostreamViewOrderPref&&(n.photostream_view_order_pref=r.photostreamViewOrderPref.newVal),r.photostreamViewAsPref&&(n.photostream_view_as_pref=r.photostreamViewAsPref.newVal),i.push(this.appContext.callAPI("flickr.prefs.setPrefs",n))):"albumViewLayoutPref"in r?(r.albumViewLayoutPref&&(n.album_view_layout=r.albumViewLayoutPref.newVal),i.push(this.appContext.callAPI("flickr.prefs.setPrefs",n))):"galleryViewLayoutPref"in r?(r.galleryViewLayoutPref&&(n.galleries_view_layout_pref=r.galleryViewLayoutPref.newVal),i.push(this.appContext.callAPI("flickr.prefs.setPrefs",n))):Object.keys(r).forEach(function(e){"unifiedSearchViewPref"===e?n.unified_search_view_pref=r.unifiedSearchViewPref.newVal:n[e]=r[e],i.push(this.appContext.callAPI("flickr.prefs.setPrefs",n))})),e.Promise.all(i)},readUserPrefs:function(e,t){return t.callAPI("flickr.feed.preferences.getUserPreferences",e,t).then(function(e){return e},function(e){})}},remoteReadUserPrefs:function(e,t,r){return this.remote.readUserPrefs(t,r).then(function(e){return e},function(e){})},attributes:{safeSearch:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},unifiedSearchViewPref:{validator:function(r){return!!e.AttributeHelpers.validateString(r)&&Object.keys(t.UNIFIED_SEARCH_VIEW_TYPES).some(function(e){return t.UNIFIED_SEARCH_VIEW_TYPES[e]===r})},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:t.UNIFIED_SEARCH_VIEW_TYPE_DEFAULT},photostreamViewOrderPref:{validator:function(r){return!!e.AttributeHelpers.validateString(r)&&Object.keys(t.PHOTOSTREAM_VIEW_ORDER_TYPES).some(function(e){return t.PHOTOSTREAM_VIEW_ORDER_TYPES[e]===r})},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:t.PHOTOSTREAM_VIEW_ORDER_DEFAULT},photostreamViewAsPref:{validator:function(r){return!!e.AttributeHelpers.validateString(r)&&Object.keys(t.PHOTOSTREAM_VIEW_AS_TYPES).some(function(e){return t.PHOTOSTREAM_VIEW_AS_TYPES[e]===r})},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:t.PHOTOSTREAM_VIEW_AS_DEFAULT},albumViewLayoutPref:{validator:function(r){return!!e.AttributeHelpers.validateString(r)&&Object.keys(t.ALBUM_VIEW_LAYOUT_TYPES).some(function(e){return t.ALBUM_VIEW_LAYOUT_TYPES[e]===r})},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:t.ALBUM_VIEW_LAYOUT_DEFAULT},galleryViewLayoutPref:{validator:function(r){return!!e.AttributeHelpers.validateString(r)&&Object.keys(t.GALLERY_VIEW_LAYOUT_TYPES).some(function(e){return t.GALLERY_VIEW_LAYOUT_TYPES[e]===r})},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:t.GALLERY_VIEW_LAYOUT_DEFAULT}}},{getReadablePrefName:function(e){return t.PHOTOSTREAM_VIEW_PREF_MAP[e]},buildContextSuffix:function(t,r){var i=e.Models["person-preferences-models"].getReadablePrefName(t.getValue("photostreamViewOrderPref")),n=e.Models["person-preferences-models"].getReadablePrefName(t.getValue("photostreamViewAsPref"));return n===e.Models["person-preferences-models"].PHOTOSTREAM_VIEW_PREF_MAP.me||t.id!==r?i:i+"-"+n}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-prefs-setSafeSearch-updater","attribute-helpers"]});YUI.add("person-profile-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}},photoCount:{},unreadMessages:{},storageUsed:{},storageTotal:{},coverPhotoUrls:{},location:{},arrPhotoCount:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher"]});YUI.add("flickr-groups-join-creator",function(r,o){"use strict";r.namespace("ModelCreators")["flickr-groups-join"]={run:function(e,i){var u={};return u.group_id=e.groupModel.id,u.accept_rules=e.acceptRules,r.Promise.all([i.callAPI("flickr.groups.join",u)]).then(function(r){if("ok"===r[0].stat)return e.groupModel.join(),e.groupModel},r.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-groups-leave-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-groups-leave"]={run:function(o,l){var t={};return t.group_id=o.groupModel.id,t.delete_photos=o.deletePhotos,e.Promise.all([l.callAPI("flickr.groups.leave",t)]).then(function(e){if("ok"===e[0].stat)return o.groupModel.leave(),o.groupModel},e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("group-info-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-groups-getInfo"].run(t,this.appContext)},join:function(t,r){return e.ModelCreators["flickr-groups-join"].run(t,r)},leave:function(t,r){return e.ModelDeletors["flickr-groups-leave"].run(t,r)}},join:function(e){var t=this.getValue(e,"group");return t&&t.setValue("isMember",!0),this},leave:function(e){var t=this.getValue(e,"group");return t&&(t.setValue("isAdmin",!1),t.setValue("isModerator",!1),t.setValue("isMember",!1),this.setValue(e,"hasPendingRequestToJoin",!1)),this},attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},secureDescription:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},rules:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},roles:{},secureRules:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},hasPendingRequestToJoin:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},photoLimitOptOut:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isInvited:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},discussionsLocked:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},privacy:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1},restrictions:{},throttle:{},poolPreviewRowsVisibleCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return 1}},coverPhotoAttribution:{},group:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getInfo-fetcher","flickr-groups-join-creator","flickr-groups-leave-deletor","attribute-helpers","group-models"]});YUI.add("flickr-groups-getInfo-fetcher",function(e,o){"use strict";e.namespace("ModelFetchers")["flickr-groups-getInfo"]={run:function(r,t){var s=this;return e.Promise.all([t.callAPI("flickr.groups.getInfo",this._processParams(r),!0),t.getModelRegistry("group-info-models"),t.getModelRegistry("group-models"),t.getModelRegistry("group-blast-models"),t.getModelRegistry("group-activity-models")]).then(function(e){return s._processResponse(e,r)},e.FetcherErrorLogger(o))},_processParams:function(o){var r={extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras()+", blast_user_info, date_last_viewed, has_pending_invite, coverphoto_attribution, is_locked",secure_image_embeds:1,lang:void 0};if(o.id)r.group_id=o.id;else{if(!o.pathAlias)throw new Error("[flickr-groups-getInfo-fetcher] `id` or `pathAlias` is required.");r.group_path_alias=o.pathAlias}return r},_processResponse:function(o,r){var t,s,i,a,p=o[0],u=o[1],l=o[2],g=o[3],d=o[4];return i=l.parseGroupModel(r.id,r.pathAlias,p.group),l.addOrUpdate(i),s={id:i.id,viewedPool:e.moment(p.group.viewedDates?p.group.viewedDates.pool:void 0),viewedDiscussions:e.moment(p.group.viewedDates?p.group.viewedDates.discussions:void 0),group:l.proxy(i.id)},d.addOrUpdate(s),i=l.proxy(i.id),a={id:i.id,blastMessage:p.group.blast?p.group.blast.content:"",blastMessageSecure:p.group.blast?p.group.secureBlast.content:"",blastUserId:p.group.blast?p.group.blast.userId:"",blastDateAdded:p.group.blast?e.moment(p.group.blast.dateBlastAdded,"X"):e.moment(),blastUserName:p.group.blast?p.group.blast.userName:"",blastPathAlias:p.group.blast?p.group.blast.userPathAlias:"",blastUserNSID:p.group.blast?p.group.blast.userNsid:"",blastRealName:p.group.blast?p.group.blast.realName:"",blastUserStatus:p.group.blast?p.group.blast.userStatus:""},g.addOrUpdate(a),t={id:p.group.id,pathAlias:p.group.pathAlias||r.pathAlias,description:p.group.description.content,secureDescription:p.group.secureDescription?p.group.secureDescription.content:"",rules:p.group.rules.content,roles:p.group.roles,secureRules:p.group.secureRules.content,restrictions:p.group.restrictions,throttle:p.group.throttle,poolPreviewRowsVisibleCount:p.group.pool_rows,group:i,discussionsLocked:"1"===p.group.isLocked,hasPendingRequestToJoin:p.group.has_pending_request_to_join,isInvited:p.group.is_invited,coverPhotoAttribution:p.group.coverphoto,photoLimitOptOut:p.group.photo_limit_opt_out},u.addOrUpdate(t),u.proxy(t.id)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["group-info-models","group-models"]});YUI.add("flickr-favorites-add-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-favorites-add"]={run:function(o,t){var a={};return a.photo_id=o.photoId,t.callAPI("flickr.favorites.add",a).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-favorites-remove-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-favorites-remove"]={run:function(o,i){var t={};return t.photo_id=o.photoId,t.user_id=o.userId,i.callAPI("flickr.favorites.remove",t).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("photo-model-helper",function(e,t){var i=require("hermes-core/flog")(t);e.PhotoModelHelper={updateEngagement:function(t,i){var r,n=[];return e.Lang.isObject(i,!0)&&"isFaved"in i&&(r=i.isFaved.newVal?"flickr-favorites-add":"flickr-favorites-remove",n.push(e.ModelUpdaters[r].run({photoId:t},this.appContext))),e.Promise.all(n)},toggleFave:function(e){var t=this.getValue(e,"faveCount"),i=!this.getValue(e,"isFaved"),r=t+(i?1:-1);this.setValues(e,{isFaved:i,faveCount:r}),"photo-engagement-models"!==this.name&&this.appContext.getModelRegistry("photo-engagement-models").then(function(t){t.exists(e)&&t.toggleFave(e)})},addAsFave:function(e){var t=this.getValue(e,"faveCount"),i=this.getValue(e,"isFaved");return i||this.setValues(e,{isFaved:!0,faveCount:t+1}),"photo-engagement-models"!==this.name&&this.appContext.getModelRegistry("photo-engagement-models").then(function(t){t.exists(e)&&t.toggleFave(e)}),!i},getLargestSize:function(e,t){return this.getSizeToFit(e,{width:Number.MAX_VALUE,height:Number.MAX_VALUE},t)},getSizeToFit:function(t,r,n){n=n||{};var a,o,s,u,d=this,l=r.width,h=r.height,c=!!n.cropToFit,g=n.includeSquare,f=n.sizes||this.getValue(t,"sizes"),v=n.excludeSizes||["o"],p=n.includeSizes;if(void 0===n.includeSizes)try{p=Object.keys(f)}catch(e){i.warn("getSizeToFit with invalid sizes",{err:e,sizes:f})}return this._getSizeToFitMemo=this._getSizeToFitMemo||{},a=[t,l,h,c,v.sort().join(""),p.sort().join("")].join("_"),this._getSizeToFitMemo[a]||(e.Object.each(f,function(e,i){var r,n,a,d,f;e&&-1===v.indexOf(i)&&p.indexOf(i)>-1&&(g||!this.isSizeSquare(i)||this.isPhotoSquare(t))&&(r=parseInt(e.width,10),n=parseInt(e.height,10),c&&r>=l&&n>=h?a=!0:!c&&(r>=l||n>=h)&&(a=!0),a&&(o?n<parseInt(o.height,10)&&(o=e):o=e),s?(d=parseInt(s.width,10),f=parseInt(s.height,10),(r>d||n>f)&&(s=e)):s=e),u=o||s},this),this._getSizeToFitMemo[a]=u,this._getSizeToFitMemoTimer||(this._getSizeToFitMemoTimer=setTimeout(function(){delete d._getSizeToFitMemo,delete d._getSizeToFitMemoTimer},1e4))),e.clone(this._getSizeToFitMemo[a],!0)},getSizeIfExact:function(e,t){var i,r,n=this.getValue(e,"sizes");return Object.keys(n).some(function(e){return"o"!==e&&(r=n[e],t.height===r.height&&t.width===r.width&&(i=r,!0))}),i},isSizeSquare:function(e){return!!{sq:"sq",q:"q"}[e]},isPhotoSquare:function(t){var i;return this._isPhotoSquareMemo=this._isPhotoSquareMemo||{},void 0!==this._isPhotoSquareMemo[t]?i=this._isPhotoSquareMemo[t]:(i=!0,e.Object.some(this.getValue(t,"sizes"),function(e,t){if(e&&e.width&&e.height&&!this.isSizeSquare(t)&&1!=parseInt(e.width,10)/parseInt(e.height,10))return i=!1,!0},this),this._isPhotoSquareMemo[t]=i),i},getSizeForCanvas:function(e,t,i,r){r=r||1;var n,a,o=this.getSizeToFit(e,{width:t*r,height:i*r});return n=Math.min(i/r,o.height),a=Math.min(t/r,o.width/o.height*n),n=Math.min(n,o.height/o.width*a),{width:Math.round(a),height:Math.round(n),url:o.url,pixelRatio:o.width/a}},attributes:{title:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},mediaType:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"photo"},license:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){return"video"===this.getValue(t,"mediaType")}},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var i=this.getValue(t,"owner"),r=this.appContext.getViewer();return!!r.signedIn&&i.getValue("id")===r.nsid}},sizes:{},descendingSizes:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(e){var t,i,r=[];if(this._descendingSizesMemo=this._descendingSizesMemo||{},this._descendingSizesMemo[e])return this._descendingSizesMemo[e];t=this.getValue(e,"sizes");for(i in t)r.push(t[i]),r[r.length-1].key=i;return r.sort(function(e,t){return e.width<t.width?1:e.width===t.width?e.height<t.height?1:e.height===t.height?"o"===e.key?-1:1:-1:-1}),this._descendingSizesMemo[e]=r,r}},ascendingSizes:{readOnly:!0,derivedBy:["descendingSizes"],defaultFn:function(e){return this.getValue(e,"descendingSizes").reverse()}},aspectRatio:{readOnly:!0,derivedBy:["descendingSizes","rotation"],defaultFn:function(e){var t=this.getValue(e,"descendingSizes")[0];return"o"===t.key&&this.getValue(e,"rotation")%180!=0?t.height/t.width:t.width/t.height}},needsInterstitial:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},canPublicComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/"+e:void 0}},rotation:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},ownerNsid:{},isFaved:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},faveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},canFave:{readOnly:!0,derivedBy:["is_owner"],getter:function(e,t){return!this.getValue(t,"isOwner")}},basicSimilaritySearchURL:{readOnly:!0,getter:function(e,t){return"/search/?similarity_id="+t}},similaritySearchURL:{readOnly:!0,derivedBy:["basicSimilaritySearchURL"],getter:function(e,t){var i=this.getValue(t,"basicSimilaritySearchURL");return this.appContext.flipper.isFlipped("enable-similarity-search-safety")&&(i+="&safe_search=1"),i}}}}},"@VERSION@",{requires:["flickr-favorites-add-updater","flickr-favorites-remove-updater"]});